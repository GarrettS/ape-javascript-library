<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.linenumber {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='linenumber'>  1</span> <span class="COMM">/**
<span class='linenumber'>  2</span>  * @fileoverview Calendar Widget
<span class='linenumber'>  3</span>  * @author Garrett Smith
<span class='linenumber'>  4</span>  * 
<span class='linenumber'>  5</span>  * @example &lt;pre>
<span class='linenumber'>  6</span>  * var calendar = APE.widget.Calendar.getById( "cal" );
<span class='linenumber'>  7</span>  * calendar.create();
<span class='linenumber'>  8</span>  * &lt;/pre>
<span class='linenumber'>  9</span>  */</span><span class="WHIT">
<span class='linenumber'> 10</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'> 11</span> </span><span class="NAME">APE.namespace</span><span class="PUNC">(</span><span class="STRN">"APE.widget"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 12</span> 
<span class='linenumber'> 13</span> </span><span class="COMM">/**
<span class='linenumber'> 14</span>  * @constructor
<span class='linenumber'> 15</span>  * @param {String} id the id of the input element.
<span class='linenumber'> 16</span>  */</span><span class="WHIT">
<span class='linenumber'> 17</span> </span><span class="NAME">APE.widget.Calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 18</span> </span><span class="WHIT">    </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 19</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'> 20</span> </span><span class="WHIT">    </span><span class="NAME">this.displayDate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">input.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 21</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.displayDate.valueOf</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'> 22</span> </span><span class="WHIT">        </span><span class="NAME">this.displayDate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 23</span> </span><span class="WHIT">    </span><span class="NAME">this.initEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 24</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 25</span> 
<span class='linenumber'> 26</span> </span><span class="NAME">APE.widget.Calendar.getByNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.getByNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 27</span> </span><span class="NAME">APE.widget.Calendar.getById</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.getById</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 28</span> 
<span class='linenumber'> 29</span> </span><span class="COMM">/**
<span class='linenumber'> 30</span>  * @param {Event} e event parameter for focus event.
<span class='linenumber'> 31</span>  * @description called when the input receives focus or click events.
<span class='linenumber'> 32</span>  */</span><span class="WHIT">
<span class='linenumber'> 33</span> </span><span class="NAME">APE.widget.Calendar.focusHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 34</span> </span><span class="WHIT">    </span><span class="NAME">APE.widget.Calendar.getById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">_show</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 35</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 36</span> 
<span class='linenumber'> 37</span> </span><span class="NAME">APE.widget.Calendar.documentMouseDownHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 38</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.dom</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 39</span> </span><span class="WHIT">        </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom.Event.getTarget</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 40</span> </span><span class="WHIT">        </span><span class="NAME">Calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget.Calendar</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 41</span> </span><span class="WHIT">        </span><span class="NAME">activeCalendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Calendar.activeCalendar</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 42</span> </span><span class="WHIT">        </span><span class="NAME">calendarEl</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 43</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">activeCalendar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 44</span> </span><span class="WHIT">        </span><span class="NAME">calendarEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">activeCalendar.calendarId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 45</span> 
<span class='linenumber'> 46</span> </span><span class="WHIT">        </span><span class="COMM">// If the innerHTML was wiped or something. </span><span class="WHIT">
<span class='linenumber'> 47</span> </span><span class="WHIT">        </span><span class="COMM">// This is a document event handler. Anything can happen. </span><span class="WHIT">
<span class='linenumber'> 48</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">calendarEl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 49</span> </span><span class="WHIT">            </span><span class="NAME">Calendar.activeCalendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 50</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 51</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 52</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dom.contains</span><span class="PUNC">(</span><span class="NAME">calendarEl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">calendarEl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 53</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'> 54</span> </span><span class="WHIT">        </span><span class="NAME">activeCalendar._hasFocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 55</span> </span><span class="WHIT">        </span><span class="NAME">activeCalendar._hide</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 56</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 57</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 58</span> 
<span class='linenumber'> 59</span> </span><span class="COMM">/**
<span class='linenumber'> 60</span>  * @param {Event} e event parameter for blur event.
<span class='linenumber'> 61</span>  * @description called when the document receives a mousedown event.
<span class='linenumber'> 62</span>  */</span><span class="WHIT">
<span class='linenumber'> 63</span> </span><span class="NAME">APE.widget.Calendar.blurHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 64</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget.Calendar.getByNode</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 65</span> 
<span class='linenumber'> 66</span> </span><span class="WHIT">    </span><span class="COMM">// A delay window here to cancel focus from the mousedown handler.</span><span class="WHIT">
<span class='linenumber'> 67</span> </span><span class="WHIT">    </span><span class="COMM">// ideally, we could check e.explicitOriginalTarget, </span><span class="WHIT">
<span class='linenumber'> 68</span> </span><span class="WHIT">    </span><span class="COMM">// and that actually works in Mozilla! But it doesn't </span><span class="WHIT">
<span class='linenumber'> 69</span> </span><span class="WHIT">    </span><span class="COMM">// work in any other browsers. Even IE's toElement </span><span class="WHIT">
<span class='linenumber'> 70</span> </span><span class="WHIT">    </span><span class="COMM">// doesn't contain the non-focusable toElement for blur.</span><span class="WHIT">
<span class='linenumber'> 71</span> </span><span class="WHIT">    </span><span class="NAME">calendar.hideTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">blurHandler</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">calendar._hide</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">||</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 72</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 73</span> 
<span class='linenumber'> 74</span> </span><span class="COMM">/**
<span class='linenumber'> 75</span>  * @param {Event} e event parameter for click event.
<span class='linenumber'> 76</span>  * @description called when calendar is clicked.
<span class='linenumber'> 77</span>  */</span><span class="WHIT">
<span class='linenumber'> 78</span> </span><span class="NAME">APE.widget.Calendar.mousedownHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 79</span> </span><span class="WHIT">    </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">||</span><span class="NAME">event</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 80</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.dom</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 81</span> </span><span class="WHIT">        </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom.Event.getTarget</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 82</span> </span><span class="WHIT">        </span><span class="NAME">calendarDiv</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 83</span> </span><span class="WHIT">        </span><span class="NAME">calendarObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'> 84</span> </span><span class="WHIT">        </span><span class="NAME">calId</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 85</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'> 86</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.className</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"ape-calendar"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 87</span> </span><span class="WHIT">        </span><span class="NAME">calendarDiv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 88</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 89</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'> 90</span> </span><span class="WHIT">        </span><span class="NAME">calendarDiv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dom.findAncestorWithClass</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ape-calendar"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 91</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'> 92</span> </span><span class="WHIT">    </span><span class="NAME">calendarObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget.Calendar.getById</span><span class="PUNC">(</span><span class="NAME">calendarDiv.id.replace</span><span class="PUNC">(</span><span class="REGX">/-calendar$/</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 93</span> </span><span class="WHIT">    </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calendarObject.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 94</span> 
<span class='linenumber'> 95</span> </span><span class="WHIT">    </span><span class="COMM">// Canceled the hide action that will be caused by blur().</span><span class="WHIT">
<span class='linenumber'> 96</span> </span><span class="WHIT">    </span><span class="NAME">calendarObject._hasFocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 97</span> </span><span class="WHIT">    </span><span class="NAME">clearTimeout</span><span class="PUNC">(</span><span class="NAME">calendarObject.hideTimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'> 98</span> 
<span class='linenumber'> 99</span> </span><span class="WHIT">    </span><span class="NAME">selectedId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-selected-day"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>100</span> 
<span class='linenumber'>101</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"b"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>102</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">selectedId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>103</span> 
<span class='linenumber'>104</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectedIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">target.firstChild.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>105</span> 
<span class='linenumber'>106</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">selectedIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>107</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>108</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">selectedId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>109</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>110</span> </span><span class="WHIT">            </span><span class="NAME">dom.removeClass</span><span class="PUNC">(</span><span class="NAME">selected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ape-calendar-selected-day"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>111</span> </span><span class="WHIT">            </span><span class="NAME">selected.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>112</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>113</span> </span><span class="WHIT">        </span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selectedId</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>114</span> </span><span class="WHIT">        </span><span class="NAME">dom.addClass</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ape-calendar-selected-day"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>115</span> </span><span class="WHIT">        </span><span class="NAME">calendarObject.setDateOfMonth</span><span class="PUNC">(</span><span class="NAME">selectedIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>116</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>117</span> </span><span class="WHIT">        </span><span class="NAME">calendarObject.onselect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>118</span> 
<span class='linenumber'>119</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">calendarObject.hideOnSelect</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>120</span> </span><span class="WHIT">            </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>121</span> </span><span class="WHIT">                </span><span class="NAME">calendarObject._hide</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>122</span> </span><span class="WHIT">                </span><span class="NAME">calendarObject._hasFocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>123</span> </span><span class="WHIT">                </span><span class="NAME">calendarObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>124</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">115</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>125</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>126</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>127</span> </span><span class="WHIT">    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>128</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newDate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">calendarObject.displayDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>129</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-next-year"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>130</span> </span><span class="WHIT">            </span><span class="NAME">newDate.setYear</span><span class="PUNC">(</span><span class="NAME">newDate.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>131</span> </span><span class="WHIT">            </span><span class="NAME">calendarObject.setDate</span><span class="PUNC">(</span><span class="NAME">newDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>132</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>133</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-prev-year"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>134</span> </span><span class="WHIT">            </span><span class="NAME">newDate.setYear</span><span class="PUNC">(</span><span class="NAME">newDate.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>135</span> </span><span class="WHIT">            </span><span class="NAME">calendarObject.setDate</span><span class="PUNC">(</span><span class="NAME">newDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>136</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>137</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-next-month"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>138</span> </span><span class="WHIT">            </span><span class="NAME">newDate.setMonth</span><span class="PUNC">(</span><span class="NAME">newDate.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>139</span> </span><span class="WHIT">            </span><span class="NAME">calendarObject.setDate</span><span class="PUNC">(</span><span class="NAME">newDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>140</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>141</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">target.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">calId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-prev-month"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>142</span> </span><span class="WHIT">            </span><span class="NAME">newDate.setMonth</span><span class="PUNC">(</span><span class="NAME">newDate.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>143</span> </span><span class="WHIT">            </span><span class="NAME">calendarObject.setDate</span><span class="PUNC">(</span><span class="NAME">newDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>144</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>145</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>146</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>147</span> 
<span class='linenumber'>148</span> </span><span class="NAME">APE.widget.Calendar.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>149</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>150</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>151</span>      * Days in months. JavaScript Date object does not provide this.
<span class='linenumber'>152</span>      * @type {[number]}
<span class='linenumber'>153</span>      */</span><span class="WHIT">
<span class='linenumber'>154</span> </span><span class="WHIT">    </span><span class="NAME">days</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">28</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">30</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">30</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">30</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">,</span><span class="NUMB">30</span><span class="PUNC">,</span><span class="NUMB">31</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>155</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>156</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>157</span>      * @type {boolean} 
<span class='linenumber'>158</span>      * @description set to &lt;code>true&lt;/code> to hide the calendar when a
<span class='linenumber'>159</span>      * date is selected.
<span class='linenumber'>160</span>      */</span><span class="WHIT">
<span class='linenumber'>161</span> </span><span class="WHIT">    </span><span class="NAME">hideOnSelect</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>162</span> 
<span class='linenumber'>163</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>164</span>      * This can generally be ignored.
<span class='linenumber'>165</span>      * Initializes events for calendar. If Calendar's html is regenerated (via innerHTML)
<span class='linenumber'>166</span>      * then call this method when calendar HTML is generated. 
<span class='linenumber'>167</span>      */</span><span class="WHIT">
<span class='linenumber'>168</span> </span><span class="WHIT">    </span><span class="NAME">initEvents</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>169</span> 
<span class='linenumber'>170</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getElementById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>171</span> </span><span class="WHIT">            </span><span class="NAME">Calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget.Calendar</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>172</span> </span><span class="WHIT">            </span><span class="NAME">EventPublisher</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.EventPublisher</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>173</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='linenumber'>174</span> </span><span class="WHIT">        </span><span class="NAME">EventPublisher.add</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"onfocus"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Calendar.focusHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>175</span> </span><span class="WHIT">        </span><span class="NAME">EventPublisher.add</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"onblur"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Calendar.blurHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>176</span> 
<span class='linenumber'>177</span> </span><span class="WHIT">        </span><span class="COMM">// IE needs this because if calendar is </span><span class="WHIT">
<span class='linenumber'>178</span> </span><span class="WHIT">        </span><span class="COMM">// not shown at pg load time, and input has focus,</span><span class="WHIT">
<span class='linenumber'>179</span> </span><span class="WHIT">        </span><span class="COMM">// onfocus won't fire when user clicks input.</span><span class="WHIT">
<span class='linenumber'>180</span> </span><span class="WHIT">        </span><span class="NAME">EventPublisher.add</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"onclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Calendar.focusHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>181</span> </span><span class="WHIT">        </span><span class="NAME">EventPublisher.add</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"onmousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Calendar.documentMouseDownHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>182</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>183</span> 
<span class='linenumber'>184</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>185</span>      * @type {String}
<span class='linenumber'>186</span>      * @description the &lt;code>id&lt;/code> of the Calendar instance (also the 
<span class='linenumber'>187</span>      * same as the html &lt;code>input&lt;/code> element.
<span class='linenumber'>188</span>      */</span><span class="WHIT">
<span class='linenumber'>189</span> </span><span class="WHIT">    </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>190</span> </span><span class="WHIT">    </span><span class="NAME">calendarId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>191</span> 
<span class='linenumber'>192</span> </span><span class="WHIT">    </span><span class="NAME">hiddenDayClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ape-calendar-empty-day'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>193</span> </span><span class="WHIT">    </span><span class="NAME">calendarClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'ape-calendar'</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>194</span> 
<span class='linenumber'>195</span> </span><span class="WHIT">    </span><span class="COMM">/** @internal */</span><span class="WHIT">
<span class='linenumber'>196</span> </span><span class="WHIT">    </span><span class="NAME">_isHidden</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>197</span> 
<span class='linenumber'>198</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>199</span>      * Shows the calendar. The first time this is called, 
<span class='linenumber'>200</span>      * the selectedDate is initialized.
<span class='linenumber'>201</span>      * @param {Event} e the DOM Event the triggered the action.
<span class='linenumber'>202</span>      * @fires onshow
<span class='linenumber'>203</span>      * @private
<span class='linenumber'>204</span>      */</span><span class="WHIT">
<span class='linenumber'>205</span> </span><span class="WHIT">    </span><span class="NAME">_show</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>206</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>207</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>208</span> </span><span class="WHIT">            </span><span class="NAME">calStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calendar.style</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>209</span> </span><span class="WHIT">            </span><span class="NAME">activeCal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.constructor.activeCalendar</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>210</span> 
<span class='linenumber'>211</span> </span><span class="WHIT">        </span><span class="NAME">this._isHidden</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>212</span> 
<span class='linenumber'>213</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">activeCal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>214</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">activeCal</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>215</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT">
<span class='linenumber'>216</span> </span><span class="WHIT">                </span><span class="NAME">activeCal._hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>217</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>218</span> 
<span class='linenumber'>219</span> </span><span class="WHIT">        </span><span class="NAME">this.position</span><span class="PUNC">(</span><span class="NAME">calStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>220</span> </span><span class="WHIT">        </span><span class="NAME">this.constructor.activeCalendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>221</span> </span><span class="WHIT">        </span><span class="NAME">this.show</span><span class="PUNC">(</span><span class="NAME">calStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>222</span> </span><span class="WHIT">        </span><span class="NAME">this.onshow</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>223</span> 
<span class='linenumber'>224</span> </span><span class="WHIT">        </span><span class="NAME">this.setDate</span><span class="PUNC">(</span><span class="NAME">this.displayDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>225</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>226</span> 
<span class='linenumber'>227</span> </span><span class="WHIT">    </span><span class="COMM">/** Positions the calendar just below the 
<span class='linenumber'>228</span>      * input using APE.dom.getOffsetCoords.
<span class='linenumber'>229</span>      * @param {CSSStyleDeclaration} calStyle the caledar element's style.
<span class='linenumber'>230</span>      */</span><span class="WHIT">
<span class='linenumber'>231</span> </span><span class="WHIT">    </span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">calStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>232</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>233</span> </span><span class="WHIT">            </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.dom.getOffsetCoords</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>234</span> </span><span class="WHIT">        </span><span class="NAME">calStyle.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>235</span> </span><span class="WHIT">        </span><span class="NAME">calStyle.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">input.offsetHeight</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>236</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>237</span> 
<span class='linenumber'>238</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>239</span>      * Shows the calendar by setting visibility to 'visible'.
<span class='linenumber'>240</span>      * @param {CSSStyleDeclaration} calStyle the caledar element's style.
<span class='linenumber'>241</span>      */</span><span class="WHIT">
<span class='linenumber'>242</span> </span><span class="WHIT">    </span><span class="NAME">show</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">calStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>243</span> </span><span class="WHIT">        </span><span class="NAME">calStyle.visibility</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"visible"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>244</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>245</span> 
<span class='linenumber'>246</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>247</span>      * Hides the calendar.
<span class='linenumber'>248</span>      * @param {Event} e the DOM Event the triggered the action.
<span class='linenumber'>249</span>      * @fires onhide(e)
<span class='linenumber'>250</span>      */</span><span class="WHIT">
<span class='linenumber'>251</span> </span><span class="WHIT">    </span><span class="NAME">_hide</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>252</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isHidden</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>253</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._hasFocus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>254</span> 
<span class='linenumber'>255</span> </span><span class="WHIT">        </span><span class="NAME">this.onhide</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>256</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.constructor.activeCalendar</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>257</span> </span><span class="WHIT">            </span><span class="NAME">this.constructor.activeCalendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>258</span> </span><span class="WHIT">        </span><span class="NAME">this.hide</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>259</span> </span><span class="WHIT">        </span><span class="NAME">this._isHidden</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>260</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>261</span> 
<span class='linenumber'>262</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>263</span>      * Hides the calendar by setting visibility to "hidden"
<span class='linenumber'>264</span>      * @param {CSSStyleDeclaration} calStyle the calendar element's style.
<span class='linenumber'>265</span>      * @private
<span class='linenumber'>266</span>      */</span><span class="WHIT">
<span class='linenumber'>267</span> </span><span class="WHIT">    </span><span class="NAME">hide</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">calStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>268</span> </span><span class="WHIT">        </span><span class="NAME">calStyle.visibility</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>269</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>270</span> 
<span class='linenumber'>271</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>272</span>      * @event 
<span class='linenumber'>273</span>      * @description fires immediately after visibility has been set to "visible" 
<span class='linenumber'>274</span>      * in show();
<span class='linenumber'>275</span>      */</span><span class="WHIT">
<span class='linenumber'>276</span> </span><span class="WHIT">    </span><span class="NAME">onshow</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>277</span> 
<span class='linenumber'>278</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>279</span>      * @event 
<span class='linenumber'>280</span>      * @description fires immediately after visibility has been set to "hidden" 
<span class='linenumber'>281</span>      * in hide();
<span class='linenumber'>282</span>      */</span><span class="WHIT">
<span class='linenumber'>283</span> </span><span class="WHIT">    </span><span class="NAME">onhide</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>284</span> 
<span class='linenumber'>285</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>286</span>      * @event 
<span class='linenumber'>287</span>      * @description a date was selected.
<span class='linenumber'>288</span>      */</span><span class="WHIT">
<span class='linenumber'>289</span> </span><span class="WHIT">    </span><span class="NAME">onselect</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>290</span> 
<span class='linenumber'>291</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>292</span>      * creates the HTML used for the calendar.
<span class='linenumber'>293</span>      */</span><span class="WHIT">
<span class='linenumber'>294</span> </span><span class="WHIT">    </span><span class="NAME">create</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>295</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>296</span> 
<span class='linenumber'>297</span> </span><span class="WHIT">        </span><span class="NAME">this.calendarId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-calendar"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>298</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>299</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>300</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d.getElementById</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>301</span> 
<span class='linenumber'>302</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>303</span> </span><span class="WHIT">            </span><span class="NAME">join</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array.prototype.join</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>304</span> </span><span class="WHIT">            </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">join.call</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;td>&lt;b>&nbsp;&lt;/b>&lt;/td>"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>305</span> </span><span class="WHIT">            </span><span class="NAME">trs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">join.call</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;tr>"</span><span class="PUNC">+</span><span class="NAME">td</span><span class="PUNC">+</span><span class="STRN">"&lt;/tr>\n"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>306</span> </span><span class="WHIT">            </span><span class="NAME">widget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>307</span> </span><span class="WHIT">            </span><span class="NAME">Locale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">widget.CalendarLocale</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>308</span> </span><span class="WHIT">            </span><span class="NAME">dayNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Locale.days.abbr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>309</span> </span><span class="WHIT">            </span><span class="NAME">calendarBody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;tbody>"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">trs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&lt;/tbody>"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>310</span> </span><span class="WHIT">            </span><span class="NAME">calendarHead</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;thead>"</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>311</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;tr class='calendar-button-row'>&lt;th id='"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-prev-year' title='"</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>312</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Locale.previousYear</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'>&#x00ab;&lt;/th>"</span><span class="WHIT">
<span class='linenumber'>313</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;th id='"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-prev-month' title='"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Locale.previousMonth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'>&#x2039;&lt;/th>"</span><span class="WHIT">
<span class='linenumber'>314</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;th colspan='3' class='ape-calendar-header'>&lt;div id='"</span><span class="PUNC">+</span><span class="NAME">this.calendarId</span><span class="PUNC">+</span><span class="STRN">"-header'"</span><span class="WHIT">
<span class='linenumber'>315</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">">&nbsp;&lt;/div>&lt;/th>"</span><span class="WHIT">
<span class='linenumber'>316</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;th id='"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-next-month' title='"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Locale.nextMonth</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>317</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"' class='"</span><span class="PUNC">+</span><span class="NAME">this.calendarClass</span><span class="PUNC">+</span><span class="STRN">"-days'>&#x203A;&lt;/th>"</span><span class="WHIT">
<span class='linenumber'>318</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;th id='"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-next-year' title='"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Locale.nextYear</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'>&#x00bb;&lt;/th>&lt;/tr>"</span><span class="WHIT">
<span class='linenumber'>319</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;tr>&lt;th>"</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>320</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dayNames.join</span><span class="PUNC">(</span><span class="STRN">"&lt;/th>&lt;th>"</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>321</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&lt;/th>&lt;/tr>"</span><span class="WHIT">
<span class='linenumber'>322</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">"&lt;/thead>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>323</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='linenumber'>324</span> </span><span class="WHIT">        </span><span class="NAME">calendar.onselectstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.returnFalse</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>325</span> </span><span class="WHIT">        </span><span class="NAME">calendar.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">"&lt;table>"</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>326</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">calendarHead</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">calendarBody</span><span class="WHIT">
<span class='linenumber'>327</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&lt;/table>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>328</span> </span><span class="WHIT">        </span><span class="NAME">calendar.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.calendarId</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>329</span> </span><span class="WHIT">        </span><span class="NAME">calendar.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.calendarClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>330</span> </span><span class="WHIT">        </span><span class="NAME">calendar.onmousedown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calendar.onfocus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">widget.Calendar.mousedownHandler</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>331</span> </span><span class="WHIT">        </span><span class="NAME">d.body.appendChild</span><span class="PUNC">(</span><span class="NAME">calendar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>332</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>333</span> 
<span class='linenumber'>334</span> </span><span class="WHIT">    </span><span class="NAME">returnFalse</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>335</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>336</span>      * Sets the date of the month. 
<span class='linenumber'>337</span>      */</span><span class="WHIT">
<span class='linenumber'>338</span> </span><span class="WHIT">    </span><span class="NAME">setDateOfMonth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dateOfMonth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>339</span> </span><span class="WHIT">        </span><span class="NAME">this.displayDate.setDate</span><span class="PUNC">(</span><span class="NAME">dateOfMonth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>340</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">formatted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.formatDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>341</span> </span><span class="WHIT">        </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">formatted</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>342</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>343</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>344</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>345</span>      * @return {Date} a copy of the internal Date 
<span class='linenumber'>346</span>      * representing calendar's currently selected date.
<span class='linenumber'>347</span>      */</span><span class="WHIT">
<span class='linenumber'>348</span> </span><span class="WHIT">    </span><span class="NAME">getDate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>349</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">this.displayDate</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>350</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>351</span> 
<span class='linenumber'>352</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='linenumber'>353</span>      * formats the date in default of MM dd, yyyy. Looks like 
<span class='linenumber'>354</span>      * January 4, 2009.
<span class='linenumber'>355</span>      * Override this to format &lt;code>this.selectedDate&lt;/code>.
<span class='linenumber'>356</span>      */</span><span class="WHIT">
<span class='linenumber'>357</span> </span><span class="WHIT">    </span><span class="NAME">formatDate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>358</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">APE.widget.CalendarLocale.months.abbr</span><span class="PUNC">[</span><span class="NAME">this.displayDate.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT">
<span class='linenumber'>359</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.displayDate.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>360</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="STRN">", "</span><span class="WHIT">  </span><span class="WHIT">
<span class='linenumber'>361</span> </span><span class="WHIT">            </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.displayDate.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>362</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>363</span> 
<span class='linenumber'>364</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='linenumber'>365</span>      * Sets the internal date object represented by the calendar.
<span class='linenumber'>366</span>      * @internal
<span class='linenumber'>367</span>      */</span><span class="WHIT">
<span class='linenumber'>368</span> </span><span class="WHIT">    </span><span class="NAME">setDate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">date</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>369</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>370</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">APE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.APE</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>371</span> </span><span class="WHIT">            </span><span class="NAME">CalendarLocale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.widget.CalendarLocale</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>372</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">CalendarLocale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Missing Resource: APE.widget.CalendarLocale"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>373</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='linenumber'>374</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curDate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>375</span> </span><span class="WHIT">            </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>376</span> </span><span class="WHIT">            </span><span class="NAME">year</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">date.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>377</span> </span><span class="WHIT">            </span><span class="NAME">month</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">date.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>378</span> </span><span class="WHIT">            </span><span class="NAME">monthName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CalendarLocale.months.full</span><span class="PUNC">[</span><span class="NAME">month</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>379</span> </span><span class="WHIT">            </span><span class="NAME">daysInMonth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.days</span><span class="PUNC">[</span><span class="NAME">month</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>380</span> </span><span class="WHIT">            </span><span class="NAME">firstDayOfMonth</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>381</span> </span><span class="WHIT">            </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>382</span> </span><span class="WHIT">            </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>383</span> </span><span class="WHIT">            </span><span class="NAME">isLeapYear</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">year</span><span class="PUNC">%</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">year</span><span class="PUNC">%</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">year</span><span class="PUNC">%</span><span class="NUMB">400</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>384</span> </span><span class="WHIT">            </span><span class="NAME">calendar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getElementById</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>385</span> </span><span class="WHIT">            </span><span class="NAME">tbody</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calendar.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"table"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tBodies</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>386</span> </span><span class="WHIT">            </span><span class="NAME">dayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tbody.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"b"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>387</span> </span><span class="WHIT">            </span><span class="NAME">textContent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"textContent"</span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">calendar</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"textContent"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"innerText"</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>388</span> </span><span class="WHIT">            </span><span class="NAME">calendarHeader</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getElementById</span><span class="PUNC">(</span><span class="NAME">this.calendarId</span><span class="PUNC">+</span><span class="STRN">"-header"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>389</span> </span><span class="WHIT">            </span><span class="NAME">dom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">APE.dom</span><span class="PUNC">,</span><span class="WHIT">
<span class='linenumber'>390</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>391</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='linenumber'>392</span> </span><span class="WHIT">        </span><span class="NAME">firstDayOfMonth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">date</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>393</span> </span><span class="WHIT">        </span><span class="NAME">firstDayOfMonth.setDate</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>394</span> </span><span class="WHIT">        </span><span class="NAME">firstDayOfMonth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstDayOfMonth.getDay</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>395</span> 
<span class='linenumber'>396</span> </span><span class="WHIT">        </span><span class="NAME">calendarHeader.firstChild.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">year</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">", "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">monthName</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>397</span> 
<span class='linenumber'>398</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">month</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isLeapYear</span><span class="PUNC">)</span><span class="WHIT">
<span class='linenumber'>399</span> </span><span class="WHIT">            </span><span class="NAME">daysInMonth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>400</span> 
<span class='linenumber'>401</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">firstDayOfMonth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>402</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>403</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="PUNC">[</span><span class="NAME">textContent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>404</span> </span><span class="WHIT">            </span><span class="NAME">dayElement.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hiddenDayClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>405</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>406</span> </span><span class="WHIT">        </span><span class="COMM">// Fill in days.</span><span class="WHIT">
<span class='linenumber'>407</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">daysInMonth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>408</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>409</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="PUNC">[</span><span class="NAME">textContent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>410</span> </span><span class="WHIT">            </span><span class="NAME">dayElement.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>411</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>412</span> 
<span class='linenumber'>413</span> </span><span class="COMM">//        alert(dayElements.length + ", " + i + ", " + j);</span><span class="WHIT">
<span class='linenumber'>414</span> 
<span class='linenumber'>415</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstDayOfMonth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">daysInMonth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>416</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>417</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="PUNC">[</span><span class="NAME">textContent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>418</span> </span><span class="WHIT">            </span><span class="NAME">dayElement.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hiddenDayClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>419</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>420</span> 
<span class='linenumber'>421</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.getElementById</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-selected-day"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>422</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">selected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>423</span> </span><span class="WHIT">            </span><span class="NAME">selected.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>424</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>425</span> 
<span class='linenumber'>426</span> </span><span class="WHIT">        </span><span class="COMM">// Need to hilite current day.</span><span class="WHIT">
<span class='linenumber'>427</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">curDate.getYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">date.getYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">curDate.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">date.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>428</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentDay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstDayOfMonth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">curDate.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>429</span> </span><span class="WHIT">            </span><span class="NAME">this.currentDayIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentDay</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>430</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">day</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements</span><span class="PUNC">[</span><span class="NAME">currentDay</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>431</span> </span><span class="WHIT">            </span><span class="NAME">dom.addClass</span><span class="PUNC">(</span><span class="NAME">day</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.calendarClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-today"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>432</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>433</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">date.getYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">date.getYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='linenumber'>434</span> </span><span class="WHIT">            </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">date.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">date.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='linenumber'>435</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectedDayIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstDayOfMonth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">date.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>436</span> </span><span class="WHIT">            </span><span class="NAME">dayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dayElements</span><span class="PUNC">[</span><span class="NAME">selectedDayIndex</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>437</span> </span><span class="WHIT">            </span><span class="NAME">dom.addClass</span><span class="PUNC">(</span><span class="NAME">dayElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.calendarClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-selected-day"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>438</span> </span><span class="WHIT">            </span><span class="NAME">dayElement.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-selected-day"</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>439</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>440</span> </span><span class="WHIT">        </span><span class="NAME">this.displayDate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">date</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='linenumber'>441</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='linenumber'>442</span> </span><span class="PUNC">}</span><span class="PUNC">;</span></pre></body></html>