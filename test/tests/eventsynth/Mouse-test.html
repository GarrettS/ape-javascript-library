<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
    <title>Mouse test</title>
    
    <script src="../../../build/ape-ep-dom.js" type="text/javascript"></script>
    <script src="../../../build/eventsynth/Mouse.js" type="text/javascript"></script>
    <script src="../../../build/test/TestRunner.js" type="text/javascript"></script>
    <script src="../../../build/test/TestReporter.js" type="text/javascript"></script>
    <script src="../../../build/test/Assert.js" type="text/javascript"></script>
    <script src="../../../build/test/NativeConstraints.js" type="text/javascript"></script>
    
    <link type="text/css" rel="stylesheet" href="../../../build/test/css/TestReporter.css">
    
</head>
<body style="margin: 0">
<div id="shim" style="height: 3000px;float: left"></div>
<div id="testNode" style="height: 200px; position: relative; background: #ccf">-</div>
<script type="text/javascript">
function testMouse() {
    var test = APE.test,
        Assert = test.Assert,
        cond = test.NativeConstraints,
        testRunner = test.TestRunner.getById("TestRunner"),
        Mouse = APE.eventsynth.Mouse,
        Constraints = test.NativeConstraints,
        testNode = document.getElementById("testNode");

    var mouseTestCase = {

        name : "click testcase",

        tearDown : function() {
            window.scrollTo(0, 0);
            testNode.onclick = testNode.onmousedown = testNode.onmouseup = 
                testNode.onmouseover = testNode.onmouseout = testNode.onmousemove;
        },
        
        'test target' : function() {
        	var target;
        	testNode.onclick = function(ev) {
        		target = ev ? ev.target : window.event.srcElement;
        	};
        	Mouse.click(testNode);
            Assert.that(Constraints.areSame(target, testNode));
        },
        
        'test pageY where pageY is present' : function() {
            var pageY;
            testNode.onclick = function(ev) {
            	if(ev) {
                   pageY = ev.pageY;
            	}
            };
            window.scrollTo(10, 10);
            // Assertion delayed for Opera and IE which do update 
            // pageXOffset/scrollTop asynchronously.
           	this.wait(function() {
                Mouse.click(testNode, {clientY : 10} );
                if(typeof pageY == "number") {
                    Assert.that(Constraints.areSame(pageY, 20));
                }
           	}, 100);
        },
        
        'test offsetY where offsetY is present' : function() {
        	var offsetY;
        	testNode.onclick = function(ev) {
            	offsetY = ev && ev.offsetY;
            };
            window.scrollTo(0, 10);
            
            if(typeof offsetY == "number") {
                this.wait(function() {
                    Mouse.click(testNode, {clientY : 10} );
                    Assert.that(Constraints.areSame(offsetY, 20));
                }, 100);
            }
        },
        
        'test toElement where present' : function() {
            var toElement = 1;
            testNode.onmouseover = function(ev) {
                if(window.event) {
                    toElement = window.event.toElement;
                }
            };
            Mouse.mouseover(testNode, {relatedTarget : document.body} );
            if(typeof toElement !== "number") {
                Assert.that(Constraints.areSame(toElement, testNode));
            }
        }        
    };
    
    var testReporter = new APE.test.TestReporter(testRunner);
    testRunner.addTestCase(mouseTestCase);
    testRunner.start();
};

testMouse();
</script>
</body>