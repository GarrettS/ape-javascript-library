<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
    <title>Drag Test</title>

    <link rel="stylesheet" type="text/css" href="../../yui-test/build/logger/assets/logger.css">
    <link rel="stylesheet" type="text/css" href="../../yui-test/build/yuitest/assets/yuitest.css">
    <link rel="stylesheet" type="text/css" href="../../yui-test/assets/testlogger.css">

    <script type="text/javascript" src="../../yui-test/build/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../../yui-test/build/logger/logger.js"></script>
    <script type="text/javascript" src="../../yui-test/build/yuitest/yuitest-beta.js"></script>

    <!-- script type="text/javascript" src="../../../build/ape-ep-dom.js"></script-->
    <script type="text/javascript" src="../../../build/APE.js"></script>
    <script type="text/javascript" src="../../../build/EventPublisher.js"></script>
    <script type="text/javascript" src="../../../build/dom/dom.js"></script>
    <script type="text/javascript" src="../../../build/dom/Event-coords.js"></script>
    <script type="text/javascript" src="../../../build/dom/getContainingBlock.js"></script>
    <script type="text/javascript" src="../../../build/dom/getPixelCoords.js"></script>
    <script type="text/javascript" src="../../../build/drag/Draggable.js"></script>
</head>
<body style="position:relative;">
<div id="testLogger"></div>
<div id="template" style="height: 100%; width: 100%;">
    <div id="testNode" style="position: relative; width: 200px" tabIndex="0">drag me.</div>
    <div id="testNode2" style="position: relative; width: 200px" tabIndex="0">drag me.</div>
    <div id="testNode3" style="position: relative; width: 200px" tabIndex="0">drag me.</div>
</div>
<script type="text/javascript">
setTimeout(function(){

// window.focus() seems to fix false failures 
// with testNode.focus() not taking effect.
try {
  self.focus();
} catch(ex) { }
// fix for broken pageX in initMouseEvent
document.body.style.margin= "0";

var MOUSE_MOVE_TEST_WARNING = "Please keep your mouse offscreen and don't move it.",
    ESC = 27;

var Assert = YAHOO.util.Assert,
    StringAssert = YAHOO.util.StringAssert,
    ArrayAssert = YAHOO.util.ArrayAssert,
    dom = APE.dom,
    Action = YAHOO.util.UserAction,
    EventPublisher = APE.EventPublisher,
    TestRunner = YAHOO.tool.TestRunner,
    Draggable = APE.drag.Draggable,
    sClass = "s",
    aClass = "a",
    testNode = document.getElementById('testNode'),
    testNode2 = document.getElementById('testNode2'),
    template = document.getElementById('template'),
    templateHTML = template.innerHTML,
    oldBodyCssText = document.body.style.cssText;

var draggableTestCase = new YAHOO.tool.TestCase({

    name : "Draggable Test Case",

    // pageX broken, so all tests test target from 0, 0.

    tearDown : function() {
        Draggable.instanceDestructor();
        Draggable.instanceDestructor.call(APE.drag.DropTarget);
        testNode.className = "";
        template.innerHTML = templateHTML;
        document.body.style.cssText = oldBodyCssText;

        // otherwise the test puts the Draggable into 
        // a weird state.
        Action.mousedown(document, {clientX: 330, clientY: 330});
        Action.mouseup(document, {clientX: 330, clientY: 330});
        testNode = document.getElementById('testNode');
        testNode2 = document.getElementById('testNode2');

        document.documentElement.style.cssText = "";
    },
    
    testMouseup : function() {
        // should not throw error.
        Draggable.getByNode( testNode ); // to kick off "init events in Draggable".
        Action.mousedown( document.body, {clientX: 330, clientY: 330} );
        Action.mouseup( document.body, {clientX: 330, clientY: 330} );
    },

    _should : {
        ignore : {
        // Safari 2 issue: pageX.
            testYuiTestMouseMove : true
        }        
    },
    
    testSelect : function() {
        
        testNode.className = "orig";
        
        var d = Draggable.getByNode( testNode ),
            gotFocus = gotMousedown = false;
        d.activeDragClassName = aClass;
        d.selectedClassName = sClass;

        EventPublisher.add( testNode, "onmousedown", function(){
            gotMousedown = true;
        });

        Action.mousedown( testNode );
        Action.mouseup( testNode );

        this.wait(function(){
            
            Assert.isTrue( gotMousedown, "testNode didn't get mousedown" );

            // in case focus was somehow lost.
            Action.mousedown( testNode );
            StringAssert.contains( sClass, testNode.className, 
                    'should have selection' );
            StringAssert.doesNotContain( aClass, testNode.className, 
                    MOUSE_MOVE_TEST_WARNING );

            this.wait(function(){
                Action.mousedown( document );

                this.wait(function(){
                    this.wait(function(){                        
                        Assert.areEqual( "orig", testNode.className,
                                'testNode should NOT have selection' );
                    }, 78);
                }, 78);
            }, 78);
        }, 78);

    },
    
    testDragStart : function() {
        
        var d = Draggable.getByNode( testNode ),
            ds = false,
            bds = false;

        d.activeDragClassName = aClass;
        d.ondragstart = function() {
            ds = true;
        };

        d.onbeforedragstart = function() {
            bds = true;
        };
        if(testNode.focus)
            testNode.focus();

        Assert.isFalse( ds, "drag start should not have fired." );
        Action.mousedown( testNode );
        Assert.isTrue( bds, "onbeforedrag start should not have fired." );

        Assert.isFalse( ds, "drag start <em>still<\/em> should not have fired." );

        //screenX, screenY, clientX, clientY, altKey, ctrlKey, shiftKey, metaKey
        Action.mousemove( document );
        Action.mousemove( document, {clientX:101} );

        Assert.isTrue( ds, "now drag start should have fired." );
        StringAssert.contains( aClass, testNode.className );
        Action.mouseup(document);
    },

    testDragClone : function() {
        var d = Draggable.getByNode( testNode ),
            ds = false,
            bds = false,
            left = testNode.style.left,
            top = testNode.style.top;

        d.activeDragClassName = aClass;
        d.dragCopy = true;

        Action.mousedown( testNode );

        Action.mousemove( document, {clientX:101} );
        this.wait(function(){
	        Action.mousemove( document, {clientX:101} );
	
	        Assert.areEqual(left, testNode.style.left);
	        Assert.areEqual(top, testNode.style.top);
	        StringAssert.doesNotContain( aClass, testNode.className );        
	        StringAssert.contains( aClass, d.el.className );        
	        Action.mouseup(document);
        }, 78);
    },

    testDisable : function() {
        var d = Draggable.getByNode( testNode ),
            ds = false,
            bds = false,
            left = testNode.style.left,
            top = testNode.style.top;

        d.isDragEnabled = false;

        if(testNode.focus)
            testNode.focus();

        Action.mousedown( testNode );
        
        Action.mousemove( document );
        Action.mousemove( document, {clientX:101} );

        Assert.areEqual(left, testNode.style.left);
        Assert.areEqual(top, testNode.style.top);
        StringAssert.doesNotContain( aClass, testNode.className );        
        Action.mouseup(document);
    },


    testToString : function() {
        var d = Draggable.getByNode( testNode );
        Assert.isString(d.toString());
    },

    testYuiTestMouseMove : function(){
        var expected = 10,
        actual;
	    function cb(ev){
	        ev = ev||event;
	        actual = ev.pageX;
	    }
	    document.onmousemove = cb;
	    Action.mousemove(document, {clientX: expected});
	    Assert.areEqual(expected, actual, "pageX issue.");
    },
    
    testConstraintHorz : function() {

        var d = Draggable.getByNode( testNode );
        d.moveToY = function(){};
        
        var coords = dom.getOffsetCoords( testNode ),
            moveToCoords = {clientX:83, clientY:111};
        
        Action.mousedown( testNode, {clientX: 0, clientY: 0} );
        Action.mousemove( document, moveToCoords );

        // Threshold is 25ms (so wait for it to kick in).
        this.wait(function() {
            Action.mousemove( document, moveToCoords );
            this.wait(function(){
                Action.mousemove( document, moveToCoords );
	            var coords2 = dom.getOffsetCoords( testNode );
	            Assert.areEqual( 83, coords2.x, "x wrong" );
	            Assert.areEqual( coords.y, coords2.y, 
	                    "y pos should not have changed." );
	        }, 78);
        }, 110);
    },

    testConstraintVert : function() {

        document.body.style.height="300px";
        var d = Draggable.getByNode( testNode );
        d.moveToX = function(){};
        
        var coords = dom.getOffsetCoords( testNode );
        
        Action.mousedown( testNode, {clientX: 0, clientY: 0} );

        
        Action.mousemove( document, {clientX:1, clientY:1} );
        this.wait(function() {
	        Action.mousemove( document, {clientX:221, clientY:111} );

	        var coords2 = dom.getOffsetCoords( testNode );
	    
	        Assert.areEqual( 111, coords2.y, "y coords wrong" );
	        Assert.areEqual( coords.x, coords2.x, "x pos should not have changed." );
	    }, 78);
    },

    testFromBottom : function() {

        document.body.style.height="300px";
        document.body.style.width ="500px";
        document.documentElement.style.fontSize = "0";
        document.documentElement.style.letterSpacing = "-10px";
        
        testNode.style.bottom = testNode.style.right = "0";
        testNode.style.position = "absolute";
        testNode.style.width = "120px";

        
        // Simple way to set top/left.
        testNode.style.top= testNode.offsetTop + "px";
        testNode.style.left= testNode.offsetLeft +"px";
        
        var d = Draggable.getByNode( testNode );

        var coords = dom.getOffsetCoords( testNode ),
            expectedTop = 300 - testNode.offsetHeight,
            expectedLeft = document.body.offsetWidth - testNode.offsetWidth;

        // Make sure the coords are correct.
        Assert.areEqual( expectedTop, coords.y, 'coords y was wrong' );
        Assert.areEqual( expectedLeft, coords.x, 'coords x was wrong' );

        var dv = document.defaultView,
            el = testNode,
            s = el.style,
            cs = (dv && dv.getComputedStyle && dv.getComputedStyle(el,"")) 
                || el.currentStyle,

            // If this throws an error in IE, it means failure of _setIeTopLeft();
            top = testNode.style.top || cs.top,
            left = testNode.style.left || cs.left;
        Assert.areEqual( expectedTop, parseInt(top), 'style.top was wrong' );
        Assert.areEqual( expectedLeft, parseInt(left), 'style.left was wrong' );       
    },

    testSetHandle : function() {
        
        var handle = document.createElement("div");
        
        testNode.appendChild( handle );

        var ts = testNode.style;
        ts.width = ts.height = "440px";
        ts.left = ts.top = '0';

        document.body.style.width = "900px";
        document.body.style.height = "900px";
        
        handle.style.height = "20px";
        handle.id = "handle";

        var d = Draggable.getByNode( testNode );
        
        d.setHandle( handle );

        Action.mousedown(handle);

        if(testNode.focus)
            testNode.focus();
        var coords = {clientX: 33, clientY: 55};
        Action.mousemove(document, coords);
        this.wait(function(){
	        Action.mousemove( document, coords);
	
	        Assert.areEqual( 33, parseInt(testNode.style.left), "left was wrong");
	        Assert.areEqual( 55, parseInt(testNode.style.top), "top was wrong");
        }, 40);
    },

    testSetHandleFail : function() {
        
        var handle = document.createElement("div");
        
        testNode.appendChild( handle );

        var ts = testNode.style;
        ts.width = ts.height = "440px";
        ts.left = ts.top = '0';

        document.body.style.width = "900px";
        document.body.style.height = "900px";
        
        handle.style.height = "20px";
        handle.style.top = "20px";

        var d = Draggable.getByNode( testNode );
        
        d.setHandle( handle );

        Action.mousedown(testNode);
        Action.mousemove(document);
        Action.mousemove( document, {clientX: 33, clientY: 55} );

        Assert.areEqual( 0, parseInt(testNode.style.left), "left was not 0");
        Assert.areEqual( 0, parseInt(testNode.style.top), "top was not 0");
    },

    testAutomaticDeselection : function() {
        var d = Draggable.getByNode( testNode ),
        d2 = Draggable.getByNode( testNode2 );
        d.dragMultiple = true;
        d.selectedClassName = d2.selectedClassName = sClass;

        Action.mousedown( testNode );

        Assert.areEqual( sClass, testNode.className, 'testNode class should be "' + sClass +'"' );
        Action.mouseup( testNode );

        this.wait(function(){
            Action.mousedown( testNode2 );
            StringAssert.isEmpty( testNode.className, 'testNode class should be empty' );
        }, 78);
    },

    testSelectGroupFailure : function() {
        var d = Draggable.getByNode( testNode ),
        d2 = Draggable.getByNode( testNode2 );

        d.selectedClassName = d2.selectedClassName = sClass;

        if(testNode.focus)
            testNode.focus();
        Action.mousedown( testNode );

        this.wait(function(){
            Assert.areSame( sClass, testNode.className, 'testNode class wrong' );
    
            // Try to select multiple items. This attempt should fail, 
            // because dragMultiple is false!
            Action.mousedown( testNode2, {ctrlKey : true, metaKey : true} );
            
            Action.mouseup( document );
            this.wait(function(){
                Assert.areSame( sClass, testNode.className, 'testNode class wrong' );
                
                // c2 should contain nothing, because dragMultiple is false and 
                // focus was prevented by user attempting the impossible.
                StringAssert.isEmpty( testNode2.className );

                Action.mousedown( document.documentElement, {clientX: 200, clientY : 430} );
                Action.mouseup( document.documentElement, {clientX:2, clientY: 100} );
                
                this.wait(function(){
                    StringAssert.isEmpty( testNode.className, 'testNode' );
                    StringAssert.isEmpty( testNode2.className,'testNode2' );
                }, 78);
            }, 78);
        }, 78);
    },

    testSelectGroup : function() {
        test = 'testSelectGroup'
        var d = Draggable.getByNode( testNode ),
        d2 = Draggable.getByNode( testNode2 );

        d.selectedClassName = d2.selectedClassName = sClass;

        d.dragMultiple = d2.dragMultiple = true;

        if(testNode.focus)
            testNode.focus();
        Action.mousedown( testNode );

        var testNodeClass = testNode.className.split(' ');

        this.wait(function(){
            Action.mouseup(document);
            ArrayAssert.containsItems( [sClass], testNodeClass, 'testNode class incomplete' );
    
            // Try to select multiple items. This should succeed - dragMultiple = true.
            Action.mousedown( testNode2, {ctrlKey : true, metaKey : true} );
            
            Action.mouseup( document );
            this.wait(function(){

                testNodeClass = testNode.className.split(' ');
                var testNode2Class = testNode2.className.split(' ');
                ArrayAssert.containsItems( [sClass], testNodeClass, 'testNode class incomplete' );
                ArrayAssert.containsItems( [sClass], testNode2Class, 'testNode2 class incomplete' );
                                
                if(document.documentElement.focus) document.documentElement.focus();
                Action.mousedown( document.documentElement, {clientX: 200, clientY : 430} );
                Action.mouseup( document.documentElement );
                
                this.wait(function(){
                    StringAssert.isEmpty( testNode.className, 'testNode' );
                    StringAssert.isEmpty( testNode2.className,'testNode2' );
                }, 78);
            }, 78);
        }, 78);
    },
   
    testCarryGroup : function() {

        // because it is in-flow, offset by it's prev sibling (testNode).
        testNode2.style.top = "-20px";
        testNode.style.height = "20px";

        document.body.style.height = "900px"

        var d = Draggable.getByNode( testNode ),
            d2 = Draggable.getByNode( testNode2 );

        d.dragMultiple = d2.dragMultiple = true;

        Action.mousedown( testNode );
        Action.mouseup( document );
        Action.mousedown( testNode2, {ctrlKey:true, metaKey:true} );

        Action.mousemove( document, {clientX: 10, clientY: 40});

        Assert.areEqual("10px", testNode.style.left);
        Assert.areEqual("20px", testNode2.style.top);
    },

    testOnglide : function() {
        // because it is in-flow, offset by it's prev sibling (testNode).
        testNode2.style.top = "-20px";
        testNode.style.height = "20px";

        document.body.style.height = "900px"

        var d = Draggable.getByNode( testNode ),
            d2 = Draggable.getByNode( testNode2 ),
            glided = false;

        d.dragMultiple = d2.dragMultiple = true;

        d2.onglide = function() {
            glided = true;
        };

        Action.mousedown( testNode );

        Action.mouseup( document );
        Action.mousedown( testNode2, {ctrlKey:true, metaKey:true} );

        // Opera and Chrome need duplicate coords here.
        var coords = {clientX: 110, clientY: 140};
        Action.mousemove( document, coords);

        this.wait(function(){
            Action.mousemove( document, coords);
                        
            Assert.areEqual("110px", testNode.style.left);
            Assert.areEqual("120px", testNode2.style.top);
    
            Action.keydown( document, {keyCode:ESC} );
    
            this.wait(function(){
                Assert.isTrue(glided, "d did not fire onglide");
            }, 120);
        }, 78);
    },
    
    testReleaseGroup : function() {
        // because it is in-flow, offset by it's prev sibling (testNode).
        testNode2.style.top = "-20px";
        testNode.style.height = "20px";

        document.body.style.height = "900px"

        var d = Draggable.getByNode( testNode ),
            d2 = Draggable.getByNode( testNode2 ),
            glidended = false,
            testNode3 = document.getElementById("testNode3");

        d2.onglide = function() {
            glided = true;
        };

        d.dragMultiple = d2.dragMultiple = true;

        var dt = d2.addDropTarget(testNode3);

        dt.dragOverClassName = "DOC";

        testNode3.style.left = "9px";
        testNode3.style.top = "-1px";

        d.onglideend = function() {
            glidended = true;
        };


        Action.mousedown( testNode );

        Action.mouseup( document );
        Action.mousedown( testNode2, {ctrlKey:true, metaKey:true} );

        // Opera and Chrome need duplicate coords here.
        var coords = {clientX: 10, clientY: 40};
        Action.mousemove( document, coords);

        this.wait(function(){
            Action.mousemove( document, coords);
                        
	        Assert.areEqual("10px", testNode.style.left);
	        Assert.areEqual("20px", testNode2.style.top);
	
	        StringAssert.contains("DOC", dt.el.className);
	        Action.keydown( document, {keyCode:ESC} );
	
	        this.wait(function(){
	            Assert.areEqual("0px", testNode.style.left);
	            Assert.areEqual("-20px", testNode2.style.top);
	            Assert.isTrue(glidended, "d did not fire onglideend");
	            StringAssert.doesNotContain("DOC", dt.el.className);
	        }, 200);
        }, 78);
    },

    testKeepInContainerFail : function() {

        var container = document.createElement('container'),
            cstyle = container.style,
            body = document.body;

        document.body.appendChild( container );
        
        cstyle.width = cstyle.height = "100px";
        cstyle.position = "relative";

        testNode.style.width = "48px";
        testNode.style.height = "18px";
        testNode.style.border = "1px solid"; // 78 x 20.

        var d = Draggable.getByNode( testNode );

        d.container = body;
        body.style.height = body.style.width = "200px";

        Action.mousedown( testNode );
        Action.mousemove( document, {clientX : 300, clientY : 300});

    // We should be able to move an element outside its 
    // container when keepInContainer is false (default)
        Assert.areEqual( "300px", testNode.style.top, "testNode.style.top wrong");
        Assert.areEqual( "300px", testNode.style.left, "testNode.style.left wrong");

        Action.mouseup( document );
    },

    testKeepInContainer : function() {

        var container = document.createElement('div'),
            cstyle = container.style,
            body = document.body;

        document.body.appendChild( container );
        
        cstyle.width = cstyle.height = "100px";
        cstyle.position = "relative";

        testNode.style.width = "48px";
        testNode.style.height = "18px";
        testNode.style.border = "1px solid"; // 50 x 20.

        // IE 6 needs this.
        testNode.style.fontSize = "1px";

        var d = Draggable.getByNode( testNode );

        d.container = body;
        d.keepInContainer = true;
        body.style.height = body.style.width = "200px";

        Action.mousedown( testNode );

        // have to fire it twice for async testing .
        var coords = {clientX : 300, clientY : 300};
        Action.mousemove( document, coords);
        this.wait(function(){
            Action.mousemove( document, coords);
            Assert.areEqual( "180px", testNode.style.top, "testNode.style.top wrong");
            Assert.areEqual( "150px", testNode.style.left, "testNode.style.left wrong");
        }, 26);

        Action.mouseup( document );
    },

    testDropGroup : function() {
        var d = Draggable.getByNode( testNode ),
        d2 = Draggable.getByNode( testNode2 ),
        testNode3 = document.getElementById('testNode3'),
        gotDrop = false;

        d.selectedClassName = d2.selectedClassName = sClass;

        testNode3.style.position = "absolute";
        testNode3.style.top = "100px";
        testNode3.style.height = "20px";

        var dt = d.addDropTarget( testNode3);
        d2.addDropTarget( testNode3 );

        dt.ondrop = function(e) {
            if(e.dragObj.id === testNode2.id) gotDrop = true;
        };

        d.dragMultiple = d2.dragMultiple = true;

        Action.mousedown( testNode );

        this.wait(function(){
            Action.mouseup(document);
            Assert.isTrue( d.isSelected, 'd was not selected' );
    
            // Try to select multiple items. This should succeed - dragMultiple = true.
            Action.mousedown( testNode2, {ctrlKey : true, metaKey : true} );
            Action.mousemove( document, {clientX : 120, clientY : 120 } );

            this.wait(function(){
                Assert.isTrue( d.isSelected, 'd was not selected' );
                Assert.isTrue( d2.isSelected, 'd2 was not selected' );

                // Mouseup occurs right on the bottom edge of testNode3.
                Action.mouseup( document , {clientX : 120, clientY : 120} );
                Assert.isTrue(gotDrop, "testNode2 did not get drop event");
            }, 78);
        }, 78);
    },

    testDragOver : function() {

        var d = Draggable.getByNode( testNode ),
        testNode3 = document.getElementById('testNode3'),
        gotDragOver = false,
        gotDragOut = false;

        d.selectedClassName = sClass;

        testNode3.style.position = "absolute";
        testNode3.style.top = "100px";
        testNode3.style.height = "20px";

        var dt = d.addDropTarget( testNode3 );

        dt.dragOverClassName = "dragOver";
        dt.ondragover = function(e) {
            gotDragOver = (e.dragObj.id === testNode.id);
        };
        dt.ondragout = function(e) {
            gotDragOut = (e.dragObj.id === testNode.id);
        };

        if(testNode.focus)
            testNode.focus();
        Action.mousedown( testNode );
        Action.mousemove( document, {clientX : 120, clientY : 120 } );
        this.wait(function(){
            Assert.areEqual('dragOver', dt.dragOverClassName, "drag over className didn't happen.");
            Assert.isTrue( gotDragOver, "didn't get dragover.");
            Action.mouseup( document );
        }, 78);
    },

    testReleaseOverDropTarget : function() {
        var d = Draggable.getByNode( testNode ),
	        testNode3 = document.getElementById('testNode3'),
	        gotDrop = false;

        testNode3.style.position = "absolute";
        testNode3.style.top = "100px";
        testNode3.style.height = "20px";

        var dt = d.addDropTarget( testNode3);

        dt.ondrop = function(e) {
            gotDrop = true;
        };

        Action.mousedown( testNode );
        Action.mousemove( document, {clientX : 20, clientY : 20 } );

        this.wait(function(){
            Action.mousemove( document, {clientX : 20, clientY : 20 } );

            this.wait(function(){
                var ESC = 27;
                Action.keydown( document, {keyCode: ESC} );

                // Mouseup occurs right on the bottom edge of testNode3.
                Action.mouseup( document , {clientX : 20, clientY : 20} );
                this.wait(function(){
                    Assert.isFalse(gotDrop, "testNode2 did not get drop event");
                }, 100); // let it glide back, so to avoid odd state.
            }, 78);
        }, 78);
    },
    
    testRemoveDropTarget : function() {
        var d = Draggable.getByNode( testNode ),
	        testNode3 = document.getElementById('testNode3'),
	        gotDrop = false;

        testNode3.style.position = "absolute";
        testNode3.style.top = "100px";
        testNode3.style.height = "20px";

        var dt = d.addDropTarget( testNode3 );
        d.removeDropTarget( dt );
    },

    testGrab : function(){
        var dO = Draggable.getByNode( testNode ),
            testNode3 = document.getElementById('testNode3'),
            actualX, actualY,
	        grabbled = false;
        testNode.style.left = testNode.style.top = "20px";
        testNode.style.height = "20px";
        testNode.style.width = "100px";
        testNode3.style.cssText = "position: absolute; top: 0px; left: 0px;";
        testNode3.onmousedown = grabIt;
        Action.mousedown(testNode3, {clientX:0, clientY:0});
        function grabIt(ev) {
            dO.grab(ev, 10, 10);
            actualX = dO.x;
            actualY = dO.y;
        }
        // should be centered on cursor.
        Assert.areEqual(10 - 50, dO.x, "x wrong");
        Assert.areEqual(10 - 10, dO.y, "y wrong");
    }
});

// Set the TestRunner's logger by invoking a constructor
new YAHOO.tool.TestLogger("testLogger");

//for(var test in draggableTestCase) {
//    if(/^test/.test( test )) {
//        if(test !== "testConstraintHorz") {
//            delete draggableTestCase[test];   
//        }
//    }
//}

TestRunner.add( draggableTestCase );

if (parent && parent != window) {
    YAHOO.tool.TestManager.load();
} else {
    YAHOO.tool.TestRunner.run();
}
YAHOO.log(MOUSE_MOVE_TEST_WARNING, "warn", "TestRunner");    

}, 100);</script>
</body>
</html>