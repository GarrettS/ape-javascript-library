<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Test Test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Autocomplete Test</title>
    <link rel="stylesheet" type="text/css" href="../../yui-test/build/logger/assets/logger.css">
    <link rel="stylesheet" type="text/css" href="../../yui-test/assets/testlogger.css">

    <script type="text/javascript" src="../../yui-test/build/yahoo-dom-event/yahoo-dom-event.js"></script>
    <script type="text/javascript" src="../../yui-test/build/logger/logger.js"></script>
    <script type="text/javascript" src="../../yui-test/build/yuitest/yuitest-beta.js"></script>

    <script type="text/javascript" src="../../../build/ape-ep-dom.js"></script>
    <script type="text/javascript" src="../../../build/ajax/ajax.js"></script>
    <script type="text/javascript" src="../../../build/test/TestRunner.js"></script>
    <script type="text/javascript" src="../../../build/test/Assert.js"></script>
    <script type="text/javascript" src="../../../build/test/NativeConstraints.js"></script>
    </head>
<body>
<div id="testLogger"></div>
<div id="template">
<div id="testNode">
    <input type="text" id="testNode-input" autocomplete="off">
</div>
</div>
<script type="text/javascript">
window.onload = function(){

    var Assert = YAHOO.util.Assert,
        dom = APE.dom,
        template = document.getElementById("template"),
        templateHTML = template.innerHTML,
        Action = YAHOO.util.UserAction;

    var assertTest = new YAHOO.tool.TestCase({
        name : "Assert test",

        testAssertFail : function() {
            var thrown,
                msg = "aaa";
            try { 
                APE.test.fail(msg);
            } catch(ex) {
                thrown = ex.message;
            }

            Assert.areSame(msg, thrown);
        },

        "test isTrue" : function() {
            var isTrue;
            try {
                APE.test.Assert(true, APE.test.NativeConstraints.isTrue);
                isTrue = true;
            } catch(err) {
                isTrue = false;
            }
            Assert.isTrue(isTrue);
        }
    });
    
    var testTest = new YAHOO.tool.TestCase({
 
        //name of the test case - if not provided, one is auto-generated
        name : "Test test",
 
        testTestPass : function() {
            var passed,
                testCaseData = {
                    testFoo : function() {
                        passed = true;
                    }
                };
                
            var tr = APE.test.TestRunner.getById("testTestPass");
            tr.addTestCase(testCaseData);
            tr.start();
            Assert.isTrue(passed);
        },

        testNotFail : function() {
            var failed = false,
                testCaseData = {
                    testFoo : function() {}
                };
                
            var tr = APE.test.TestRunner.getById("testNotFail");
            tr.addTestCase(testCaseData);
            tr.addCallback("onfail", failHandler);
            function failHandler(error) {
                failed = true;
            }
            tr.start();
            Assert.isFalse(failed);
        },

        testStart : function() {
            var run,
                testCaseData = {
                    testFoo : function() {
                        run = true;
                    }
                };
                
            var tr = APE.test.TestRunner.getById("testStart");
            tr.addTestCase(testCaseData);
            tr.start();
            Assert.isTrue(run);
        }
        
    });

    var failTestCase = new YAHOO.tool.TestCase({

        testFailByErrorGeneratesStack : function() {
    	   var testCaseData = {
                testFoo : function() {
                    throw Error("failed");
                }
           };
    	   var tr = APE.test.TestRunner.newInstance();
    	   tr.addTestCase(testCaseData);

           tr.start();
           Assert.areSame(1, tr.errorList.length);
        },

        testDone : function() {
            var testCaseData = {
                 testFoo : function() {
                     throw Error("failed");
                 }
            };
            var done, tr = APE.test.TestRunner.getById("WWW");
            tr.addTestCase(testCaseData);
            APE.EventPublisher.add(tr, "oncomplete", completeHandler);

            function completeHandler() {
                done = true;
            }
            
            tr.start();
            Assert.isTrue(done, "oncomplete event did not fire");
         }
    });
    
    var waitTestCase = new YAHOO.tool.TestCase({
        testWait : function() {
	        var waited = false,
	            waitDone,
	            testCaseData = {
		            name : "First Foo",
	                testWaits : function() {
	                    this.wait(function(){
	                        waited = true;
	                    }, 100);
	                }
	            };
	        
            var tr = APE.test.TestRunner.getById("testWait");
            tr.addTestCase(testCaseData);
            function completeHandler(){
                waitDone = waited;
            };
            APE.EventPublisher.add(tr, "oncomplete", completeHandler);
            tr.start();
            
            Assert.isFalse(waited);
            this.wait(function(){
                Assert.isTrue(waitDone);
            }, 200);
	    }
    });

    var xhrTestCase = new YAHOO.tool.TestCase({

        name : "xhr test case",

        testOnloadPass : function() {
            var tr = APE.test.TestRunner.newInstance(),
                loaded;
            tr.add("xhr-testFunction.js");
            tr.start();
            tr.onload = function() {
                alert('loaded');
                loaded = true;
            };
            this.waitForCondition(isTestLoaded);

            function isTestLoaded() {
                return loaded;
            }
        }
    });
    
    //create the logger
    new YAHOO.tool.TestLogger("testLogger");
 
    //run the tests
    YAHOO.tool.TestRunner.add( assertTest );
    YAHOO.tool.TestRunner.add( waitTestCase );
    YAHOO.tool.TestRunner.add( testTest );
    YAHOO.tool.TestRunner.add( failTestCase );
    YAHOO.tool.TestRunner.add( xhrTestCase );
     //run the tests
    if (parent !== self 
            && "YAHOO" in parent
            && parent.YAHOO.tool ) {
        YAHOO.tool.TestManager.load();
    } else {
        YAHOO.tool.TestRunner.run();
    }
 
};</script>

</body>
</html>