(function(){function h(a,b){this.src=a;this._callStack=[];this.type=b}function n(){var a,b,d,c,e;for(a in i){b=i[a];c=0;for(e=b.length;c<e;c++){d=b[c];d.src[d.type]=null}}i={}}function k(a,b,d,c){return g(a,b).add(d,c)}function o(a,b,d,c){return g(a,b).add(d,c)}function l(a){function b(d){var c=false,e,f=a._callStack,m;if(typeof a.beforeFire=="function")try{if(a.beforeFire(d)==false)c=true}catch(p){j.deferError(p)}for(e=0;e<f.length;e++){m=f[e];try{if(m[0].call(m[1],d)==false)c=true}catch(q){j.deferError(q)}}if(typeof a.afterFire==
"function")if(a.afterFire(d)==false)c=true;return!c}return b}function g(a,b){var d=i[b]||(i[b]=[]),c,e,f;c=0;for(e=d.length;c<e;c++){f=d[c];if(f.src===a)return f}f=new h(a,b);a[b]&&f.add(a[b],a);a[b]=l(f);return d[e]=f}var j=self.APE,i={},r;j.EventPublisher=h;j.mixin(h,{get:g,add:k,remove:o,fire:l,cleanUp:n});h.prototype={add:function(a,b){this._callStack.push([a,b||this.src]);return this},addBefore:function(a,b){return k(this,"beforeFire",a,b||this.src)},addAfter:function(a,b){return k(this,"afterFire",
a,b||this.src)},getEvent:function(a){return g(this,a)},remove:function(a,b){var d=this._callStack,c,e;b=b||this.src;for(c=0;c<d.length;c++){e=d[c];if(e[0]===a&&e[1]===b)return d.splice(c,1)}return null},removeBefore:function(a,b){return g(this,"beforeFire").remove(a,b||this.src)},removeAfter:function(a,b){return g(this,"afterFire").remove(a,b||this.src)},fire:function(a){return l(this)(a)},toString:function(){return"APE.EventPublisher: {src="+this.src+", type="+this.type+", length="+this._callStack.length+
"}"}};r&&g(window,"onunload").addAfter(n,h)})();
