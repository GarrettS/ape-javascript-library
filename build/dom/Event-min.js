APE.namespace("APE.dom").Event=(function(){var HAS_EVENT_TARGET="addEventListener" in this,TARGET=HAS_EVENT_TARGET?"target":"srcElement",Event={get:get,getTarget:getTarget,add:addCallback,addCallback:addCallback,remove:removeCallback,removeCallback:removeCallback,purgeEvents:purgeEvents,preventDefault:preventDefault,stopPropagation:stopPropagation,toString:function(){return"APE.dom.Event"}};function get(src,sEvent){Event.get=get;var FOCUS_DELEGATED=HAS_EVENT_TARGET?"focus":"focusin",BLUR_DELEGATED=HAS_EVENT_TARGET?"blur":"focusout",Registry={},isMaybeLeak
/*@cc_on=(@_jscript_version<5.7)@*/
,useCaptureMap={focus:FOCUS_DELEGATED,blur:BLUR_DELEGATED},cleanUp;function DomEventPublisher(src,type){if(!src.addEventListener&&!src.attachEvent){throw TypeError(src+" is not a compatible object.")}this.src=src;this.type=type;this._callStack=[]}DomEventPublisher.prototype={add:function(callback){DomEventPublisher.prototype.add=add;this.add(callback);function add(callback){var o=this.src,captureAdapterType=useCaptureMap[this.type],type=captureAdapterType||this.type;if(HAS_EVENT_TARGET){o.addEventListener(type,callback,!!captureAdapterType)}else{callback=getBoundCallback(o,callback);o.attachEvent("on"+type,callback)}this._callStack.push(callback)}function getBoundCallback(o,cb){if(o===window){return cb}function bound(ev){bound.original.call(bound.context,ev)}bound.original=cb;bound.context=o;cb=o=null;return bound}},remove:function(callback){DomEventPublisher.prototype.remove=remove;this.remove(callback);function remove(callback){callback=removeFromCallStack(this._callStack,callback);if(callback){if(HAS_EVENT_TARGET){this.src.removeEventListener(this.type,callback,this.type in useCaptureMap)}else{this.src.detachEvent("on"+this.type,callback)}}}function removeFromCallStack(callStack,callback){var cb,i,len;for(i=0,len=callStack.length;i<len;i++){cb=callStack[i];if((cb.original||cb)===callback){delete cb.original;delete cb.context;return callStack.splice(i,1)[0]}}return null}},purge:function(){var callStack=this._callStack,cb,i;for(i=callStack.length;i-->0;callStack.length=i){cb=callStack[i];this.remove(cb.original||cb)}},toString:function(){return"DomEventPublisher: src: "+this.src+", type: "+this.type}};function get(src,sEvent){var publisherList=Registry[sEvent]||(Registry[sEvent]=[]),i,len,publisher;for(i=0,len=publisherList.length;i<len;i++){publisher=publisherList[i];if(publisher.src===src){return publisher}}publisher=new DomEventPublisher(src,sEvent);publisherList[len]=publisher;return publisher}if(isMaybeLeak){get(window,"unload").add(cleanUp=function(){var sEvent,publisherList,i,publisher;for(sEvent in Registry){publisherList=Registry[sEvent];for(i=publisherList.length;i-->0;publisherList.length=i){publisher=publisherList[i];if(publisher.src!=publisher.src.window){publisher.purge()}}delete Registry[sEvent]}removeCallback(window,"unload",cleanUp)})}return get(src,sEvent)}function getTarget(ev){ev=ev||window.event;if(!ev){return null}var t=(ev||window.event)[TARGET];if(t&&t.nodeName==="#text"){t=t.parentNode}return t}function addCallback(o,type,cb){Event.get(o,type).add(cb)}function purgeEvents(obj,eventList){if(typeof eventList=="string"){Event.get(obj,eventList).purge()}else{for(var i=0,len=eventList.length;i<len;i++){Event.get(obj,eventList[i]).purge()}}}function removeCallback(o,type,cb,useCapture){Event.get(o,type).remove(cb)}function preventDefault(ev){ev=ev||window.event;if("preventDefault" in ev){ev.preventDefault()}else{if("returnValue" in ev){ev.returnValue=false}}}function stopPropagation(ev){if(HAS_EVENT_TARGET){ev.stopPropagation()}else{(window.event||ev).cancelBubble=true}}return Event})();