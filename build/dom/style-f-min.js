APE.namespace("APE.dom");(function(){APE.mixin(APE.dom,{getStyle:I,getCascadedStyle:q,setOpacity:f,getFilterOpacity:B,getStyleUnit:F,findInheritedStyle:a,getContainingBlock:R,getPixelCoords:E});var C="getComputedStyle",D=document.defaultView&&typeof document.defaultView[C]=="function",O="currentStyle",i="style";function a(s,v,r){var t="",u=s;for(;t=q(u,v,r);u=u.parentNode){if(t&&!n.test(t)){break}}return t}var n=/^(?:inher|trans|(?:rgba\((?=(0,\s))(?:\1\1\1)0\)))/;function B(r){var s=r.filters;if(!s){return""}try{return s["DXImageTransform.Microsoft.Alpha"].opacity/100}catch(t){try{return s("alpha").opacity/100}catch(t){return 1}}}function f(v,r){var u=v[i],t;if("opacity" in u){u.opacity=r}else{if("filter" in u){t=v[O];u.filter="alpha(opacity="+(r*100)+")";if(t&&("hasLayout" in t)&&!t.hasLayout){i.zoom=1}}}}function I(s,r){var AA="",x,v,t,u,y,z=s.ownerDocument,w=z.defaultView;if(D){x=w[C](s,"");if(r=="borderRadius"&&!("borderRadius" in x)){r="MozBorderRadius" in x?"MozBorderRadius":"WebkitBorderRadius" in x?"WebkitBorderRadius":""}if(!(r in x)){return""}AA=x[r];if(AA===""){AA=(m(x,r)).join(" ")}}else{if(O in s){x=s[O];if(r=="opacity"&&!("opacity" in s[O])){AA=B(s)}else{if(r=="cssFloat"){r="styleFloat"}AA=x[r];if(r=="clip"&&!AA&&("clipTop" in x)){AA=e(s,x)}else{if(AA=="auto"){AA=T(s,r)}else{if(!(r in x)){return""}}}}v=g.exec(AA);if(v){t=AA.split(" ");t[0]=h(s,v);for(u=1,y=t.length;u<y;u++){v=g.exec(t[u]);t[u]=h(s,v)}AA=t.join(" ")}}}return AA}function e(u,t){var r=[],s=0,v;for(;s<4;s++){v=U[s];clipValue=t["clip"+v];if(clipValue=="auto"){clipValue=(v=="Left"||v=="Top"?"0px":v=="Right"?u.offsetWidth+G:u.offsetHeight+G)}r.push(clipValue)}return{top:r[0],right:r[1],bottom:r[2],left:r[3],toString:function(){return"rect("+r.join(" ")+")"}}}var V=document.documentElement[i],d="cssFloat" in V?"cssFloat":"styleFloat",U=["Top","Right","Bottom","Left"],k=["Topright","Bottomright","Bottomleft","Topleft"];docEl=V=null;function q(u,w,r){var t=u[i],v=t[w]||"";if(v&&K.test(w)){v=Q(v)}if(!v||(r&&v.indexOf(r)===-1)||w.indexOf("border")===0&&H.test(v)){if(O in u){v=Y(u,w,r)}else{if(N.test(w)){w=N.exec(w)[0]}v=o(u,w,r)}}return v}function Y(s,r,v){var z=s[O],y="",w,x=s.ownerDocument,u=x.defaultView;if(r=="opacity"){if(D){y=u[C](s,"").opacity}else{if(!("opacity" in z)){y=B(s)}}}else{if(r=="clip"&&!z[r]&&"clipTop" in z){y=e(s,z)}else{if(!(r in z)){return""}if(L.test(r)){r=d}y=s[i][r]||z[r];if(y=="auto"){y=T(s,r)||y}}}if(v&&y.indexOf(v)==-1){if(p&&X.test(y)&&D){var t=u[C](s,r);w=c(s,r,v);if(w){y=w.fromPx(s.parentNode,r,t[r],t)}}else{if(y==0&&v){y="0"+v}else{w=c(s,r,v);y=w.fromPx(s.parentNode,r)}}}return y}function T(x,z){var w=x[i],u,t,y=x.ownerDocument;if("pixelWidth" in w&&Z.test(z)){var r="pixel"+(z.charAt(0).toUpperCase())+z.substring(1);u=w[r];if(u===0){if(z=="width"){t=parseFloat(I(x,"borderRightWidth"))||0;paddingWidth=parseFloat(I(x,"paddingLeft"))||0+parseFloat(I(x,"paddingRight"))||0;return x.offsetWidth-x.clientLeft-t-paddingWidth+"px"}else{if(z=="height"){t=parseFloat(I(x,"borderBottomWidth"))||0;paddingWidth=parseFloat(I(x,"paddingTop"))||0+parseFloat(I(x,"paddingBottom"))||0;return x.offsetHeight-x.clientTop-t+"px"}}}return w[r]+"px"}if(z=="margin"&&x[O].position!="absolute"&&y.compatMode!="BackCompat"){u=parseFloat(I(x.parentNode,"width"))-x.offsetWidth;if(u==0){return"0px"}u="0px "+u;return u+" "+u}}function o(s,r,z){if(D){var x=s.ownerDocument.defaultView,y=x[C](s,""),AB=y[r],AC,u=0,w,v,AA,t;if(!(r in y)){return""}if(AB===""){AC=m(y,r)}else{if(parseFloat(AB)==0&&z){return"0"+z}}if(z){if(!AC){AC=[AB]}AA=c(s,r,z);if(AA){v=s.parentNode;for(w=AC.length;u<w;u++){t=AC[u];if(t=="0"){AC[u]="0"+z}else{if(!AA.exp.test(t)){AC[u]=AA.fromPx(v,r,t,y)}}}}}if(AC){AB=Q(AC.join(" "))}return AB}}function Q(u){var s=u.split(" "),t=1,r,v=true,w=s[0];for(r=s.length-1;t<r;t++){if(!v){break}v=s[t]==s[t+1]}if(v){u=w}return u}function m(x,s){var t=K.exec(s),v,AB,w,z,AA,y=true,r,u=1;if(t&&t[0]){r=U;v=t[1]||t[0];AB=t[2]||""}else{if(N.test(s)){r=k;v=N.exec(s)[0];AB=""}else{return[""]}}w=x[v+r[0]+AB];AA=[w];while(u<4){z=x[v+r[u]+AB];y=y&&z==w;w=z;AA[u++]=z}if(y){return[w]}return AA}function S(t,r,s,u){this.exp=new RegExp("\\d"+t+"$");this.unit=t;this.fontSizeMultiplier=r;if(s&&s[O]){this.val=s[O][u];if(g.test(this.val)){this.val=h(s,g.exec(this.val))}if(u=="fontSize"){s=s.parentNode}this.fontSize=I(s,"fontSize")}}S.prototype={fromPx:b};function c(s,t,r){if(r=="em"){if(D){return S.em||(S.em=new S("em",1))}return new S("em",1,s,t)}if(r=="ex"){if(D){return S.ex||(S.ex=new S("ex",0.5))}return new S("ex",1,s,t)}if(r=="%"){if(P.test(t)){return new l(s,t)}return new A(s,t)}}var M=/\dpx$/,H=/^thi|med/,g=/(-?\d+|(?:-?\d*\.\d+))(?:em|ex|pt|pc|in|cm|mm\s*)/,X=/(-?\d+|(?:-?\d*\.\d+))(px|em|ex|pt|pc|in|cm|mm|%)\s*/,L=/loat$/,W=/(?:width|height|padding|fontSize)$/ig,P=/^width|height|margin|padding|textIndent/,j=/^(?:font|text|letter)/,Z=/width|height|top|left/,G="px",K=/^(?:margin|(border)(Width)|padding)$/,N=/^[a-zA-Z]*[bB]orderRadius$/;function h(w,x){if(w.runtimeStyle){var y=x[0];if(parseFloat(y)==0){return"0px"}var v=w[i],u=v.left,t=w.runtimeStyle,r=t.left;t.left=w[O].left;v.left=(y||0);y=v.pixelLeft+G;v.left=u;t.left=r;return y}}var J={fromPx:function(s,u,t){s=this.parent;var r=s.ownerDocument.defaultView;containingBlockValue=r[C](s,"").width,containingBlockPx=parseFloat(containingBlockValue),thisPx=parseFloat(t),thisPercent=Math.ceil(thisPx/containingBlockPx*10000)/100;if(W.test(u)){if(thisPercent<0){thisPercent=0}}return thisPercent+"%"},exp:j};function A(r,s){this.p=s;this.parent=R(r)}function l(r,s){this.p=s;this.parent=r.parentNode}A.prototype=l.prototype=J;l.prototype.exp=P;function F(s){var r=X.exec(s);return r&&r[2]||""}function b(r,y,x,s){x=this.val||x;var t=M.exec(x),u=r.ownerDocument.defaultView;if(t){if(t[0]){var v,w=parseFloat(x);if(!this.fontSize){if(y=="fontSize"){v=u[C](r,"").fontSize}else{v=s.fontSize}}v=parseFloat(v||this.fontSize);if(isFinite(w)){return w/v*this.fontSizeMultiplier+this.unit}}}if(!x){return""}else{if(isFinite(x)){return x+this.unit}}return x}var p=(function(){var t=document.getElementsByTagName("head")[0],r,v,u;if(!t[O]){return false}u=t[i];r=u.fontSize;u.fontSize=".4em";v=t[O].fontSize=="0em";u.fontSize=r;return v})();function R(s){var u=I(s,"position"),t=s.ownerDocument.documentElement,r=s.parentNode;if(/^(?:r|s)/.test(u)||!u){return r}if(u=="fixed"){return null}while(r&&r!=t){if(I(r,"position")!="static"){return r}r=r.parentNode}return t}function E(r){var s=(D?function(u){var t=u.ownerDocument.defaultView[C](u,"");return{x:parseInt(t.left)||0,y:parseInt(t.top)||0}}:function(u){var t=u.style;return{x:t.pixelLeft||parseInt(I(u,"left"))||0,y:t.pixelTop||parseInt(I(u,"top"))||0}});this.getPixelCoords=s;return s(r)}})();