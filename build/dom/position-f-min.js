APE.namespace("APE.dom");
(function(){function u(b,a,e){var g=b[J.OWNER_DOCUMENT],n=g.documentElement,i=g.body;a||(a=g);e||(e={x:0,y:0});e.x=e.y=0;if(b===a)return e;if(K in b){var l=B?i:n,c=b[K]();b=c.left+L(n.scrollLeft,i.scrollLeft);var o=c.top+L(n.scrollTop,i.scrollTop),j=l.clientTop;l=l.clientLeft;if(M){b-=l;o-=j}if(a!==g){c=u(a,null);b-=c.x;o-=c.y;if(M)if(B&&a===i){b-=l;o-=j}else if(a!==g&&a!==n&&a!==i){b-=a.clientLeft;o-=a.clientTop}}if(B&&X&&a!=g&&a!==i){a=i.currentStyle;b+=f(a.marginLeft)||0+f(a.left)||0;o+=f(a.marginTop)||
0+f(a.top)||0}e.x=b;e.y=o;return e}else if(Y){N||Z();o=b.offsetLeft;l=b.offsetTop;c=g[C];var q=c[v](b,"")||b.style;if(q.position=="fixed"&&D){e.x=o+n.scrollLeft;e.y=l+n.scrollTop;return e}j=c[v](i,"");for(var p=!O.test(j.position),m=b,d=b.parentNode,k=b.offsetParent;d&&d!==a;d=d.parentNode){if(d!==i&&d!==n&&D){o-=d.scrollLeft;l-=d.scrollTop}if(d===k)if(!(d===i&&p)){if(!x&&!(d.tagName===P&&Q)){var h=c[v](d,"");o+=f(h[E])||0;l+=f(h[F])||0}if(d!==i){o+=k.offsetLeft;l+=k.offsetTop;m=k;k=d.offsetParent}}}k=
d=0;var r,s;h=a===g||a===n;var t;if(m!=g)if(q=c[v](m,"")){s=q.position;s=(r=$.test(s))||O.test(s)}if(m===b&&b.offsetParent===i&&!y&&a!==i&&!(p&&G)||y&&m===b&&!s||!p&&s&&R&&h){k+=f(j.marginTop)||0;d+=f(j.marginLeft)||0}if(a===i){t=c[v](n,"");if(!p&&(H&&!r||S&&r)||p&&T){k-=f(t.paddingTop)||0;d-=f(t.paddingLeft)||0}if(U){if(!s||s&&!p)k-=f(t.marginTop)||0;d-=f(t.marginLeft)||0}}if(p){if(V||!r&&!x&&h){k+=f(j[F]);d+=f(j[E])}}else if(G){if(h){if(!I){k+=f(j.top)||0;d+=f(j.left)||0;if(r&&x){k+=f(j[F]);d+=
f(j[E])}}if(a===g&&!p&&!H){t||(t=c[v](n,""));k+=f(t.paddingTop)||0;d+=f(t.paddingLeft)||0}}else if(I){k-=f(j.top);d-=f(j.left)}if(y&&(!s||a===i)){k-=f(j.marginTop)||0;d-=f(j.marginLeft)||0}}e.x=W(o+d);e.y=W(l+k);return e}}function Z(){N=true;var b=document,a=b.body;if(a){var e="marginTop",g="position",n="padding",i="static",l="border",c=a.style,o=c.cssText,j="1px solid transparent",q="0",p="1px",m="offsetTop",d=b.documentElement.style,k=d.cssText,h=b.createElement("div"),r=h.style;b=b.createElement(P);
c[n]=c[e]=c.top=q;d.position=i;c[l]=j;r.margin=q;r[g]=i;h=a.insertBefore(h,a.firstChild);x=h[m]===1;c[l]=q;b.innerHTML="<tbody><tr><td>x</td></tr></tbody>";b.style[l]="7px solid";b.cellSpacing=b.cellPadding=q;a.insertBefore(b,a.firstChild);Q=b.getElementsByTagName("td")[0].offsetLeft===7;a.removeChild(b);c[e]=p;c[g]=z;y=h[m]===1;G=a[m]===0;c[e]=q;c.top=p;I=h[m]===1;c.top=q;c[e]=p;c[g]=r[g]=z;R=h[m]===0;r[g]="absolute";c[g]=i;if(h.offsetParent===a){c[l]=j;r.top="2px";V=h[m]===1;c[l]=q;r[g]=z;d[n]=
p;c[e]=q;T=h[m]===3;c[g]=z;H=h[m]===3;r[g]="absolute";S=h[m]===3;d[n]=q;d[e]=p;U=h[m]===3}a.removeChild(h);c.cssText=o||"";d.cssText=k||""}}function aa(b,a){var e=u(b).y,g=u(a).y;return e+b.offsetHeight<=g+a.offsetHeight&&e>=g}function ba(b,a){return u(b).y<=u(a).y}function ca(b,a){return u(b).y+b.offsetHeight>=u(a).y+a.offsetHeight}var J=APE.dom,D=typeof document.createElement("p").scrollLeft=="number";APE.mixin(J,{getOffsetCoords:u,isAboveElement:ba,isBelowElement:ca,isInsideElement:aa,IS_SCROLL_SUPPORTED:D});
var A=this.document,N,w=A.documentElement,W=Math.round,L=Math.max,f=self.parseFloat,v="getComputedStyle",C="defaultView",B=w&&w.clientWidth===0,M="clientTop"in w,P=/^h/.test(w.tagName)?"table":"TABLE",X="currentStyle"in w,x,y,I,G,Q,V,R,T,H,S,U,Y=A[C]&&typeof A[C][v]!="undefined",K="getBoundingClientRect",z="relative",F="borderTopWidth",E="borderLeftWidth",O=/^(?:r|a)/,$=/^(?:a|f)/;A=w=null})();
