APE.namespace("APE.widget");APE.widget.Calendar=function(B){this.id=(typeof B=="string"?B:B.id);var A=document.getElementById(this.id);this.displayDate=new Date(A.value);if(isNaN(this.displayDate.valueOf())){this.displayDate=new Date}this.initEvents()};APE.widget.Calendar.getByNode=APE.getByNode;APE.widget.Calendar.getById=APE.getById;APE.widget.Calendar.focusHandler=function(A){APE.widget.Calendar.getById(this.id)._show(A)};APE.widget.Calendar.documentMouseDownHandler=function(C){var E=APE.dom,B=E.Event.getTarget(C),D=APE.widget.Calendar,F=D.activeCalendar,A;if(F){A=document.getElementById(F.calendarId);if(!A){D.activeCalendar=null;return}if(E.contains(A,B)||B===A){return}F._hasFocus=false;F._hide(C)}};APE.widget.Calendar.blurHandler=function(C){var B=APE.widget.Calendar.getByNode(this);B.hideTimer=setTimeout(function A(){B._hide(C||event)},10)};APE.widget.Calendar.mousedownHandler=function(D){D=D||event;var B=APE.dom,E=B.Event.getTarget(D),H,I,G;if(E.className=="ape-calendar"){H=E}else{H=B.findAncestorWithClass(E,"ape-calendar")}I=APE.widget.Calendar.getById(H.id.replace(/-calendar$/,""));G=I.id;I._hasFocus=true;clearTimeout(I.hideTimer);selectedId=G+"-selected-day";if(E.tagName.toLowerCase()=="b"){if(E.id===selectedId){return}var A=parseInt(E.firstChild.data);if(!A){return}var C=document.getElementById(selectedId);if(C){B.removeClass(C,"ape-calendar-selected-day");C.id=""}E.id=selectedId;B.addClass(E,"ape-calendar-selected-day");I.setDateOfMonth(A);I.onselect();if(I.hideOnSelect){setTimeout(function(){I._hide(D);I._hasFocus=false;I=null},115)}}else{var F=new Date(I.displayDate);if(E.id===G+"-next-year"){F.setYear(F.getFullYear()+1);I.setDate(F)}else{if(E.id===G+"-prev-year"){F.setYear(F.getFullYear()-1);I.setDate(F)}else{if(E.id===G+"-next-month"){F.setMonth(F.getMonth()+1);I.setDate(F)}else{if(E.id===G+"-prev-month"){F.setMonth(F.getMonth()-1);I.setDate(F)}}}}}};APE.widget.Calendar.prototype={days:[31,28,31,30,31,30,31,31,30,31,30,31],hideOnSelect:true,initEvents:function(){var D=document,A=D.getElementById(this.id),C=APE.widget.Calendar,B=APE.EventPublisher;B.add(A,"onfocus",C.focusHandler);B.add(A,"onblur",C.blurHandler);B.add(A,"onclick",C.focusHandler);B.add(D,"onmousedown",C.documentMouseDownHandler)},id:"",calendarId:"",hiddenDayClass:"ape-calendar-empty-day",calendarClass:"ape-calendar",_isHidden:undefined,_show:function(C){if(!this.calendarId){this.create()}var B=document.getElementById(this.calendarId),D=B.style,A=this.constructor.activeCalendar;this._isHidden=false;if(A){if(A===this){return}else{A._hide()}}this.position(D);this.constructor.activeCalendar=this;this.show(D);this.onshow(C);this.setDate(this.displayDate)},position:function(C){var A=document.getElementById(this.id),B=APE.dom.getOffsetCoords(A);C.left=B.x+"px";C.top=B.y+A.offsetHeight+"px"},show:function(A){A.visibility="visible"},_hide:function(A){if(this._isHidden){return}if(this._hasFocus){return}this.onhide(A);if(this.constructor.activeCalendar===this){this.constructor.activeCalendar=null}this.hide(document.getElementById(this.calendarId).style);this._isHidden=true},hide:function(A){A.visibility="hidden"},onshow:function(){},onhide:function(){},onselect:function(){},create:function(){if(this.calendarId){return}this.calendarId=this.id+"-calendar";var J=document;if(J.getElementById(this.calendarId)){return}var F=J.createElement("div"),C=Array.prototype.join,D=C.call({length:7+1},"<td><b>&nbsp;</b></td>"),H=C.call({length:6+1},"<tr>"+D+"</tr>\n"),G=APE.widget,A=G.CalendarLocale,B=A.days.abbr,E="<tbody>"+H+"</tbody>",I="<thead><tr class='calendar-button-row'><th id='"+this.id+"-prev-year' title='"+A.previousYear+"'>&#x00ab;</th><th id='"+this.id+"-prev-month' title='"+A.previousMonth+"'>&#x2039;</th><th colspan='3' class='ape-calendar-header'><div id='"+this.calendarId+"-header'>&nbsp;</div></th><th id='"+this.id+"-next-month' title='"+A.nextMonth+"' class='"+this.calendarClass+"-days'>&#x203A;</th><th id='"+this.id+"-next-year' title='"+A.nextYear+"'>&#x00bb;</th></tr><tr><th>"+B.join("</th><th>")+"</th></tr></thead>";F.onselectstart=this.returnFalse;F.innerHTML="<table>"+I+E+"</table>";F.id=this.calendarId;F.className=this.calendarClass;F.onmousedown=F.onfocus=G.Calendar.mousedownHandler;J.body.appendChild(F)},returnFalse:function(A){return false},setDateOfMonth:function(A){this.displayDate.setDate(A);var B=this.formatDate();document.getElementById(this.id).value=B},getDate:function(){return new Date(this.displayDate)},formatDate:function(){return APE.widget.CalendarLocale.months.abbr[this.displayDate.getMonth()]+" "+this.displayDate.getDate()+", "+this.displayDate.getFullYear()},setDate:function(U){if(!this.calendarId){this.create()}var M=window.APE,F=M.widget.CalendarLocale;if(!F){throw Error("Missing Resource: APE.widget.CalendarLocale")}var X=new Date,T=document,J=U.getFullYear(),V=U.getMonth(),I=F.months.full[V],B=this.days[V],N,R=0,O=0,G=(0==(J%4))&&((0!=(J%100))||(0==(J%400))),K=T.getElementById(this.calendarId),A=K.getElementsByTagName("table")[0].tBodies[0],E=A.getElementsByTagName("b"),W="textContent" in K?"textContent":"innerText",Q=T.getElementById(this.calendarId+"-header"),S=M.dom,D;N=new Date(U);N.setDate(1);N=N.getDay();Q.firstChild.data=J+", "+I;if(V===1&&G){B+=1}while(R<N){D=E[R++];D[W]=" ";D.className=this.hiddenDayClass}while(O++<B){D=E[R++];D[W]=O;D.className=""}for(R=N+B,O=E.length;R<O;R++){D=E[R];D[W]=" ";D.className=this.hiddenDayClass}var L=T.getElementById(this.id+"-selected-day");if(L){L.id=""}if(X.getYear()==U.getYear()&&X.getMonth()==U.getMonth()){var H=N+X.getDate()-1;this.currentDayIndex=H;var P=E[H];S.addClass(P,this.calendarClass+"-today")}if(U.getYear()==U.getYear()&&U.getMonth()==U.getMonth()){var C=N+U.getDate();D=E[C-1];S.addClass(D,this.calendarClass+"-selected-day");D.id=this.id+"-selected-day"}this.displayDate=new Date(U)}};