APE.namespace("APE.widget");
(function(){function z(i){this.id=i;if(!n){x(this);this.initEvents()}}function x(i){var j=document.getElementById(i.id),o=/(?:^|\s+)(\d{4})-(\d\d)-(\d\d)(?:$|\s+)/;if(j=o.exec(j.value)){i.displayDate=new Date(0);i.displayDate.setFullYear(j[1],j[2]-1,j[3])}else i.displayDate=new Date}function A(){function i(a,b){var c=l.CalendarLocale;if(!c)throw Error("Missing Resource: APE.widget.CalendarLocale");j(a);var d=new Date,f=document,e=b.getFullYear(),s=b.getMonth(),B=c.months.full[s],t=C[s],g,m=0,p=0,
D=0==e%4&&(0!=e%100||0==e%400);g=f.getElementById(a.calendarId);c=g.getElementsByTagName("tbody")[0].getElementsByTagName("b");var u="textContent"in g?"textContent":"innerText",E=f.getElementById(a.calendarId+"-header");g=new Date(b);g.setDate(1);g=g.getDay();E.firstChild.data=e+", "+B;if(s===1&&D)t+=1;for(;m<g;){e=c[m++];e[u]=" ";e.className=a.hiddenDayClass}for(;p++<t;){e=c[m++];e[u]=p;e.className=""}m=g+t;for(p=c.length;m<p;m++){e=c[m];e[u]=" ";e.className=a.hiddenDayClass}if(f=f.getElementById(a.id+
"-selected-day"))f.id="";if(d.getYear()==b.getYear()&&d.getMonth()==b.getMonth()){d=g+d.getDate()-1;a.currentDayIndex=d;d=c[d];k.addClass(d,a.calendarClass+"-today")}if(b.getYear()==b.getYear()&&b.getMonth()==b.getMonth()){b=g+b.getDate();e=c[b-1];k.addClass(e,a.calendarClass+"-selected-day");e.id=a.id+"-selected-day"}}function j(a){if(!a.calendarId)a.calendarId=a.id+"-calendar";var b=document;if(b.getElementById(a.calendarId)===null){var c=b.createElement("div"),d=Array.prototype.join,f=d.call({length:8},
"<td><b>&nbsp;</b></td>"),e=d.call({length:7},"<tr>"+f+"</tr>\n");d=l.CalendarLocale;f=d.days.abbr;e="<tbody>"+e+"</tbody>";d="<thead><tr class='calendar-button-row'><th id='"+a.id+"-prev-year' title='"+d.previousYear+"'>&#x00ab;</th><th id='"+a.id+"-prev-month' title='"+d.previousMonth+"'>&#x2039;</th><th colspan='3' class='ape-calendar-header'><div id='"+a.calendarId+"-header'>&nbsp;</div></th><th id='"+a.id+"-next-month' title='"+d.nextMonth+"' class='"+a.calendarClass+"-days'>&#x203A;</th><th id='"+
a.id+"-next-year' title='"+d.nextYear+"'>&#x00bb;</th></tr><tr><th>"+f.join("</th><th>")+"</th></tr></thead>";c.onselectstart=F;c.innerHTML="<table>"+d+e+"</table>";c.id=a.calendarId;c.className=a.calendarClass;c.onmousedown=c.onfocus=G;b.body.appendChild(c)}}function o(a){a=a||self.event;var b=l.Calendar.getById(this.id);H(b,a)}function H(a,b){if(n)a.onshow(b);else{j(a);var c=document.getElementById(a.calendarId).style;a._isHidden=false;if(h!==null)if(h===a)return;else q(h,b);I(a,c);h=a;a.onshow(b);
a.show(c);a.setDate(a.displayDate)}}function I(a,b){a=document.getElementById(a.id);var c=k.getOffsetCoords(a);b.left=c.x+"px";b.top=c.y+a.offsetHeight+"px"}function q(a,b){if(!(a._isHidden||a._hasFocus)){a.onhide(b);if(!n){if(h===a)h=null;a.hide(document.getElementById(a.calendarId).style);a._isHidden=true}}}function G(a){a=a||window.event;a=k.Event.getTarget(a);var b=this,c,d=a.id,f;b=l.Calendar.getById(b.id.replace(/-calendar$/,""));c=b.id;clearTimeout(b.hideTimer);f=c+"-selected-day";b._hasFocus=
true;if(/^b$/i.test(a.tagName)){if(d!==f)(d=+a.firstChild.data)&&J(b,d,a,f)}else K(b,d,c)}function J(a,b,c,d,f){var e;a._hasFocus=!a.hideOnSelect;if(e=document.getElementById(d)){k.removeClass(e,"ape-calendar-selected-day");e.id=""}c.id=d;k.addClass(c,"ape-calendar-selected-day");L(a,b);a.onselect();a.hideOnSelect&&setTimeout(function(){q(a,f);a._hasFocus=false;a=null},115)}function K(a,b,c){var d=new Date(a.displayDate),f;if(b===c+"-next-year")f=d.setFullYear(d.getFullYear()+1);else if(b===c+"-prev-year")f=
d.setFullYear(d.getFullYear()-1);else if(b===c+"-next-month")f=d.setMonth(d.getMonth()+1);else if(b===c+"-prev-month")f=d.setMonth(d.getMonth()-1);f&&a.setDate(d)}function L(a,b){a.displayDate.setDate(b);b=y(a.displayDate);document.getElementById(a.id).value=b}function F(){return false}function v(){}function y(a){var b=("000"+a.getFullYear()).slice(-4),c=("0"+(a.getMonth()+1)).slice(-2);a=("0"+a.getDate()).slice(-2);return b+"-"+c+"-"+a}function M(a){function b(){q(c,a||self.event)}var c=l.Calendar.getById(this.id);
c.hideTimer=setTimeout(b,10)}function N(a){var b=k.Event.getTarget(a),c;if(h!==null)if(c=document.getElementById(h.calendarId)){if(!(k.contains(c,b)||b===c)){h._hasFocus=false;q(h,a)}}else h=null}return{hideOnSelect:true,initEvents:function(){if(!n){var a=document,b=a.getElementById(this.id),c=EventPublisher=r.EventPublisher.add;c(b,"onfocus",o);c(b,"onblur",M);if(!n){c(b,"onclick",o);c(a,"onmousedown",N)}}},calendarId:"",hiddenDayClass:"ape-calendar-empty-day",calendarClass:"ape-calendar",_isHidden:0,
show:function(a){x(this);a.visibility="visible"},hide:function(a){a.visibility="hidden"},onshow:v,onhide:v,onselect:v,getDate:function(){return new Date(this.displayDate)},setDate:function(a){this.displayDate=new Date(a);if(n)document.getElementById(this.id).value=y(this.displayDate);else i(this,a)}}}var r=self.APE,l=r.widget,k=r.dom;l.Calendar=r.createFactory(z,A);var w=document.createElement("input");w.setAttribute("type","date");var n=l.Calendar.IS_NATIVE=/date/i.test(w.type),C=[31,28,31,30,31,
30,31,31,30,31,30,31],h=null;w=null})();
