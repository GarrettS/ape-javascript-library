APE.namespace("APE.widget");
(function(){function M(g){this.id=g;if(!r){this._isHidden=true;this.initEvents()}}function x(g){g=document.getElementById(g.id);var y=/(?:^|\s+)(\d{4})-(\d\d)-(\d\d)(?:$|\s+)/;g=y.exec(g.value);var s;if(g){s=new Date(0);s.setFullYear(g[1],g[2]-1,g[3])}return s}function N(){function g(a,b){var c=l.CalendarLocale;if(!c)throw Error("Missing Resource: APE.widget.CalendarLocale");F(a);var d=document,f=a.displayDate.getFullYear(),e=a.displayDate.getMonth();c=c.months.abbr[e];var h=y(a.displayDate),j=d.getElementById(a.calendarId);
j=j.getElementsByTagName("tbody")[0].getElementsByTagName("b");d=d.getElementById(a.calendarId+"-header");d.firstChild.data=f+", "+c;s(a,f,e,h,j);O(a,h,j);b&&P(a,h+a.displayDate.getDate(),j)}function y(a){a=new Date(a);a.setDate(1);return a.getDay()}function s(a,b,c,d,f){var e=0,h=0,j=Q[c],R=a.id+"-day";b=0==b%4&&(0!=b%100||0==b%400);if(c===1&&b)j+=1;for(;e<d;){c=f[e++];c[z]=" ";c.className=a.hiddenDayClass;c.id=""}for(;h++<j;){c=f[e++];c.id=R+(h-1);c[z]=h+"";c.tabIndex=-1;c.className=""}e=d+j;for(h=
f.length;e<h;e++){c=f[e];c[z]=" ";c.className=a.hiddenDayClass}}function O(a,b,c){if(G(a)){b=b+(new Date).getDate()-1;i.addClass(c[b],a.calendarClass+"-today")}}function P(a,b,c){if(G(a)&&!a.selectedId){b=c[b-1];i.addClass(b,H);a.selectedId=b.id}}function G(a){var b=x(a)||new Date;return b!=null&&a.displayDate.getYear()==b.getYear()&&a.displayDate.getMonth()==b.getMonth()}function F(a){if(!a.calendarId)a.calendarId=a.id+"-calendar";var b=document;if(b.getElementById(a.calendarId)===null){var c=b.createElement("div");
b=b.getElementById(a.id);var d=b.parentNode,f=S(),e=l.CalendarLocale,h=e.days.abbr;e="<thead><tr class='calendar-button-row'><th id='"+a.id+"-prev-year' tabindex='0' title='"+e.previousYear+"'>&#x00ab;</th><th id='"+a.id+"-prev-month' tabindex='0' title='"+e.previousMonth+"'>&#x2039;</th><th colspan='3' class='ape-calendar-header'><div id='"+a.calendarId+"-header'>-</div></th><th id='"+a.id+"-next-month' tabindex='0' title='"+e.nextMonth+"' class='"+a.calendarClass+"-days'>&#x203A;</th><th id='"+
a.id+"-next-year' tabindex='0' title='"+e.nextYear+"'>&#x00bb;</th></tr><tr><th>"+h.join("</th><th>")+"</th></tr></thead>";c.onselectstart=T;c.innerHTML="<table>"+e+f+"</table>";c.id=a.calendarId;c.className=a.calendarClass;c.tabIndex=0;c.onmousedown=U;c.onkeydown=V;a=c.firstChild;if("onfocusin"in a){a.onfocusin=W;a.onfocusout=X}d.insertBefore(c,b.nextSibling)}}function S(){var a=[],b=6,c=[],d;a.length=8;c.length=b;a=a.join("<td><b>&nbsp;</b></td>");for(d=0;d<b;d++)c[d]="<tr id='w"+d+1+"'>"+a+"</tr>\n";
return"<tbody>"+c.join("")+"</tbody>"}function W(a){a=k.getTarget(a);/-next-|-prev-|-day/.test(a.id)&&i.addClass(a,I)}function X(a){a=k.getTarget(a);i.removeClass(a,I)}function v(a){a=a||window.event;var b=l.Calendar.getById(this.id),c=document.getElementById(b.id),d=a.relatedTarget||a.fromElement;if(b._isHidden&&(!d||d!==c&&!i.contains(c,d)))J(b,a)}function V(a){a=a||window.event;var b=a.keyCode,c=this.id.replace(/-calendar$/,""),d=l.Calendar.getById(c);if(b===27){if(!d._isHidden){document.getElementById(c).focus();
p(d)}}else if(b===13){a=k.getTarget(a);A(this,a)}else if(b===9)Y(d,a);else/37|38|39|40/.test(b)&&Z(d,a,b)}function Y(a,b){if(w){var c=k.getTarget(b),d=b.shiftKey,f=a.id+"-prev-year",e=c.id===f;a=c.id===a.id+"-next-year";if(d&&e||!d&&a)k.preventDefault(b);else if(c.tabIndex===-1&&w){k.preventDefault(b);document.getElementById(f).focus()}}}function Z(a,b,c){b=k.getTarget(b);b=b.id.match(/-day(\d+)$/);var d;if(b){if(c===37)dayIndex=-1;else if(c===39)dayIndex=1;else if(c===38)dayIndex=-7;else if(c===
40)dayIndex=7;if(dayIndex)d=+b[1]+dayIndex}else d=0;(a=document.getElementById(a.id+"-day"+d))&&$(a)}function $(a){if(w){a.tabIndex=0;a.focus();a.tabIndex=-1}}function J(a){if(r)a.onshow();else{t(document,"onmousedown",B);t(document,"onmouseup",C);if(a._isHidden){m&&p(m);F(a);a._isHidden=false;var b=document.getElementById(a.calendarId);calStyle=b.style;aa(a.id,calStyle);a.onshow();a.show(calStyle);m=a;a.setDate(x(a));ba(a,b);b.parentNode.style.zIndex="100"}}}function ba(a,b){if(w)a.selectedId?setTimeout(function(){var c=
document.getElementById(a.selectedId);try{c.focus()}catch(d){}finally{a=b=c=null}},120):b.focus()}function aa(a,b){a=document.getElementById(a);b.left=a.offsetLeft+"px";b.top=a.offsetTop+a.offsetHeight+"px"}function p(a){if(!a._isHidden){a.onhide();if(!r){var b=document.getElementById(a.calendarId);if(b!==null){a.hide(b.style);b.parentNode.style.zIndex=""}a._isHidden=true}}}function U(a){a=a||window.event;if(!(a.button>1)){a=k.getTarget(a);var b=this;if(/-next-|-prev-/.test(a.id)||/^b$/i.test(a.tagName)){A(b,
a);(n=ca(b,a))&&n.startAfter(400)}}}function ca(a,b){var c;if(c=u.anim){n||(n=new c.Animation(10));n.run=function d(){A(a,b)};c=null}return n}function A(a,b){var c=b.id,d;a=l.Calendar.getById(a.id.replace(/-calendar$/,""));if(/^b$/i.test(b.tagName)){if(a.hideOnSelect||c!==a.selectedId)(d=+b.firstChild.data)&&da(a,d,b,c)}else/-next-|-prev-/.test(c)&&ea(a,c)}function da(a,b,c,d,f){var e=document.getElementById(a.selectedId);d=H;e&&i.removeClass(e,d);i.addClass(c,d);a.selectedId=c.id;fa(a,b);a.onselect();
if(a.hideOnSelect){document.getElementById(a.id).focus();setTimeout(function(){p(a,f);a=c=e=null},150)}}function ea(a,b){var c,d=new RegExp("^"+a.id+"-((?:next|prev)-(?:year|month))");if(d.test(b)){c=new Date(a.displayDate);b=d.exec(b)[1];if(b==="next-year")c.setFullYear(c.getFullYear()+1);else if(b==="prev-year")c.setFullYear(c.getFullYear()-1);else if(b==="next-month")c.setMonth(c.getMonth()+1);else b==="prev-month"&&c.setMonth(c.getMonth()-1);a.setDate(c)}}function fa(a,b){var c=a.displayDate||
new Date;c.setDate(b);b=K(c);document.getElementById(a.id).value=b}function T(){return false}function D(){}function K(a){var b=("000"+a.getFullYear()).slice(-4),c=("0"+(a.getMonth()+1)).slice(-2);a=("0"+a.getDate()).slice(-2);return b+"-"+c+"-"+a}function L(a){a=a||window.event;var b=a.keyCode;if(b===27||b===13){k.preventDefault(a);a=l.Calendar.getById(this.id);if(b===27)p(a);else if(b===13)a._isHidden?J(a):p(a)}}function B(a){if(m){a=i.Event.getTarget(a);var b=document,c=b.getElementById(m.calendarId);
if(a&&a.id!==m.id&&!c||!i.contains(c,a,true)){p(m);m=null;o(b,"onmousedown",B);o(b,"onmouseup",C)}}}function C(){n&&n.stop()}var k=i.Event,q=u.EventPublisher,t=q.add,o=q.remove;q=document.body;var z=typeof q.textContent==="string"?"textContent":"innerText",w=typeof q.focus!=="undefined",I="ape-calendar-focused-el",H="ape-calendar-selected-day",m=null;q=null;var n;return{hideOnSelect:true,initEvents:function(){if(!r){var a=document;a=a.getElementById(this.id);t(a,"onfocus",v);t(a,"onkeydown",L);t(a,
"onclick",v)}},purgeEvents:function(){var a=document,b=a.getElementById(this.id);if(b){o(b,"onfocus",v);o(b,"onkeydown",L);o(b,"onclick",v)}o(a,"onmousedown",B);o(a,"onmouseup",C)},calendarId:"",hiddenDayClass:"ape-calendar-empty-day",calendarClass:"ape-calendar",show:function(a){a.visibility="visible"},hide:function(a){a.visibility="hidden"},isShown:function(a){return a.visibility==="visible"},onshow:D,onhide:D,onselect:D,getDate:function(){return this.displayDate||x(this)},setDate:function(a){if(r)document.getElementById(this.id).value=
K(a);else{var b=a!=null,c=864E5;a=b?new Date(a):new Date;if(!this.displayDate||!this.selectedId||Math.abs(this.displayDate-a.getTime())>c){this.displayDate=a;g(this,b)}}}}}var u=self.APE,l=u.widget,i=u.dom;l.Calendar=u.createFactory(M,N);var E=document.createElement("input");E.setAttribute("type","date");var r=l.Calendar.IS_NATIVE=/date/i.test(E.type),Q=[31,28,31,30,31,30,31,31,30,31,30,31];E=null})();
