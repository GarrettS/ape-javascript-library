APE.namespace("APE.widget");(function(){var C=self.APE,G=C.widget,E=C.dom;G.Calendar=C.createFactory(B,J);function B(K){this.id=K;if(I){return}H(this);this.initEvents()}var F=document.createElement("input");F.setAttribute("type","date");var I=G.Calendar.IS_NATIVE=/date/i.test(F.type),A=[31,28,31,30,31,30,31,31,30,31,30,31],D=null;F=null;function H(N){var K=document.getElementById(N.id),M=/(?:^|\s+)(\d{4})-(\d\d)-(\d\d)(?:$|\s+)/,L=M.exec(K.value);if(!L){N.displayDate=new Date}else{N.displayDate=new Date(0);N.displayDate.setFullYear(L[1],L[2]-1,L[3])}}function J(){return{hideOnSelect:true,initEvents:function(){if(I){return}var b=document,Z=b.getElementById(this.id),a=EventPublisher=C.EventPublisher.add;a(Z,"onfocus",Q);a(Z,"onblur",P);if(!I){a(Z,"onclick",Q);a(b,"onmousedown",M)}},calendarId:"",hiddenDayClass:"ape-calendar-empty-day",calendarClass:"ape-calendar",_isHidden:0,show:function(Z){H(this);Z.visibility="visible"},hide:function(Z){Z.visibility="hidden"},onshow:W,onhide:W,onselect:W,getDate:function(){return new Date(this.displayDate)},setDate:function(Z){this.displayDate=new Date(Z);if(I){document.getElementById(this.id).value=V(this.displayDate);return}X(this,Z)}};function X(l,u){var c=G.CalendarLocale;if(!c){throw Error("Missing Resource: APE.widget.CalendarLocale")}R(l);var x=new Date,s=document,k=u.getFullYear(),v=u.getMonth(),g=c.months.full[v],t=A[v],n,q=0,o=0,e=(0==(k%4))&&((0!=(k%100))||(0==(k%400))),h=s.getElementById(l.calendarId),b=h.getElementsByTagName("tbody")[0].getElementsByTagName("b"),w="textContent" in h?"textContent":"innerText",r=s.getElementById(l.calendarId+"-header"),a;n=new Date(u);n.setDate(1);n=n.getDay();r.firstChild.data=k+", "+g;if(v===1&&e){t+=1}while(q<n){a=b[q++];a[w]=" ";a.className=l.hiddenDayClass}while(o++<t){a=b[q++];a[w]=o;a.className=""}for(q=n+t,o=b.length;q<o;q++){a=b[q];a[w]=" ";a.className=l.hiddenDayClass}var m=s.getElementById(l.id+"-selected-day");if(m){m.id=""}if(x.getYear()==u.getYear()&&x.getMonth()==u.getMonth()){var f=n+x.getDate()-1;l.currentDayIndex=f;var p=b[f];E.addClass(p,l.calendarClass+"-today")}if(u.getYear()==u.getYear()&&u.getMonth()==u.getMonth()){var Z=n+u.getDate();a=b[Z-1];E.addClass(a,l.calendarClass+"-selected-day");a.id=l.id+"-selected-day"}}function R(f){if(!f.calendarId){f.calendarId=f.id+"-calendar"}var i=document;if(i.getElementById(f.calendarId)!==null){return}var j=i.createElement("div"),b=Array.prototype.join,c=b.call({length:7+1},"<td><b>&nbsp;</b></td>"),g=b.call({length:6+1},"<tr>"+c+"</tr>\n"),Z=G.CalendarLocale,a=Z.days.abbr,e="<tbody>"+g+"</tbody>",h="<thead><tr class='calendar-button-row'><th id='"+f.id+"-prev-year' title='"+Z.previousYear+"'>&#x00ab;</th><th id='"+f.id+"-prev-month' title='"+Z.previousMonth+"'>&#x2039;</th><th colspan='3' class='ape-calendar-header'><div id='"+f.calendarId+"-header'>&nbsp;</div></th><th id='"+f.id+"-next-month' title='"+Z.nextMonth+"' class='"+f.calendarClass+"-days'>&#x203A;</th><th id='"+f.id+"-next-year' title='"+Z.nextYear+"'>&#x00bb;</th></tr><tr><th>"+a.join("</th><th>")+"</th></tr></thead>";j.onselectstart=K;j.innerHTML="<table>"+h+e+"</table>";j.id=f.calendarId;j.className=f.calendarClass;j.onmousedown=j.onfocus=T;i.body.appendChild(j)}function Q(a){a=a||self.event;var Z=G.Calendar.getById(this.id);Y(Z,a)}function Y(a,Z){if(I){a.onshow(Z);return}R(a);var b=document.getElementById(a.calendarId).style;a._isHidden=false;if(D!==null){if(D===a){return}else{S(D,Z)}}N(a,b);D=a;a.onshow(Z);a.show(b);a.setDate(a.displayDate)}function N(b,c){var Z=document.getElementById(b.id),a=E.getOffsetCoords(Z);c.left=a.x+"px";c.top=a.y+Z.offsetHeight+"px"}function S(a,Z){if(a._isHidden||a._hasFocus){return}a.onhide(Z);if(I){return}if(D===a){D=null}a.hide(document.getElementById(a.calendarId).style);a._isHidden=true}function T(h){h=h||window.event;var g=E.Event.getTarget(h),f=this,b,d,c=g.id,a,Z;b=G.Calendar.getById(f.id.replace(/-calendar$/,""));d=b.id;clearTimeout(b.hideTimer);a=d+"-selected-day";b._hasFocus=true;if(/^b$/i.test(g.tagName)){if(c!==a){Z=+g.firstChild.data;if(Z){L(b,Z,g,a)}}}else{O(b,c,d)}}function L(b,Z,f,a,d){var c;b._hasFocus=!b.hideOnSelect;c=document.getElementById(a);if(c){E.removeClass(c,"ape-calendar-selected-day");c.id=""}f.id=a;E.addClass(f,"ape-calendar-selected-day");U(b,Z);b.onselect();if(b.hideOnSelect){setTimeout(function(){S(b,d);b._hasFocus=false;b=null},115)}}function O(a,b,c){var Z=new Date(a.displayDate),d;if(b===c+"-next-year"){d=Z.setFullYear(Z.getFullYear()+1)}else{if(b===c+"-prev-year"){d=Z.setFullYear(Z.getFullYear()-1)}else{if(b===c+"-next-month"){d=Z.setMonth(Z.getMonth()+1)}else{if(b===c+"-prev-month"){d=Z.setMonth(Z.getMonth()-1)}}}}if(d){a.setDate(Z)}}function U(b,Z){b.displayDate.setDate(Z);var a=V(b.displayDate);document.getElementById(b.id).value=a}function K(){return false}function W(){}function V(a){var c=("000"+a.getFullYear()).slice(-4),b=("0"+(a.getMonth()+1)).slice(-2),Z=("0"+(a.getDate())).slice(-2);return c+"-"+b+"-"+Z}function P(b){var a=G.Calendar.getById(this.id);a.hideTimer=setTimeout(Z,10);function Z(){S(a,b||self.event)}}function M(b){var a=E.Event.getTarget(b),Z;if(D!==null){Z=document.getElementById(D.calendarId);if(!Z){D=null;return}if(E.contains(Z,a)||a===Z){return}D._hasFocus=false;S(D,b)}}}})();