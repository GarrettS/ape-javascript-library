APE.namespace("shopping.widget");shopping.widget.Carousel=function(C,B,A){this.id=C;this.timeDuration=B||250;this.isVertical=!!A;this._queue=0;this.init()};shopping.widget.Carousel.prototype={pos:0,init:function(){var B=document.getElementById(this.id),K,H=B.childNodes,E,G,J=APE.dom.Event.addCallback,D=this.isVertical?"offsetTop":"offsetLeft",L=this.isVertical?"offsetHeight":"offsetWidth",I=shopping.widget.Carousel;this.style=B.style;this.clientDimension=this.isVertical?"clientHeight":"clientWidth";this.stylePos=this.isVertical?"top":"left";for(E=0,G=H.length;E<G;E++){K=H[E];if(!K){break}if(!("tagName" in K)){K.parentNode.removeChild(K)}}this.scrollDistance=B.lastChild[D]+B.lastChild[L];this.frameSize=B.parentNode[this.clientDimension];var A=this.isVertical?"height":"width";this.style[A]=this.scrollDistance+10+"px";var C=document.getElementById(this.id+"Prev"),F=document.getElementById(this.id+"Next");if(C){J(C,"click",I.handleButtonClick)}if(F){J(F,"click",I.handleButtonClick)}},moveStart:function(B){if(this.timerId){this._queue+=B?1:-1;return}var D=document.getElementById(this.id+"Frame")[this.clientDimension],C=APE.dom;if(this.scrollDistance<=D){return}if(B){D=-D}this.newPos=this.pos+D;if(!B){C.removeClass(document.getElementById(this.id+"Next"),"carouselButton-disabled");if(this.newPos>=0){D=-this.pos;this.newPos=0;C.addClass(document.getElementById(this.id+"Prev"),"carouselButton-disabled")}}else{if(this.pos===0&&this.newPos){C.removeClass(document.getElementById(this.id+"Prev"),"carouselButton-disabled")}if(this.newPos<=this.frameSize-this.scrollDistance){C.addClass(document.getElementById(this.id+"Next"),"carouselButton-disabled");var A=this.scrollDistance+this.pos-this.frameSize;D=-A;this.newPos=this.pos-A}}this.startTime=new Date().valueOf();this.startPos=this.pos;this.dx=D;this.timerId=window.setInterval("shopping.widget.Carousel.instances['"+this.id+"'].move()",12)},move:function(){var A=new Date-this.startTime,C=A/this.timeDuration,B=(Math.atan(1.4*(2*C-1))/Math.atan(1.4)+1)/2;if(C>=1){return this.moveEnd()}this.style[this.stylePos]=(this.pos=0|this.startPos+this.dx*B)+"px"},moveEnd:function(){window.clearInterval(this.timerId);this.timerId=null;this.style[this.stylePos]=(this.pos=this.newPos)+"px";if(typeof this.onend=="function"){this.onend()}if(this._queue!==0){var A=this._queue>0;this._queue+=A?-1:1;this.moveStart(A)}}};shopping.widget.Carousel.getById=APE.getById;shopping.widget.Carousel.handleButtonClick=function(){var A=this.id.match(/(\w+)(Next|Prev)$/),B=shopping.widget.Carousel.getById(A[1]);B.moveStart(A[2]==="Next")};