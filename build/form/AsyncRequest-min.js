APE.namespace("APE.ajax");APE.ajax.AsyncRequest=function(A){this.httpMethod=A.method&&A.method.toLowerCase()||"get";this.uri=A.action;if(!this.uri){throw URIError("formConfig.action = undefined")}this.enctype=A.enctype;if(!this.enctype&&this.httpMethod=="post"){this.enctype="application/x-www-form-urlencoded"}if(window.XMLHttpRequest){this.req=new XMLHttpRequest()}else{if(window.ActiveXObject){this.req=new ActiveXObject("Microsoft.XMLHTTP")}}};APE.ajax.AsyncRequest.toString=function(){return"[object ajax.AsyncRequest]"};APE.ajax.AsyncRequest.prototype={onabort:function(){},oncomplete:function(){},onsucceed:function(){},onfail:function(){},ontimeout:function(){},timeoutMillis:0,send:function(B,C){if(typeof C=="number"){this.timeoutMillis=C}this._setUpReadyStateChangeHandler();this.req.open(this.httpMethod,this.uri,true);if(this.req.setRequestHeader){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof B=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(typeof B.unshift=="function"&&this.enctype=="multipart/form-data"){var E="DATA"+(new Date-0),D="\r\n";this.req.setRequestHeader("Content-Type",this.enctype+"; boundary="+E);E=D+"--"+E;B=E+D+B.join(E+D)+E+"--"+D+D}}}}try{this.req.send(B||null);return this}catch(A){return this}},abort:function(){this.req.abort();APE.ajax.AsyncRequest._cancelPoll(this._pollId);window.clearInterval(this.timeoutID);this.onabort(this.req);this.oncomplete({successful:false})},toString:function(){var B="ajax.AsyncRequest: \nuri: "+this.uri+"\nhttpMethod: "+this.httpMethod+"\n----------------------\nreq: \n",C;for(C in this.req){try{if(typeof this.req[C]=="string"){B.concat(C+": "+this.req[C]+"\n")}}catch(A){}}return B},_setUpReadyStateChangeHandler:function(){var C=this;this._pollId=window.setInterval(A,50);if(this.timeoutMillis>0){var B=function(){APE.ajax.AsyncRequest._cancelPoll(C._pollId);C.ontimeout()};this.timeoutID=setTimeout(B,this.timeoutMillis)}function A(){if(C.req.readyState==4){D()}}function D(){APE.ajax.AsyncRequest._cancelPoll(C._pollId);var E=C.req.status;var F=E>=200&&E<300||E==304||E==1223;if(F){C.oncomplete({successful:true});C.onsucceed(C.req)}else{C.oncomplete({successful:false});C.onfail(C.req)}clearInterval(C.timeoutID)}}};APE.ajax.AsyncRequest._cancelPoll=function(A){window.clearInterval(A)};