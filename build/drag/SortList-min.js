(function(){var H=APE.dom,C=APE.drag.SortList=APE.createFactory(G),B=APE.drag.Draggable;function G(K,I){this.id=K;var J=document.getElementById(K);J.onmousedown=D;this.dragOptions=I}function D(J){var L=H.Event.getTarget(J),I=L.tagName==="LI"?L:H.findAncestorWithTagName(L,"LI"),K;if(I){K=B.getByNode(I,C.getById(this.id).dragOptions)}K.ondragend=F}function F(P){var L=this.el,Q=H.Event.getCoords(P.domEvent),O=P.draggableList,M=L.parentNode,J,K,N,I=[];H.addClass(M,"hiddenSelection");K=A(M,O,Q.y);for(J in O){L=O[J].el;L.style.top="";I[I.length]=L}I.sort(E);for(N=0;N<I.length;N++){M.insertBefore(I[N],K)}H.removeClass(M,"hiddenSelection")}function A(L,M,N){var P=L.getElementsByTagName("li"),O,I,K,J,Q=H.getOffsetCoords(L).y;for(K=0;K<P.length;K++){O=P[K];J=O.id;if(!J||!(J in M)){I=H.getOffsetCoords(O).y;if(I+Q>N){return O}}}return null}var E=function(J,I){var K=document.documentElement,L;if(typeof K.sourceIndex=="number"){L=function(N,M){return N.sourceIndex-M.sourceIndex}}else{if("compareDocumentPosition" in K){L=function(N,M){return M.compareDocumentPosition(N)-3}}}K=null;return(E=L)(J,I)}})();