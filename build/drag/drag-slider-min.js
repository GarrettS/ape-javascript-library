APE.namespace("APE.drag");
(function(){function T(d,h){var i=document,l=i.getElementById(d),o;this.id=d;this.el=this.origEl=l;this.style=l.style;d=(this.isRel=p(l,"position").toLowerCase()=="relative")?l.parentNode:j.getContainingBlock(l);if(d===null)d=i.documentElement;this.container=d;this.dropTargets=[];this.handle=l;this.onbeforeexitcontainer=U;if(h){for(o in h)this[o]=h[o];l.style.zIndex=A(p(l,"zIndex"),10)||B++}}function U(){return!this.keepInContainer}function F(){var d,h,i;for(d in this.instances){i=this.instances[d];
for(h in i)delete i[h];delete this.instances[d]}n={}}function N(){function d(){function a(k){var m=!f;if(g)this[ea].style[g]=m?"":"none";else(k||window.event||0).returnValue=m}var b="serSelect",c="MozU"+b,e="MozU"+b;b="u"+b;var g=c in I?c:e in I?e:b in I?b:"";c="onselectstart";c in v?J(v,c,a):V.addAfter(a)}function h(a,b){return b===a.handle||a.useHandleTree&&j.contains(a.handle,b)}function i(a,b){if(b){a.selectedClassName&&j.addClass(a.el,a.selectedClassName);if(a.dragMultiple&&!(a.id in n))n[a.id]=
a}else{a.selectedClassName&&j.removeClass(a.el,a.selectedClassName);delete n[a.id]}a.isSelected=b}function l(a){var b=a.container,c=a.el,e=document,g=e.documentElement;g=j.getContainingBlock(c)||g;var k=g===b?{x:0,y:0}:j.getOffsetCoords(g,b),m=j.getPixelCoords(c),w=j.getOffsetCoords(c,c.parentNode);g=w.x-m.x+k.x;k=w.y-m.y+k.y;if(a.keepInContainer){if(b===e.body){e=A(p(b,"width"),10);b=A(p(b,"height"),10)}else{e=b.clientWidth;b=b.clientHeight}a.minX=0-g;a.maxX=e-c.offsetWidth-g;a.minY=0-k;a.maxY=b-
c.offsetHeight-k}}function o(){x(i,[false],true);K=false}function W(a){fa(f);var b,c,e;if(y!==false){c=0;for(e=y.length;c<e;c++){b=y[c];if(b.hasDropTargetOver){typeof b.ondragout==q&&b.ondragout(a,f);b.dragOverClassName&&j.removeClass(b.el,b.dragOverClassName);b.hasDropTargetOver=false}}}x(fa)}function X(a){a.activeDragClassName&&j.removeClass(a.el,a.activeDragClassName);za(a);ga&&a.el.releaseCapture();a.hasBeenDragged=false}function Y(){if(f.hasBeenDragged)if(f.dragMultiple)n[f.id]=f;else n={};O=
false;P.remove(document,Q,Z);f=null}function Aa(a,b){if(b)a.id in n?i(a,false):i(a,true);else if(!a.isSelected){o();i(a,true)}}function ha(a){var b=a.el,c=a.copyEl;if(!c)c=a.copyEl=document.getElementById(a.proxyId);ia(a,c,b)}function Ba(a){if(!a.copyEl){a.copyEl=a.el.cloneNode(true);a.copyEl.id+="Copy"}ia(a,a.copyEl,a.el)}function ia(a,b,c){var e=b.style;a.origEl=c;e.zIndex=A(c.style.zIndex,10)+100;a.el=b;a.style=e;var g=p(c,"display");e.display=g;if(a.dragCopy){c.parentNode.insertBefore(b,c);a.isRel&&
Ca(e,c,g)}else Da(a,b,c)}function Da(a,b,c){b=j.getOffsetCoords(c,b.parentNode);a.moveToX(b.x);a.moveToY(b.y)}function Ca(a,b,c){if(c=="inline")a.marginRight=-b.offsetWidth+-(A(p(b,"marginRight"),10)||0)+"px";else a.marginBottom=-b.offsetHeight+-(A(p(b,"marginBottom"),10)||0)+"px"}function R(a){var b=a.copyEl;if(b){a.el=a.origEl;a.style=a.el.style;a.moveToX(a.x);a.moveToY(a.y);b.style.display="none";a.dragCopy&&!a.proxyId&&a.el.parentNode.insertBefore(b,a.el)}}function G(a,b){!K||$||x(Ea,[a,b])}function Ea(a,
b,c){typeof b=="number"&&a.moveToX(a.origX+b);typeof c=="number"&&a.moveToY(a.origY+c)}function ja(a,b){if(!a.isBeingDragged){a.dragCopy&&!a.proxyId&&Ba(a);typeof a.ondragstart==q&&a.ondragstart(ka(a,b));ga&&a.el.setCapture();a.activeDragClassName&&j.addClass(a.el,a.activeDragClassName);l(a);a.isBeingDragged=true}}function ka(a,b){var c=a.id,e={},g=1;e[c]=a;if(K)for(c in n){e[c]=n[c];g++}return{domEvent:b,draggableList:e,count:g}}function Fa(a){if(s)s=false;else{var b=a||window.event;if(!(aa&&f)){a=
la(a,"touches");var c=r.getTarget(b),e=a.metaKey||a.ctrlKey,g=Ga(c);if(g){if(!g.isDragEnabled){e||o();return false}if(!e&&g.hasHandleSet&&!h(g,c))o();else{!e&&!g.isSelected&&o();a.returnValue=false;if(e&&f&&!g.dragMultiple){O=true;return false}if(!g.dragMultiple)if(e){O=true;return false}else o();Aa(g,e);g.style.zIndex=++B;if(ba(g,a)!=false){f=g;ca(b);x(ba,[a]);return c.tagName!=="IMG"}}}else if(!e){o();if(f){i(f,false);f=null}}}}}function Ga(a){for(var b,c=C.instances;!b&&a!==null;a=j.findAncestorWithAttribute(a,
"id"))b=c[a.id];return b}function Ha(){if(f){var a=f.dropTargets,b,c,e,g;if(!a)return y=false;y=[];c=e=0;for(g=a.length;c<g;c++){b=a[c];b.initCoords();if(b.ondragover||b.ondragout||b.dragOverClassName)y[e++]=b}if(e===0)y=false}}function ba(a,b){if(typeof a.onbeforedragstart==q&&a.onbeforedragstart(ka(a,b))==false)return false;b=S(b);a.proxyId&&!a.dragCopy&&ha(a);Ia(a);ma=b.x;na=b.y;b=j.getPixelCoords(a.el);a.origX=a.grabX=b.x;a.origY=a.grabY=b.y;a.isBeingDragged=false;J(document,Q,Z)}function Ia(a){var b=
a.constraint;if(b==="y")a.moveToX=D;else if(b==="x")a.moveToY=D}function za(a){delete a.moveToX;delete a.moveToY}function Z(a){if(f){var b=+new Date;if(!(b-oa<Ja)){oa=b;b=a=a||event;if(aa){a=a.touches&&a.touches[0];if(!a)return;ca(b)}var c=S(a);b=c.x;c=c.y;var e=b-ma,g=c-na,k=f.origX+e,m=f.origY+g,w;if(f.isBeingDragged===false){$=!!f.proxyId;for(w in n){K=true;break}delete n[f.id];ja(f,a);f.proxyId&&f.dragCopy&&ha(f);x(ja,[a])}f.hasBeenDragged=f.hasBeenDragged||!!(e||g);if(!(typeof f.onbeforedrag==
q&&f.onbeforedrag(a)==false)){w=typeof f.ondrag===q;if(!Ka(f,k,m,e,g,w,a)){f.isAtLeft=f.isAtRight=f.isAtTop=f.isAtBottom=false;f.moveToX(k);f.moveToY(m);G(e,g);w&&f.ondrag(a)}y!==false&&La(f,a,b,c);return false}}}}function Ka(a,b,c,e,g,k,m){if(a.container){var w=b<a.minX,pa=b>a.maxX,qa=c<a.minY,ra=c>a.maxY,L;if(w||pa||qa||ra&&a.onbeforeexitcontainer()!=true){if(w){if(!a.isAtLeft){a.moveToX(a.minX);G(a.minX-a.origX,null);k&&a.ondrag(m);a.isAtRight=false;a.isAtLeft=true}L=true}else if(pa){if(!a.isAtRight){a.moveToX(a.maxX);
G(a.maxX-a.origX,null);k&&a.ondrag(m);a.isAtRight=true;a.isAtLeft=false}L=true}else{a.isAtLeft=a.isAtRight=false;a.moveToX(b);G(e,null)}if(qa){if(!a.isAtTop){a.moveToY(a.minY);G(null,a.minY-a.origY);k&&a.ondrag(m);a.isAtTop=true;a.isAtBottom=false}L=true}else if(ra){if(!a.isAtBottom){a.maxY>0&&a.moveToY(a.maxY);G(null,a.maxY-a.origY);k&&a.ondrag(m);a.isAtTop=false;a.isAtBottom=true}L=true}else{a.isAtTop=a.isAtBottom=false;a.moveToY(c);G(null,g)}if(L)a.ondragstop(m);else k&&a.ondrag(m);return true}}return false}
function Ma(a){s=false;P.remove(document,Q,Z);if(f){var b=f.hasBeenDragged;b=f.isBeingDragged&&!b;a=la(a,"changedTouches");if(!f.hasBeenDragged&&!b){if(!O){R(f);Y(a)}}else{$||x(Na);x(R);R(f);Oa(a);x(X,[a]);n[f.id]=f;X(f,a);f.ondragend({domEvent:a,draggableList:n});f&&Y(a)}}}function Na(a){var b=a.x,c=a.y;if(b<a.minX)a.moveToX(a.minX);else b>a.maxX&&a.moveToX(a.maxX);if(c<a.minY)a.moveToY(a.minY);else c>a.maxY&&a.moveToY(a.maxY)}function x(a,b,c){if(K||c){var e;b=b||[];b.unshift(0);for(e in n){c=b[0]=
n[e];a.apply(c,b)}}}function sa(a){if(f){a=a||event;if(a.keyCode==27||a.type==="touchcancel")f.release(a)}}function La(a,b,c,e){c={x:c,y:e};e=0;for(var g=y.length,k={domEvent:b,dragObj:a};e<g;e++){a=y[e];b=a.containsCoords(c);if(!a.hasDropTargetOver&&b){a.hasDropTargetOver=true;typeof a.ondragover==q&&a.ondragover(k);a.dragOverClassName&&j.addClass(a.el,a.dragOverClassName)}else if(a.hasDropTargetOver&&!b){typeof a.ondragout==q&&a.ondragout(k);a.dragOverClassName&&j.removeClass(a.el,a.dragOverClassName);
a.hasDropTargetOver=false}}}function Oa(a){var b=f.dropTargets,c,e,g=b.length,k,m;if(g){e=S(a);for(k=0;k<g;k++){c=b[k];if(typeof c.ondrop===q&&c.containsCoords(e)){c.ondrop(ta(a,f));x(Pa,[c,a])}(m=c.dragOverClassName)&&j.removeClass(c.el,m)}}}function ta(a,b){return{domEvent:a,dragObj:b}}function Pa(a,b,c){a.id!==b.id&&b.ondrop(ta(c,a))}function la(a,b){return a&&a[b]&&a[b][0]||a||event}function Qa(a){var b=z.anim,c=new b.Animation(0.2);c.transition=b.Transitions.accel;c.run=Ra;c.dObj=a;c.onplay=
a.onglide;c.onend=Sa;c.start()}function Ra(a){var b=this.dObj,c=b.x-b.grabX,e=b.y-b.grabY;a=Math.pow(a,3);b.moveToX(b.x-c*a);b.moveToY(b.y-e*a)}function Sa(){ua(this.dObj)}function ua(a){typeof a.onglideend==q&&a.onglideend();R(a)}function fa(a){if(z.anim&&a.useAnim)Qa(a);else{a.moveToX(a.grabX);a.moveToY(a.grabY);typeof a.onglide==q&&a.onglide();ua(a,{})}}var v=document,P=z.EventPublisher,J=P.add,ca=r.preventDefault,ea="documentElement",I=v[ea].style,da="px",va="left",wa="top",O=false,ga="setCapture"in
document.documentElement,ma=0,na=0,f,y=false,K=false,$=false,Ja=25,oa=-1,xa="onmousedown",Q="onmousemove",ya="onmouseup",aa,V,S=r.getCoords;if("ontouchstart"in v){aa=true;xa="ontouchstart";Q="ontouchmove";ya="ontouchend";J(v,"ontouchcancel",sa)}V=P.get(v,xa);if("pixelLeft"in I){da=0;va="pixelLeft";wa="pixelTop"}J(v,"onkeydown",sa);J(v,ya,Ma);d(v,I);V.add(Fa).addAfter(Ha);v=I=null;return{dragCopy:false,useAnim:true,dragMultiple:false,selectedClassName:"",activeDragClassName:"",useHandleTree:true,isSelected:false,
onbeforedrag:t,onbeforedragstart:D,ondragstart:t,ondrag:t,ondragstop:D,ondragend:D,x:0,y:0,origX:0,origY:0,grabX:0,grabY:0,keepInContainer:false,isDragEnabled:true,hasHandleSet:false,setHandle:function(a,b){this.handle=a;this.hasHandleSet=true;this.useHandleTree=b!=false},dropTargets:false,addDropTarget:function(a){a=E.getByNode(a);var b=a.el,c=this.dropTargets;if(this.el===b)return a;return c[c.length]=E.getByNode(b)},grab:function(a,b,c){a=a||window.event;var e=r.getTarget(a);ca(a);if(!j.contains(this.el,
e)){e=j.getPixelCoords(this.el);this.grabX=e.x;this.grabY=e.y;var g=S(a);e=this.handle;var k=j.getOffsetCoords(j.getContainingBlock(this.el)),m=g.x-k.x;m=m-(0|e.offsetWidth/2);g=g.y-k.y;g=g-(0|e.offsetHeight/2);e=j.getOffsetCoords(e,this.el);if(this.keepInContainer){m=Math.max(m,0);m=Math.min(m,this.container.clientWidth-this.el.offsetWidth);g=Math.max(g,0);g=Math.min(g,this.container.clientHeight-this.el.offsetHeight)}this.moveToX(m-e.x+(b||0));this.moveToY(g-e.y+(c||0));ba(this,a);s=true;f=this}},
release:function(a){a=a||{};x(X,[a]);typeof this.onrelease==q&&this.onrelease(a);W(a);Y(a)},moveToX:function(a){this.style[va]=(this.x=a)+da},moveToY:function(a){this.style[wa]=(this.y=a)+da},removeDropTarget:function(a){a=document.getElementById(a.id);var b=this.dropTargets,c,e;c=0;for(e=b.length;c<e;c++)if(b[c].el===a){b.splice(c,1);return a}return null},toString:function(){return"Draggable(id="+this.id+")"}}}function H(d){this.el=document.getElementById(d);this.id=d}function M(){return{dragOverClassName:"",
initCoords:function(){var d=this.coords||(this.coords={}),h=this.el;j.getOffsetCoords(h,document,d);d.w=h.clientWidth;d.h=h.clientHeight},containsCoords:function(d){var h=this.coords,i=h.x,l=h.y;return d.x>=i&&d.x<=i+h.w&&d.y>=l&&d.y<=l+h.h},ondragover:false,ondragout:t,ondrop:t}}var z=self.APE,j=z.dom,p=j.getStyle,u=z.drag,r=j.Event,B=1E3,n={},t,D=Function.prototype,A=self.parseInt,s,q="function",C=z.createFactory(T,N),E=z.createFactory(H,M);u.Draggable=C;u.DropTarget=E;C.instanceDestructor=F})();
(function(){function T(r,B,n,t){this.id=r;this.dir=B;this.rationalValue=this.value=0;r=N.Draggable.getById(r,B);r.keepInContainer=true;this.handle=r;this[p]=n||0;this[u]=t;this.tDist=0;this.init()}function U(){var r;function B(){}function n(d){var h=H.Event.getTarget(d);if(h!==this)return true;h=M.instances[this.getElementsByTagName("*")[0].id];d=d||self.event;d.preventDefault&&d.preventDefault();H.addClass(this,C);h.handle.grab(d);s.call(h,d);return false}function t(d){H.removeClass(this.trackbar,
C);s.call(this,d);typeof this.onslideend==="function"&&this.onslideend(d)}function D(){E=this;H.addClass(this.trackbar,C)}function A(){if(E===this)E=null;H.removeClass(this.trackbar,C)}function s(d){this.value=0;var h=document.getElementById(this.id),i=0;if(this.dir===z)i=h.offsetLeft>0?h.offsetLeft/this.tDist:0;else if(h.offsetTop>0){h=this.tDist-h.offsetTop;i=h/this.tDist}else i=1;this.rationalValue=i;this.value=i*(this[u]-this[p]);if(this.onslide)this.onslide(d||{})}function q(d){d=d||self.event;
d.stopPropagation&&d.stopPropagation();d.cancelBubble=true;var h=+new Date,i=E;if(i)if(!(h-r<5)){r=h;var l=d.keyCode,o;h=l===37;o=l===39;var W=l===38;l=l===40;if(!(h||o||W||l))return true;if(i.id in M.instances){o=i[u]/i.ticks;if(h||l)o=-o;i.setValue(i.value+o);i.onslide&&i.onslide(d);return false}}}F.EventPublisher.add(document,"onkeydown",q);var C="ape-slider-track-active",E=null;return{init:function(){var d=F.EventPublisher,h=document.getElementById(this.id),i=this.handle,l=this.trackbar=document.getElementById(this.id).parentNode;
d.add(i,"onglideend",t,this);d.add(i,"ondragend",t,this);d.add(i,"onglideend",t,this);d.add(i,"ondrag",s,this);"focus"in i||d.add(h,"onmousedown",D,this);d.add(h,"onfocus",D,this);d.add(h,"onblur",A,this);d.add(i,"onglide",s,this);d.add(i,"ondragstop",s,this);if(this.dir===j){this.tDist=l.clientHeight-h.offsetHeight;i.moveToX=B}else{this.tDist=l.clientWidth-h.offsetWidth;i.moveToY=B}if(this[u]===undefined)this[u]=this.tDist;d.add(l,"onmousedown",n,l)},ticks:15,rationalValue:0,slideToX:function(d){this.handle.moveToX(d);
typeof slider.onslide==="function"&&slider.onslide()},setValue:function(d){d=Math.max(this[p],d);d=Math.min(this[u],d);var h=this.handle,i=this[u]-this[p];i=(d-this[p])/i;if(h&&h.id){this.dir===j?h.moveToY(this.tDist*(1-i)):h.moveToX(this.tDist*i);this.rationalValue=i;this.value=d}},slideToY:function(d){this.handle.moveToY(d);this.onslide()},setRationalValue:function(d,h){d=Math.max(0,d);this.rationalValue=d=Math.min(1,d);this.setValue(this[p]+d*(this[u]-this[p]));h&&s.call(this,{})},toString:function(){return"Slider: "+
this.handle.toString()}}}var F=self.APE,N=F.drag,H=F.dom,M=N.Slider=F.createFactory(T,U),z=1,j=2,p="minValue",u="maxValue";M.direction={HORZ:z,VERT:j}})();
