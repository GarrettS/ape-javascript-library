APE.namespace("APE.drag");
(function(){function U(d,h){var i=document,k=i.getElementById(d),o;this.id=d;this.el=this.origEl=k;this.style=k.style;d=(this.isRel=p(k,"position").toLowerCase()=="relative")?k.parentNode:j.getContainingBlock(k);if(d===null)d=i.documentElement;this.container=d;this.dropTargets=[];this.handle=k;this.onbeforeexitcontainer=V;if(h){for(o in h)this[o]=h[o];k.style.zIndex=A(p(k,"zIndex"),10)||B++}}function V(){return!this.keepInContainer}function F(){var d,h,i;for(d in this.instances){i=this.instances[d];
for(h in i)delete i[h];delete this.instances[d]}n={}}function O(){function d(){function a(l){var m=!f;if(g)this[fa].style[g]=m?"":"none";else(l||window.event||0).returnValue=m}var b="serSelect",c="MozU"+b,e="MozU"+b;b="u"+b;var g=c in I?c:e in I?e:b in I?b:"";c="onselectstart";c in v?J(v,c,a):W.addAfter(a)}function h(a,b){return b===a.handle||a.useHandleTree&&j.contains(a.handle,b)}function i(a,b){if(b){a.selectedClassName&&j.addClass(a.el,a.selectedClassName);if(a.dragMultiple&&!(a.id in n))n[a.id]=
a}else{a.selectedClassName&&j.removeClass(a.el,a.selectedClassName);delete n[a.id]}a.isSelected=b}function k(a){var b=a.container,c=a.el,e=document,g=e.documentElement;g=j.getContainingBlock(c)||g;var l=g===b?{x:0,y:0}:j.getOffsetCoords(g,b),m=j.getPixelCoords(c),w=j.getOffsetCoords(c,c.parentNode);g=w.x-m.x+l.x;l=w.y-m.y+l.y;if(a.keepInContainer){if(b===e.body){e=A(p(b,"width"),10);b=A(p(b,"height"),10)}else{e=b.clientWidth;b=b.clientHeight}a.minX=0-g;a.maxX=e-c.offsetWidth-g;a.minY=0-l;a.maxY=b-
c.offsetHeight-l}}function o(){x(i,[false],true);K=false}function X(a){ga(f);var b,c,e;if(y!==false){c=0;for(e=y.length;c<e;c++){b=y[c];if(b.hasDropTargetOver){typeof b.ondragout==q&&b.ondragout(a,f);b.dragOverClassName&&j.removeClass(b.el,b.dragOverClassName);b.hasDropTargetOver=false}}}x(ga)}function Y(a){a.activeDragClassName&&j.removeClass(a.el,a.activeDragClassName);Aa(a);ha&&a.el.releaseCapture();a.hasBeenDragged=false}function Z(){if(f.hasBeenDragged)if(f.dragMultiple)n[f.id]=f;else n={};P=
false;Q.remove(document,R,$);f=null}function Ba(a,b){if(b)a.id in n?i(a,false):i(a,true);else if(!a.isSelected){o();i(a,true)}}function ia(a){var b=a.el,c=a.copyEl;if(!c)c=a.copyEl=document.getElementById(a.proxyId);ja(a,c,b)}function Ca(a){if(!a.copyEl){a.copyEl=a.el.cloneNode(true);a.copyEl.id+="Copy"}ja(a,a.copyEl,a.el)}function ja(a,b,c){var e=b.style;a.origEl=c;e.zIndex=A(c.style.zIndex,10)+100;a.el=b;a.style=e;var g=p(c,"display");e.display=g;if(a.dragCopy){c.parentNode.insertBefore(b,c);a.isRel&&
Da(e,c,g)}else Ea(a,b,c)}function Ea(a,b,c){b=j.getOffsetCoords(c,b.parentNode);a.moveToX(b.x);a.moveToY(b.y)}function Da(a,b,c){if(c=="inline")a.marginRight=-b.offsetWidth+-(A(p(b,"marginRight"),10)||0)+"px";else a.marginBottom=-b.offsetHeight+-(A(p(b,"marginBottom"),10)||0)+"px"}function S(a){var b=a.copyEl;if(b){a.el=a.origEl;a.style=a.el.style;a.moveToX(a.x);a.moveToY(a.y);b.style.display="none";a.dragCopy&&!a.proxyId&&a.el.parentNode.insertBefore(b,a.el)}}function G(a,b){!K||aa||x(Fa,[a,b])}
function Fa(a,b,c){typeof b=="number"&&a.moveToX(a.origX+b);typeof c=="number"&&a.moveToY(a.origY+c)}function ka(a,b){if(!a.isBeingDragged){a.dragCopy&&!a.proxyId&&Ca(a);typeof a.ondragstart==q&&a.ondragstart(la(a,b));ha&&a.el.setCapture();a.activeDragClassName&&j.addClass(a.el,a.activeDragClassName);k(a);a.isBeingDragged=true}}function la(a,b){var c=a.id,e={},g=1;e[c]=a;if(K)for(c in n){e[c]=n[c];g++}return{domEvent:b,draggableList:e,count:g}}function Ga(a){if(s)s=false;else{var b=a||window.event;
if(!(ba&&f)){a=ma(a,"touches");var c=r.getTarget(b),e=a.metaKey||a.ctrlKey,g=Ha(c);if(g){if(!g.isDragEnabled){e||o();return false}if(!e&&g.hasHandleSet&&!h(g,c))o();else{!e&&!g.isSelected&&o();a.returnValue=false;if(e&&f&&!g.dragMultiple){P=true;return false}if(!g.dragMultiple)if(e){P=true;return false}else o();Ba(g,e);g.style.zIndex=++B;if(ca(g,a)!=false){f=g;da(b);x(ca,[a]);return c.tagName!=="IMG"}}}else if(!e){o();if(f){i(f,false);f=null}}}}}function Ha(a){for(var b,c=C.instances;!b&&a!==null;a=
j.findAncestorWithAttribute(a,"id"))b=c[a.id];return b}function Ia(){if(f){var a=f.dropTargets,b,c,e,g;if(!a)return y=false;y=[];c=e=0;for(g=a.length;c<g;c++){b=a[c];b.initCoords();if(b.ondragover||b.ondragout||b.dragOverClassName)y[e++]=b}if(e===0)y=false}}function ca(a,b){if(typeof a.onbeforedragstart==q&&a.onbeforedragstart(la(a,b))==false)return false;b=T(b);a.proxyId&&!a.dragCopy&&ia(a);Ja(a);na=b.x;oa=b.y;b=j.getPixelCoords(a.el);a.origX=a.grabX=b.x;a.origY=a.grabY=b.y;a.isBeingDragged=false;
J(document,R,$)}function Ja(a){var b=a.constraint;if(b==="y")a.moveToX=D;else if(b==="x")a.moveToY=D}function Aa(a){delete a.moveToX;delete a.moveToY}function $(a){if(f){var b=+new Date;if(!(b-pa<Ka)){pa=b;b=a=a||event;if(ba){a=a.touches&&a.touches[0];if(!a)return;da(b)}var c=T(a);b=c.x;c=c.y;var e=b-na,g=c-oa,l=f.origX+e,m=f.origY+g,w;if(f.isBeingDragged===false){aa=!!f.proxyId;for(w in n){K=true;break}delete n[f.id];ka(f,a);f.proxyId&&f.dragCopy&&ia(f);x(ka,[a])}f.hasBeenDragged=f.hasBeenDragged||
!!(e||g);if(!(typeof f.onbeforedrag==q&&f.onbeforedrag(a)==false)){w=typeof f.ondrag===q;if(!La(f,l,m,e,g,w,a)){f.isAtLeft=f.isAtRight=f.isAtTop=f.isAtBottom=false;f.moveToX(l);f.moveToY(m);G(e,g);w&&f.ondrag(a)}y!==false&&Ma(f,a,b,c);return false}}}}function La(a,b,c,e,g,l,m){if(a.container){var w=b<a.minX,qa=b>a.maxX,ra=c<a.minY,sa=c>a.maxY,L,M;if(w||qa||ra||sa&&a.onbeforeexitcontainer()!=true){if(w){if(!a.isAtLeft){a.moveToX(a.minX);G(a.minX-a.origX,null);M=l;a.isAtRight=false;a.isAtLeft=true}L=
true}else if(qa){if(!a.isAtRight){a.moveToX(a.maxX);G(a.maxX-a.origX,null);M=l;a.isAtRight=true;a.isAtLeft=false}L=true}else{a.isAtLeft=a.isAtRight=false;a.moveToX(b);G(e,null)}if(ra){if(!a.isAtTop){a.moveToY(a.minY);G(null,a.minY-a.origY);M=l;a.isAtTop=true;a.isAtBottom=false}L=true}else if(sa){if(!a.isAtBottom){a.maxY>0&&a.moveToY(a.maxY);G(null,a.maxY-a.origY);M=l;a.isAtTop=false;a.isAtBottom=true}L=true}else{a.isAtTop=a.isAtBottom=false;a.moveToY(c);G(null,g)}a[L&&!M?"ondragstop":"ondrag"](m);
return true}}return false}function Na(a){s=false;Q.remove(document,R,$);if(f){var b=f.hasBeenDragged;b=f.isBeingDragged&&!b;a=ma(a,"changedTouches");if(!f.hasBeenDragged&&!b){if(!P){S(f);Z(a)}}else{aa||x(Oa);x(S);S(f);Pa(a);x(Y,[a]);n[f.id]=f;Y(f,a);f.ondragend({domEvent:a,draggableList:n});f&&Z(a)}}}function Oa(a){var b=a.x,c=a.y;if(b<a.minX)a.moveToX(a.minX);else b>a.maxX&&a.moveToX(a.maxX);if(c<a.minY)a.moveToY(a.minY);else c>a.maxY&&a.moveToY(a.maxY)}function x(a,b,c){if(K||c){var e;b=b||[];b.unshift(0);
for(e in n){c=b[0]=n[e];a.apply(c,b)}}}function ta(a){if(f){a=a||event;if(a.keyCode==27||a.type==="touchcancel")f.release(a)}}function Ma(a,b,c,e){c={x:c,y:e};e=0;for(var g=y.length,l={domEvent:b,dragObj:a};e<g;e++){a=y[e];b=a.containsCoords(c);if(!a.hasDropTargetOver&&b){a.hasDropTargetOver=true;typeof a.ondragover==q&&a.ondragover(l);a.dragOverClassName&&j.addClass(a.el,a.dragOverClassName)}else if(a.hasDropTargetOver&&!b){typeof a.ondragout==q&&a.ondragout(l);a.dragOverClassName&&j.removeClass(a.el,
a.dragOverClassName);a.hasDropTargetOver=false}}}function Pa(a){var b=f.dropTargets,c,e,g=b.length,l,m;if(g){e=T(a);for(l=0;l<g;l++){c=b[l];if(typeof c.ondrop===q&&c.containsCoords(e)){c.ondrop(ua(a,f));x(Qa,[c,a])}(m=c.dragOverClassName)&&j.removeClass(c.el,m)}}}function ua(a,b){return{domEvent:a,dragObj:b}}function Qa(a,b,c){a.id!==b.id&&b.ondrop(ua(c,a))}function ma(a,b){return a&&a[b]&&a[b][0]||a||event}function Ra(a){var b=z.anim,c=new b.Animation(0.2);c.transition=b.Transitions.accel;c.run=
Sa;c.dObj=a;c.onplay=a.onglide;c.onend=Ta;c.start()}function Sa(a){var b=this.dObj,c=b.x-b.grabX,e=b.y-b.grabY;a=Math.pow(a,3);b.moveToX(b.x-c*a);b.moveToY(b.y-e*a)}function Ta(){va(this.dObj)}function va(a){typeof a.onglideend==q&&a.onglideend();S(a)}function ga(a){if(z.anim&&a.useAnim)Ra(a);else{a.moveToX(a.grabX);a.moveToY(a.grabY);typeof a.onglide==q&&a.onglide();va(a,{})}}var v=document,Q=z.EventPublisher,J=Q.add,da=r.preventDefault,fa="documentElement",I=v[fa].style,ea="px",wa="left",xa="top",
P=false,ha="setCapture"in document.documentElement,na=0,oa=0,f,y=false,K=false,aa=false,Ka=25,pa=-1,ya="onmousedown",R="onmousemove",za="onmouseup",ba,W,T=r.getCoords;if("ontouchstart"in v){ba=true;ya="ontouchstart";R="ontouchmove";za="ontouchend";J(v,"ontouchcancel",ta)}W=Q.get(v,ya);if("pixelLeft"in I){ea=0;wa="pixelLeft";xa="pixelTop"}J(v,"onkeydown",ta);J(v,za,Na);d(v,I);W.add(Ga).addAfter(Ia);v=I=null;return{dragCopy:false,useAnim:true,dragMultiple:false,selectedClassName:"",activeDragClassName:"",
useHandleTree:true,isSelected:false,onbeforedrag:t,onbeforedragstart:D,ondragstart:t,ondrag:t,ondragstop:D,ondragend:D,x:0,y:0,origX:0,origY:0,grabX:0,grabY:0,keepInContainer:false,isDragEnabled:true,hasHandleSet:false,setHandle:function(a,b){this.handle=a;this.hasHandleSet=true;this.useHandleTree=b!=false},dropTargets:false,addDropTarget:function(a){a=E.getByNode(a);var b=a.el,c=this.dropTargets;if(this.el===b)return a;return c[c.length]=E.getByNode(b)},grab:function(a,b,c){a=a||window.event;var e=
r.getTarget(a);da(a);if(!j.contains(this.el,e)){e=j.getPixelCoords(this.el);this.grabX=e.x;this.grabY=e.y;var g=T(a);e=this.handle;var l=j.getOffsetCoords(j.getContainingBlock(this.el)),m=g.x-l.x;m=m-(0|e.offsetWidth/2);g=g.y-l.y;g=g-(0|e.offsetHeight/2);e=j.getOffsetCoords(e,this.el);if(this.keepInContainer){m=Math.max(m,0);m=Math.min(m,this.container.clientWidth-this.el.offsetWidth);g=Math.max(g,0);g=Math.min(g,this.container.clientHeight-this.el.offsetHeight)}this.moveToX(m-e.x+(b||0));this.moveToY(g-
e.y+(c||0));ca(this,a);s=true;f=this}},release:function(a){a=a||{};x(Y,[a]);typeof this.onrelease==q&&this.onrelease(a);X(a);Z(a)},moveToX:function(a){this.style[wa]=(this.x=a)+ea},moveToY:function(a){this.style[xa]=(this.y=a)+ea},removeDropTarget:function(a){a=document.getElementById(a.id);var b=this.dropTargets,c,e;c=0;for(e=b.length;c<e;c++)if(b[c].el===a){b.splice(c,1);return a}return null},toString:function(){return"Draggable(id="+this.id+")"}}}function H(d){this.el=document.getElementById(d);
this.id=d}function N(){return{dragOverClassName:"",initCoords:function(){var d=this.coords||(this.coords={}),h=this.el;j.getOffsetCoords(h,document,d);d.w=h.clientWidth;d.h=h.clientHeight},containsCoords:function(d){var h=this.coords,i=h.x,k=h.y;return d.x>=i&&d.x<=i+h.w&&d.y>=k&&d.y<=k+h.h},ondragover:false,ondragout:t,ondrop:t}}var z=self.APE,j=z.dom,p=j.getStyle,u=z.drag,r=j.Event,B=1E3,n={},t,D=Function.prototype,A=self.parseInt,s,q="function",C=z.createFactory(U,O),E=z.createFactory(H,N);u.Draggable=
C;u.DropTarget=E;C.instanceDestructor=F})();
(function(){function U(r,B,n,t){this.id=r;this.dir=B;this.rationalValue=this.value=0;r=O.Draggable.getById(r,B);r.keepInContainer=true;this.handle=r;this[p]=n||0;this[u]=t;this.tDist=0;this.init()}function V(){var r;function B(){}function n(d){var h=H.Event.getTarget(d);if(h!==this)return true;h=N.instances[this.getElementsByTagName("*")[0].id];d=d||self.event;d.preventDefault&&d.preventDefault();H.addClass(this,C);h.handle.grab(d);s.call(h,d);return false}function t(d){H.removeClass(this.trackbar,
C);s.call(this,d);typeof this.onslideend==="function"&&this.onslideend(d)}function D(){E=this;H.addClass(this.trackbar,C)}function A(){if(E===this)E=null;H.removeClass(this.trackbar,C)}function s(d){this.value=0;var h=document.getElementById(this.id),i=0;if(this.dir===z)i=h.offsetLeft>0?h.offsetLeft/this.tDist:0;else if(h.offsetTop>0){h=this.tDist-h.offsetTop;i=h/this.tDist}else i=1;this.rationalValue=i;this.value=i*(this[u]-this[p]);if(this.onslide)this.onslide(d||{})}function q(d){d=d||self.event;
d.stopPropagation&&d.stopPropagation();d.cancelBubble=true;var h=+new Date,i=E;if(i)if(!(h-r<5)){r=h;var k=d.keyCode,o;h=k===37;o=k===39;var X=k===38;k=k===40;if(!(h||o||X||k))return true;if(i.id in N.instances){o=i[u]/i.ticks;if(h||k)o=-o;i.setValue(i.value+o);i.onslide&&i.onslide(d);return false}}}F.EventPublisher.add(document,"onkeydown",q);var C="ape-slider-track-active",E=null;return{init:function(){var d=F.EventPublisher,h=document.getElementById(this.id),i=this.handle,k=this.trackbar=document.getElementById(this.id).parentNode;
d.add(i,"onglideend",t,this);d.add(i,"ondragend",t,this);d.add(i,"onglideend",t,this);d.add(i,"ondrag",s,this);"focus"in i||d.add(h,"onmousedown",D,this);d.add(h,"onfocus",D,this);d.add(h,"onblur",A,this);d.add(i,"onglide",s,this);d.add(i,"ondragstop",s,this);if(this.dir===j){this.tDist=k.clientHeight-h.offsetHeight;i.moveToX=B}else{this.tDist=k.clientWidth-h.offsetWidth;i.moveToY=B}if(this[u]===undefined)this[u]=this.tDist;d.add(k,"onmousedown",n,k)},ticks:15,rationalValue:0,slideToX:function(d){this.handle.moveToX(d);
typeof slider.onslide==="function"&&slider.onslide()},setValue:function(d){d=Math.max(this[p],d);d=Math.min(this[u],d);var h=this.handle,i=this[u]-this[p];i=(d-this[p])/i;if(h&&h.id){this.dir===j?h.moveToY(this.tDist*(1-i)):h.moveToX(this.tDist*i);this.rationalValue=i;this.value=d}},slideToY:function(d){this.handle.moveToY(d);this.onslide()},setRationalValue:function(d,h){d=Math.max(0,d);this.rationalValue=d=Math.min(1,d);this.setValue(this[p]+d*(this[u]-this[p]));h&&s.call(this,{})},toString:function(){return"Slider: "+
this.handle.toString()}}}var F=self.APE,O=F.drag,H=F.dom,N=O.Slider=F.createFactory(U,V),z=1,j=2,p="minValue",u="maxValue";N.direction={HORZ:z,VERT:j}})();
