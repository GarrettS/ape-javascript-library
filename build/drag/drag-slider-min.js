APE.namespace("APE.drag");APE.drag.Draggable=function(A,B){this.id=A.id;this.el=this.origEl=A;this.style=A.style;this.isRel=APE.dom.getStyle(A,"position").toLowerCase()=="relative";this.container=(this.isRel?A.parentNode:APE.dom.getContainingBlock(A));this.dropTargets=[];this.handle=A;this.constraint=B||0;this.init()};APE.drag.Draggable.getByNode=APE.getByNode;APE.drag.Draggable.instanceDestructor=function(){var B,C,D,A=APE.drag.DragHandlers;for(B in this.instances){D=this.instances[B];for(C in D){if(D.hasOwnProperty(C)){delete D[C]}}delete this.instances[B]}if(D){D.constructor.draggableList={};A.focusedDO=A.dO=null}};APE.drag.Draggable.focused=function(B){if(A-arguments.callee.timeStamp<5){return}arguments.callee.timeStamp=A;B=B||event;var A=new Date-0;if(typeof B.stopPropagation=="function"){B.stopPropagation()}else{B.cancelBubble=true}this.setFocus(true,B)};APE.drag.Draggable.blurred=function(A){this.setFocus(false,A)};APE.drag.Draggable.constraints={NONE:0,HORZ:1,VERT:2};APE.drag.Draggable.prototype={hasFocus:false,dragCopy:false,dragMultiple:false,isSelected:false,_dragOverTargets:false,onfocus:undefined,onblur:undefined,onbeforedrag:undefined,onbeforedragstart:undefined,ondragstart:undefined,ondrag:undefined,ondragstop:undefined,ondragend:undefined,x:0,y:0,origX:0,origY:0,grabX:0,grabY:0,newX:0,newY:0,constraint:APE.drag.Draggable.constraints.NONE,keepInContainer:false,isDragEnabled:true,selectedClassName:"",activeDragClassName:"",focusClassName:"",init:function(){var D=APE.EventPublisher,C=APE.drag,A=C.Draggable,B=this.el;B.style.zIndex=APE.dom.getStyle(B,"zIndex")||A.highestZIndex++;this._setIeTopLeft();D.add(B,"onfocus",A.focused,this);D.add(B,"onblur",A.blurred,this);if(!B.getAttribute("tabIndex")){B.tabIndex=0}this.onbeforeexitcontainer=function(){return !this.keepInContainer};C.DragHandlers.init()},useHandleTree:true,hasHandleSet:false,setHandle:function(A,B){this.handle=A;this.hasHandleSet=true;this.useHandleTree=B!=false},isInHandle:function(A){return A==this.handle||(this.useHandleTree&&APE.dom.contains(this.handle,A))},addDropTarget:function(D){var B=APE.drag.DropTarget,A=B.getByNode(D).el,C=this.dropTargets;if(this.el===A){return}return C[C.length]=B.getByNode(A)},grab:function(J,L,D){if(!J){J=event}var F=APE.dom,O=F.Event,K=O.getTarget(J),I=APE.drag,N=I.DragHandlers;if(J.preventDefault){J.preventDefault()}J.returnValue=false;if(F.contains(this.el,K)){return}this._fixFocus(J);var C=F.getPixelCoords(this.el);this.grabX=C.x;this.grabY=C.y;var M=O.getCoords(J),B=F.getOffsetCoords(F.getContainingBlock(this.el)),G=M.y-B.y,Q=Math.floor(G-(this.handle.offsetHeight/2)),P=F.getOffsetCoords(this.handle,this.el),E=I.Draggable.constraints;if(this.constraint!=E.VERT){var H=M.x-B.x,A=H-Math.floor((this.handle.offsetWidth/2));if(this.keepInContainer){A=Math.max(A,0);A=Math.min(A,this.container.clientWidth-this.el.offsetWidth)}this.moveToX(A-P.x+(L||0))}if(this.constraint!=E.HORZ){if(this.keepInContainer){Q=Math.max(Q,0);Q=Math.min(Q,this.container.clientHeight-this.el.offsetHeight)}this.moveToY(Q-P.y+(D||0))}N.dragObjGrabbed(J,this);N.dO=this},select:function(C){var B=window.APE,A=B.drag.Draggable;if(C){if(this.selectedClassName){B.dom.addClass(this.el,this.selectedClassName)}if(this.dragMultiple&&!(this.id in A.draggableList)){A.draggableList[this.id]=this}}else{if(this.selectedClassName){B.dom.removeClass(this.el,this.selectedClassName)}delete A.draggableList[this.id]}this.isSelected=Boolean(C)},setFocus:function(C,D){if(C==this.hasFocus){return}if(!this.isDragEnabled){return false}var B=true,A=APE.drag.DragHandlers,E=APE.dom;if(C){if(this.focusClassName){E.addClass(this.el,this.focusClassName)}if(typeof this.onfocus=="function"){B=this.onfocus(D)}if(B!=false){if(A.focusedDO){A.focusedDO.setFocus(false,D)}A.focusedDO=this}}else{if(this.focusClassName){E.removeClass(this.el,this.focusClassName)}if(typeof this.onblur=="function"){B=this.onblur(D)}if(B!=false){A.focusedDO=null}}this.hasFocus=C;return B},_dragOverTargets:false,_fixFocus:function(A){var B=A.metaKey||(/Win/.test(navigator.platform)&&A.ctrlKey);if(!this.dragMultiple&&APE.drag.DragHandlers.focusedDO&&B){return false}if(!this.hasFocus){this.setFocus(!this.hasFocus,A)}},dragStart:function(A){if(this.isBeingDragged){return}if(this.dragCopy){this.assignClone(A)}if(typeof this.ondragstart=="function"){this.ondragstart(A)}if(this.activeDragClassName){APE.dom.addClass(this.el,this.activeDragClassName)}APE.drag.DragHandlers.setUpCoords(A,this);this.isBeingDragged=true},release:function(A){APE.drag.DragHandlers.dragObjReleased(A,this);if(typeof this.onrelease=="function"){this.onrelease(A)}},assignClone:function(D){var G=APE.dom,C="addClass",F,B=this.el,E=B,A;if(!this.copyEl){this.origEl=B;this.copyEl=B.cloneNode(true)}F=this.copyEl;A=F.style;if(this.focusClassName){G[this.hasFocus?C:"removeClass"](F,this.focusClassName)}A.display="";if(F.parentNode!=B.parentNode){B.parentNode.insertBefore(F,B)}A.zIndex=parseInt(E.style.zIndex)+100;if(this.origClassName){G[C](B,this.origClassName)}this.el=F;this.style=A;if(this.isRel){A.marginBottom=-E.offsetHeight+-(parseInt(G.getStyle(E,"marginBottom"))||0)+"px";A.marginright=-E.offsetWidth+-(parseInt(G.getStyle(E,"marginRight"))||0)+"px"}},retireClone:function(){this.constructor.focused.timeStamp=new Date;if(this.copyEl.style.display=="none"){return}this.el=this.origEl;this.style=this.origEl.style;this.moveToX(this.x);this.moveToY(this.y);this.copyEl.style.display="none";if(this.origClassName){APE.dom.removeClass(this.el,this.origClassName)}},moveToX:("pixelLeft" in document.documentElement.style?function(A){this.style.pixelLeft=this.x=A}:function(A){this.style.left=(this.x=A)+"px"}),moveToY:("pixelTop" in document.documentElement.style?function(A){this.style.pixelTop=this.y=A}:function(A){this.style.top=(this.y=A)+"px"}),moveToXY:("pixelTop" in document.documentElement.style?function(A,C){var B=this.style;B.pixelLeft=this.x=A;B.pixelTop=this.y=C}:function(A,C){var B=this.style;B.left=(this.x=A)+"px";B.top=(this.y=C)+"px"}),glideStart:function(A,D){if(this.animTimer){return}this.startX=A;this.startY=D;var C=this.startX-this.grabX,B=this.startY-this.grabY;this.GlideDist=Math.ceil(Math.sqrt((C*C)+(B*B)));if(this.GlideDist===0){return}this.rx=Math.abs(C)/this.GlideDist;this.ry=Math.abs(B)/this.GlideDist;if(this.x>this.grabX){this.rx=-this.rx}if(this.y>this.grabY){this.ry=-this.ry}this.startTime=new Date().getTime();this.animTimer=window.setInterval("APE.drag.Draggable.instances['"+this.id+"'].glide()",10)},glide:function(){var A=new Date-this.startTime,B=Math.ceil(2*A+0.5*0.01*A*A);if(B>=this.GlideDist){this.animTimer=clearInterval(this.animTimer);if(this.constraint!=2){this.moveToX(this.grabX)}if(this.constraint!=1){this.moveToY(this.grabY)}if(this.copyEl){this.el=this.origEl;this.style=this.origEl.style;this.copyEl.style.display="none"}if(typeof this.onglide=="function"){this.onglide()}if(typeof this.onglideend=="function"){this.onglideend()}this.dragDone({})}else{if(this.constraint!=2){this.moveToX(this.startX+B*this.rx)}if(this.constraint!=1){this.moveToY(this.startY+B*this.ry)}if(typeof this.onglide=="function"){this.onglide()}}},animateBack:function(A,B){this.glideStart(A||this.x,B||this.y)},setContainer:function(A){this.container=A},removeDropTarget:function(C){C=document.getElementById(C.id);for(var B=0,A=this.dropTargets.length;B<A;B++){if(this.dropTargets[B].el===C){this.dropTargets.splice(B,1);return C}}return null},dragDone:function(A){if(this.activeDragClassName){APE.dom.removeClass(this.el,this.activeDragClassName)}if(typeof this.ondragend=="function"&&this.hasBeenDragged){this.ondragend(A)}if(this.copyEl){this.el.parentNode.insertBefore(this.copyEl,this.el)}this.hasBeenDragged=false},_setIeTopLeft:function(){var B=document.defaultView,C=this.el,I=C.style,G=C.currentStyle||(B.getComputedStyle&&B.getComputedStyle(C,""))||I,E=APE.dom.getContainingBlock(C),H=G.left,F=G.right,D=G.top,A=G.bottom;if((H==""||H=="auto")){F=parseInt(F);if(isFinite(F)){I.left=E.clientWidth-C.offsetWidth-F+"px"}else{I.left="0"}}if((D==""||D=="auto")){A=parseInt(A);if(isFinite(A)){I.top=E.clientHeight-C.offsetHeight-A+"px"}else{I.top="0"}}},toString:function(){return"APE.drag.Draggable(id="+this.id+")"}};APE.drag.Draggable.highestZIndex=1000;APE.drag.Draggable.draggableList={};APE.drag.Draggable._setUpDragOver=function(E){E._dragOverTargets=[];var D=E.dropTargets,C,B=0,A=D.length;for(;B<A;B++){C=D[B];C.initCoords();if(typeof C.ondragover=="function"||typeof C.ondragout=="function"||C.dragOverClassName){E._dragOverTargets.push(C)}}if(E._dragOverTargets.length===0){E._dragOverTargets=false}};APE.drag.DropTarget=function(A){this.el=A;this.id=A.id};APE.drag.DropTarget.getByNode=APE.getByNode;APE.drag.DropTarget.prototype={coords:undefined,dragOverClassName:"",initCoords:function(){if(!this.coords){this.coords={}}APE.dom.getOffsetCoords(this.el,document,this.coords);this.coords.w=this.el.clientWidth;this.coords.h=this.el.clientHeight},containsCoords:function(A){var C=this.coords.x,B=this.coords.y;return(A.x>=C&&A.x<=C+this.coords.w)&&(A.y>=B&&A.y<=B+this.coords.h)},ondragover:false,ondragout:undefined,ondrop:undefined};APE.drag.DragHandlers={dO:null,focusedDO:null,getEventCoords:APE.dom.Event.getCoords,init:function(){if(this.inited){return}var C=document,D=C.documentElement,B=D.style,A=APE.EventPublisher;A.add(C,"onmousedown",this.mouseDown,this);A.add(C,"onkeypress",this.keyPressed,this);A.add(C,"onmousemove",this.mouseMove,this);A.add(C,"onmouseup",this.mouseUp,this);if("onselectstart" in C){A.get(C,"onselectstart").addBefore(this.isInDrag,this)}else{A.get(C,"onmousedown").addAfter(this.preventUserSelection,this);A.get(C,"onmouseup").addAfter(this.preventUserSelection,this)}this.inited=true;this.userSelectType="MozUserSelect" in B?"MozUserSelect":"KhtmlUserSelect" in B?"KhtmlUserSelect":"userSelect" in B?"userSelect":""},isInDrag:function(){return !this.dO&&!this.focusedDO},preventUserSelection:function(){document.documentElement.style[this.userSelectType]=this.dO?"none":""},dragObjGrabbed:function(D,F){if(typeof F.onbeforedragstart=="function"&&F.onbeforedragstart(D)==false){return true}var A=APE.drag.DragHandlers,E=APE.dom,C=E.Event.getCoords(D),B;A.locked=true;A.mousedownX=C.x;A.mousedownY=C.y;B=E.getPixelCoords(F.el);F.origX=F.grabX=B.x;F.origY=F.grabY=B.y;F.isBeingDragged=false},setUpCoords:function(F,I){var E=APE.dom,A=I.container,B=I.el,D=E.getContainingBlock(B),J=E.getOffsetCoords(D,A),C=E.getPixelCoords(B),K=E.getOffsetCoords(B,B.parentNode),H=K.x-C.x+J.x,G=K.y-C.y+J.y;if(I.keepInContainer){I.minX=0-H;I.maxX=A.clientWidth-I.el.offsetWidth-H;I.minY=0-G;I.maxY=A.clientHeight-I.el.offsetHeight-G}},mouseDown:function(E){if(!E){E=event}var D=APE.dom,F=D.Event.getTarget(E),H=null,C=APE.drag.Draggable,A=C.instances,I=F;for(;H==null&&I;I=D.findAncestorWithAttribute(I,"id")){H=A[I.id]}var G=E.metaKey||(/Win/.test(navigator.platform)&&E.ctrlKey);if(H){if(!H.isDragEnabled){if(!G){this.removeGroupSelection();if(this.focusedDO){}}return false}if(!G&&H.hasHandleSet&&!H.isInHandle(F)){if(!this.locked){this.removeGroupSelection();this.dO=null;this.locked=false}return}else{if(!G&&!H.isSelected){this.removeGroupSelection()}E.returnValue=false}}else{if(!this.locked){if(!G){this.removeGroupSelection();if(this.focusedDO){this.focusedDO.setFocus(false,E)}}this.dO=null;this.locked=false}return}if(G&&this.hasGroupSelection()&&!H.dragMultiple){return false}H._fixFocus(E);if(!H.dragMultiple){if(!G){this.removeGroupSelection()}else{return false}}this.setGroupSelection(H,G);H.style.zIndex=++C.highestZIndex;if(G&&H.hasFocus){}C._setUpDragOver(H);this.dragObjGrabbed(E,H);for(var B in C.draggableList){this.dragObjGrabbed(E,C.draggableList[B])}this.dO=H;return F.tagName!="IMG"},setGroupSelection:function(C,B){var A=APE.drag.Draggable.draggableList;if(B){if(C.id in A){this.deselectOnMouseup=true}else{C.select(true)}}else{if(!C.isSelected){this.removeGroupSelection();C.select(true)}}},dragObjReleased:function(F,H){H.animateBack();var C=window.APE,I=C.dom.removeClass,G=C.drag.Draggable.draggableList,B,E=0,D=H._dragOverTargets.length,A;if(H._dragOverTargets!==false){for(;E<D;E++){B=H._dragOverTargets[E];if(B.hasDropTargetOver){if(typeof B.ondragout=="function"){B.ondragout(F,H)}if(B.dragOverClassName){I(B.el,B.dragOverClassName)}B.hasDropTargetOver=false}}}for(A in G){G[A].animateBack()}this.dO=null},carryGroup:function(C,A){var B=APE.drag.Draggable.draggableList,D,E;for(E in B){D=B[E];if(C!=null){D.moveToX(D.origX+C)}if(A!=null){D.moveToY(D.origY+A)}}},removeGroupSelection:function(){var C,B=APE.drag,A=B.Draggable.draggableList;for(C in A){A[C].select(false)}if(B.DragHandlers.focusedDO){B.DragHandlers.focusedDO.select(false)}},hasGroupSelection:function(){for(var A in APE.drag.Draggable.draggableList){return true}return false},mouseMove:function(U){var E=this.dO;if(E==null){return}if(!U){U=event}var G=this.getEventCoords(U),N=G.x,L=G.y,J=N-this.mousedownX,H=L-this.mousedownY;if(E.isBeingDragged==false){E.dragStart(U);var K,W=APE.drag.Draggable.draggableList;for(K in W){W[K].dragStart(U)}}E.newX=E.origX+J;E.newY=E.origY+H;E.hasBeenDragged=(E.hasBeenDragged||(J||H));var P=APE.drag.Draggable.constraints,D=E.newX<E.minX,B=E.newX>E.maxX,X=E.newY<E.minY,M=E.newY>E.maxY;if(typeof E.onbeforedrag=="function"&&E.onbeforedrag(U)==false){return}var A=E.container!=null,Y=(typeof E.ondrag=="function"),C=typeof E.onbeforeexitcontainer=="function",V=0;if(E.constraint===P.NONE){A&=(D||B||X||M);if(A&&(C||E.onbeforeexitcontainer()==false)){if(D){if(!E.isAtLeft){E.moveToX(E.minX);this.carryGroup(E.minX-E.origX,null);if(Y){E.ondrag(U)}E.isAtRight=false;E.isAtLeft=true;V+=1}}else{if(B){if(!E.isAtRight){E.moveToX(E.maxX);this.carryGroup(E.maxX-E.origX,null);if(Y){E.ondrag(U)}E.isAtRight=true;E.isAtLeft=false;V+=1}}else{E.isAtLeft=E.isAtRight=false;E.moveToX(E.newX);this.carryGroup(J,null)}}if(X){if(!E.isAtTop){E.moveToY(E.minY);this.carryGroup(null,E.minY-E.origY);if(Y){E.ondrag(U)}E.isAtTop=true;E.isAtBottom=false;V+=1}}else{if(M){if(!E.isAtBottom){if(E.maxY>0){E.moveToY(E.maxY)}this.carryGroup(null,E.maxY-E.origY);if(Y){E.ondrag(U)}E.isAtTop=false;E.isAtBottom=true;V+=1}}else{E.isAtTop=E.isAtBottom=false;E.moveToY(E.newY);this.carryGroup(null,H)}}E.isDragStopped=V==2;if(E.isDragStopped&&typeof E.ondragstop=="function"){E.ondragstop(U)}else{if(Y){E.ondrag(U)}}}else{E.isDragStopped=E.isAtLeft=E.isAtRight=E.isAtTop=E.isAtBottom=false;E.moveToXY(E.newX,E.newY);this.carryGroup(J,H);if(Y){E.ondrag(U)}}}else{if(E.constraint%2==0){A&=(X||M);if(A&&(C||E.onbeforeexitcontainer()==false)){if(X){if(!E.isAtTop){E.moveToY(E.minY);this.carryGroup(null,E.minY-E.origY);if(Y){E.ondrag(U)}E.isAtTop=!(E.isAtBottom=false)}}else{if(M){if(!E.isAtBottom){E.moveToY(E.maxY);this.carryGroup(null,E.maxY-E.origY);if(Y){E.ondrag(U)}E.isAtBottom=!(E.isAtTop=false)}}}if(!E.isDragStopped){if(typeof E.ondragstop=="function"){E.ondragstop(U)}E.isDragStopped=true}}else{E.isAtTop=E.isAtBottom=false;E.isDragStopped=false;E.moveToY(E.newY);this.carryGroup(null,H);if(Y){E.ondrag(U)}}}else{A&=(D||B);if(A&&(C||E.onbeforeexitcontainer()==false)){if(D){if(!E.isAtLeft){E.moveToX(E.minX);this.carryGroup(E.minX-E.origX,null);E.isAtLeft=!(E.isAtRight=false)}}else{if(B){if(!E.isAtRight){this.carryGroup(E.maxX-E.origX,null);E.moveToX(E.maxX);E.isAtRight=!(E.isAtLeft=false)}}}if(!E.isDragStopped){if(typeof E.ondragstop=="function"){E.ondragstop(U)}E.isDragStopped=true}}else{E.isAtLeft=E.isAtRight=false;E.isDragStopped=false;E.moveToX(E.newX);this.carryGroup(J,null);if(Y){E.ondrag(U)}}}}var O=E._dragOverTargets;if(O!==false){var S={x:N,y:L},R=0,Q=O.length,I,T=APE.dom,F={domEvent:U,dragObj:E};for(;R<Q;R++){I=O[R],isInTarget=I.containsCoords(S);if(!I.hasDropTargetOver&&isInTarget){I.hasDropTargetOver=true;if(typeof I.ondragover=="function"){I.ondragover(F)}if(I.dragOverClassName){T.addClass(I.el,I.dragOverClassName)}}else{if(I.hasDropTargetOver&&!isInTarget){if(typeof I.ondragout=="function"){I.ondragout(F)}if(I.dragOverClassName){T.removeClass(I.el,I.dragOverClassName)}I.hasDropTargetOver=false}}}}return false},mouseUp:function(H){var D=(this.dO&&this.dO.isBeingDragged&&!this.dO.hasBeenDragged);if(this.dO==null||!this.dO.hasBeenDragged&&!D){if(this.dO&&this.deselectOnMouseup&&!this.dO.hasBeenDragged){this.dO.select(false)}this.deselectOnMouseup=false;this.dO=null;this.locked=false;return}if(!H){H=event}var M=this.dO,I=APE.drag.Draggable.draggableList,B,N;if(M.copyEl){M.retireClone()}for(B in I){N=I[B];if(N.copyEl){N.retireClone()}}var F=M.dropTargets,G=F.length,C,L,J;if(G>0){var K=this.getEventCoords(H),A,E=0;for(;E<G;E++){A=F[E];if(A.containsCoords(K)){A.containsCoords(K);if(typeof A.ondrop=="function"){A.ondrop({domEvent:H,dragObj:M,dropTarget:A})}for(B in I){if(B===A.id){continue}if(typeof A.ondrop=="function"){C=I[B];A.ondrop({domEvent:H,dragObj:C,dropTarget:A})}}if(A.dragOverClassName){APE.dom.removeClass(A.el,A.dragOverClassName)}break}}}for(B in I){C=I[B],L=C.x,J=C.y;if(L<C.minX){C.moveToX(C.minX)}else{if(L>C.maxX){C.moveToX(C.maxX)}}if(J<C.minY){C.moveToY(C.minY)}else{if(J>C.maxY){C.moveToY(C.maxY)}}if(C.hasBeenDragged){C.dragDone(H)}}if(M.hasBeenDragged){M.dragDone(H)}this.locked=false;this.dO=null},keyPressed:function(A){A=A||event;if(A.keyCode==27){if(this.dO){this.dO.release(A)}}},toString:function(){return"[object DragHandlers]"}};if(typeof window.CollectGarbage=="function"){(function(){var C=APE.drag,B=C.Draggable,A=B.instanceDestructor;APE.EventPublisher.get(window,"onunload").addAfter(A,B).add(A,C.DropTarget)})()}APE.drag.Slider=function(B,A){this.id=B.id;this.dir=A;this.value=0;this.rationalValue=0;var C=APE.drag.Draggable.getByNode(B,A);C.keepInContainer=true;C.focusClassName="ape-slider-h-handle-focus";this.handle=C;this.trackbar=B.parentNode;this.tDist=0;this.init()};(function(){var B=APE.drag,A=B.Slider,C=B.Draggable.constraints;A.getByNode=APE.getByNode;A.activeSlider=null;A.direction={HORZ:C.HORZ,VERT:C.VERT}})();APE.drag.Slider.prototype={init:function(){var C=APE.EventPublisher,B=document.getElementById(this.id),D=this.handle,A=this.trackbar;C.add(D,"ondragend",this.dragEnd,this);C.add(D,"onglideend",this.dragEnd,this);C.add(D,"ondrag",this._onslide,this);C.add(D,"onfocus",this._onfocus,this);C.add(D,"onblur",this._onblur,this);C.add(D,"onglide",this._onslide,this);C.add(D,"ondragstop",this._onslide,this);C.add(document,"onkeydown",this._keyDown,this);if(this.dir===this.constructor.direction.VERT){this.tDist=A.clientHeight-B.offsetHeight}else{this.tDist=A.clientWidth-B.offsetWidth}if(this.maxValue==undefined){this.maxValue=this.tDist}C.add(this.trackbar,"onmousedown",this.trackbarMouseDown)},ticks:15,rationalValue:0,minValue:0,maxValue:undefined,slideToX:function(A){this.handle.moveToX(A);if(typeof slider.onslide=="function"){slider.onslide()}},setValue:function(A){A=Math.max(this.minValue,A);A=Math.min(this.maxValue,A);var B=this.handle,D=this.maxValue-this.minValue,C=(A-this.minValue)/D;if(this.dir===this.constructor.direction.VERT){B.moveToY(this.tDist*(1-C))}else{B.moveToX(this.tDist*C)}this.rationalValue=C;this.value=A},slideToY:function(A){this.handle.moveToY(A);this.onslide()},setRationalValue:function(B,A){B=Math.max(0,B);B=Math.min(1,B);this.rationalValue=B;this.setValue(this.minValue+(B*(this.maxValue-this.minValue)));if(A){this._onslide({})}},dragEnd:function(A){APE.dom.removeClass(this.trackbar,"scrollbar-track-active");if(typeof this.onslideend=="function"){this.onslideend(A)}},trackbarMouseDown:function(D){var B=window.APE,E=B.dom,C=E.Event.getTarget(D),A=B.drag.Slider.instances[this.getElementsByTagName("*")[0].id];if(C!=this){return true}if(!D){D=event}else{if(D.preventDefault){D.preventDefault()}}E.addClass(this,"ape-slider-track-active");A.handle.grab(D);A._onslide(D);return false},_onfocus:function(A){this.constructor.activeSlider=this;APE.dom.addClass(this.trackbar,"ape-slider-track-active")},_onblur:function(B){var A=this.constructor;if(A.activeSlider===this){A.activeSlider=null}APE.dom.removeClass(this.trackbar,"ape-slider-track-active")},_onslide:function(D){this.value=0;var B=document.getElementById(this.id),C=0;if(this.dir===this.constructor.direction.HORZ){if(B.offsetLeft>0){C=B.offsetLeft/this.tDist}else{C=0}}else{if(B.offsetTop>0){var A=this.tDist-B.offsetTop;C=A/this.tDist}else{C=1}}this.rationalValue=C;this.value=C*(this.maxValue-this.minValue);if(this.onslide){this.onslide(D||{})}},_keyDown:function(G){G=G||event;if(G.stopPropagation){G.stopPropagation()}G.cancelBubble=true;var E=new Date-0,D=APE.drag.Slider,B=D.activeSlider;if(!B){return}if(E-arguments.callee.timeStamp<5){return}arguments.callee.timeStamp=E;var I=G.keyCode,A=D.instances,C=I===37,H=I===39,J=I===38,F=I===40;if(!(C||H||J||F)){return true}if(B&&B.id in A){if(C||F){B.setValue(B.value-B.maxValue/B.ticks,0)}else{if(H||J){B.setValue(B.value+B.maxValue/B.ticks,0)}}if(B.onslide){B.onslide(G)}return false}}};