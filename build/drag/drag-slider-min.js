APE.namespace("APE.drag");(function(){var K=self.APE,N=K.dom,M=K.drag,R=N.Event,P=1000,Q={},B,I=self.parseInt,L,F="function",E=K.createFactory(A,D),C=K.createFactory(G,O);M.Draggable=E;M.DropTarget=C;E.instanceDestructor=J;function A(X,S){var V=document,T=V.getElementById(X),U;this.id=X;this.el=this.origEl=T;this.style=T.style;this.isRel=N.getStyle(T,"position").toLowerCase()=="relative";var W=(this.isRel?T.parentNode:N.getContainingBlock(T));if(W===null){W=V.documentElement}this.container=W;this.dropTargets=[];this.handle=T;this.onbeforeexitcontainer=H;for(U in S){this[U]=S[U]}T.style.zIndex=I(N.getStyle(T,"zIndex"),10)||P++}function H(){return !this.keepInContainer}function J(){var S,U,T;for(S in this.instances){T=this.instances[S];for(U in T){delete T[U]}delete this.instances[S]}Q={}}function D(){var AO=document,W=K.EventPublisher,AG="documentElement",g=AO[AG].style,AC="serSelect",AQ="MozU"+AC,o="MozU"+AC,AF="u"+AC,v=AQ in g?AQ:o in g?o:AF in g?AF:"",f="px",i="left",s="top",AM=false,Z=0,Y=0,AE,w=false,T=false,n=25,y=-1,e="onmousedown",S="onmousemove",AP="onmouseup",AA,AB;getEventCoords=R.getCoords;if("ontouchstart" in AO){AA=true;e="ontouchstart";S="ontouchmove";AP="ontouchend"}AB=W.get(AO,e);if("onselectstart" in AO){W.add(AO,"onselectstart",k)}else{AB.addAfter(k)}if("pixelLeft" in g){f=0;i="pixelLeft";s="pixelTop"}AB.add(l).addAfter(b);W.add(AO,"onkeydown",x);W.add(AO,S,u);W.add(AO,AP,c);AO=g=null;function k(AS){var d=!AE;if(v){this[AG].style[v]=d?"":"none"}else{AS=AS||event;AS.returnValue=d}}function AJ(d,AS){return AS===d.handle||(d.useHandleTree&&N.contains(d.handle,AS))}function AL(d,AS){if(AS){if(d.selectedClassName){N.addClass(d.el,d.selectedClassName)}if(d.dragMultiple&&!(d.id in Q)){Q[d.id]=d}}else{if(d.selectedClassName){N.removeClass(d.el,d.selectedClassName)}delete Q[d.id]}d.isSelected=AS}function q(AY){var AS=AY.container,AV=AY.el,AZ=document,AU=AZ.documentElement,AX=N.getContainingBlock(AV)||AU,AW,Aa,Ad=(AX===AS)?{x:0,y:0}:N.getOffsetCoords(AX,AS),AT=N.getPixelCoords(AV),Ae=N.getOffsetCoords(AV,AV.parentNode),Ac=Ae.x-AT.x+Ad.x,Ab=Ae.y-AT.y+Ad.y;if(AY.keepInContainer){if(AS===AZ.body){AW=I(N.getStyle(AS,"width"),10);Aa=I(N.getStyle(AS,"height"),10)}else{AW=AS.clientWidth;Aa=AS.clientHeight}AY.minX=0-Ac;AY.maxX=AW-AV.offsetWidth-Ac;AY.minY=0-Ab;AY.maxY=Aa-AV.offsetHeight-Ab}}function AD(){for(var d in Q){AL(Q[d],false)}T=false}function V(AV,d){z(d);var AW=N.removeClass,AU,AT,AS,AX;if(w!==false){for(AT=0,AS=w.length;AT<AS;AT++){AU=w[AT];if(AU.hasDropTargetOver){if(typeof AU.ondragout==F){AU.ondragout(AV,d)}if(AU.dragOverClassName){AW(AU.el,AU.dragOverClassName)}AU.hasDropTargetOver=false}}}for(AX in Q){z(Q[AX])}AE=null}function X(d,AS){if(d.activeDragClassName){N.removeClass(d.el,d.activeDragClassName)}if(typeof d.ondragend==F&&d.hasBeenDragged){d.ondragend(AS)}if(d.copyEl){d.el.parentNode.insertBefore(d.copyEl,d.el)}d.hasBeenDragged=false}function j(d,AS){if(AS){if(d.id in Q){AL(d,false)}else{AL(d,true)}}else{if(!d.isSelected){AD();AL(d,true)}}}function AH(AS){var AU="addClass",AW,AT=AS.el,AV=AT,d;if(!AS.copyEl){AS.origEl=AT;AS.copyEl=AT.cloneNode(true);AS.copyEl.id+="Copy"}AW=AS.copyEl;d=AW.style;d.display="";if(AW.parentNode!==AT.parentNode){AT.parentNode.insertBefore(AW,AT)}d.zIndex=I(AV.style.zIndex,10)+100;if(AS.origClassName){N[AU](AT,AS.origClassName)}AS.el=AW;AS.style=d;if(AS.isRel){d.marginBottom=-AV.offsetHeight+-(I(N.getStyle(AV,"marginBottom"),10)||0)+"px";d.marginright=-AV.offsetWidth+-(I(N.getStyle(AV,"marginRight"),10)||0)+"px"}}function AR(d){if(d.copyEl.style.display=="none"){return}d.el=d.origEl;d.style=d.origEl.style;d.moveToX(d.x);d.moveToY(d.y);d.copyEl.style.display="none";if(d.origClassName){N.removeClass(d.el,d.origClassName)}}function AK(AS,d){if(!T){return}var AT,AU;for(AU in Q){AT=Q[AU];if(typeof AS=="number"){AT.moveToX(AT.origX+AS)}if(typeof d=="number"){AT.moveToY(AT.origY+d)}}}function h(d,AS){if(d.isBeingDragged){return}if(d.dragCopy){AH(d)}if(typeof d.ondragstart==F){d.ondragstart(AS)}if(d.activeDragClassName){N.addClass(d.el,d.activeDragClassName)}q(d);d.isBeingDragged=true}function l(AW){if(L){L=false;return}d=AW||event;AW=a(AW,"changedTouches");var d,AV=R.getTarget(AW),AU=E.instances,AT,AS=AV,AX=AW.metaKey||AW.ctrlKey;while(!AT&&AS!==null){AT=AU[AS.id];AS=N.findAncestorWithAttribute(AS,"id")}if(AT){if(!AT.isDragEnabled){if(!AX){AD()}return false}if(!AX&&AT.hasHandleSet&&!AJ(AT,AV)){AD();AT=null;return}else{if(!AX&&!AT.isSelected){AD()}AW.returnValue=false}}else{if(!AX){AD();if(AE){AL(AE,false);AE=null}}return}if(AX&&AE&&!AT.dragMultiple){AM=true;return false}if(!AT.dragMultiple){if(!AX){AD()}else{AM=true;return false}}j(AT,AX);AT.style.zIndex=++P;if(AX){}AE=AT;R.preventDefault(d);AN(AW,AT);for(var AY in Q){AN(AW,Q[AY])}return AV.tagName!=="IMG"}function b(){if(!AE){return}w=[];var AU=AE.dropTargets,AT,AS=0,d=AU.length;for(;AS<d;AS++){AT=AU[AS];AT.initCoords();if(typeof AT.ondragover==F||typeof AT.ondragout==F||AT.dragOverClassName){w.push(AT)}}if(w.length===0){w=false}}function AN(AU,d){if(typeof d.onbeforedragstart==F&&d.onbeforedragstart(AU)==false){return true}var AT=getEventCoords(AU),AS;Z=AT.x;Y=AT.y;AS=N.getPixelCoords(d.el);d.origX=d.grabX=AS.x;d.origY=d.grabY=AS.y;d.isBeingDragged=false}function u(Af){if(!AE){return}var AU=+new Date,AY;if(AU-y<n){return}y=AU;AY=Af=Af||event;if(AA){R.preventDefault(AY);Af=Af.touches&&Af.touches[0];if(!Af){return}}var AX=getEventCoords(Af),Ae=AX.x,Ab=AX.y,Aa=Ae-Z,AZ=Ab-Y,AW=false,Ah=AE.origX+Aa,Ag=AE.origY+AZ,Ac;if(AE.isBeingDragged===false){h(AE,Af);delete Q[AE.id];for(Ac in Q){T=true;h(Q[Ac],Af)}}AE.hasBeenDragged=(AE.hasBeenDragged||(Aa||AZ));var AV=Ah<AE.minX,AT=Ah>AE.maxX,Ak=Ag<AE.minY,Ad=Ag>AE.maxY,AS=AE.container!=null,Aj=(typeof AE.ondrag==F),d=typeof AE.onbeforeexitcontainer==F,Ai=0;if(typeof AE.onbeforedrag==F&&AE.onbeforedrag(Af)==false){return}AS&=(AV||AT||Ak||Ad);if(AS&&(d||AE.onbeforeexitcontainer()==false)){if(AV){if(!AE.isAtLeft){AE.moveToX(AE.minX);AK(AE.minX-AE.origX,null);if(Aj){AE.ondrag(Af)}AE.isAtRight=false;AE.isAtLeft=true}Ai+=1}else{if(AT){if(!AE.isAtRight){AE.moveToX(AE.maxX);AK(AE.maxX-AE.origX,null);if(Aj){AE.ondrag(Af)}AE.isAtRight=true;AE.isAtLeft=false}Ai+=1}else{AE.isAtLeft=AE.isAtRight=false;AE.moveToX(Ah);AK(Aa,null)}}if(Ak){if(!AE.isAtTop){AE.moveToY(AE.minY);AK(null,AE.minY-AE.origY);if(Aj){AE.ondrag(Af)}AE.isAtTop=true;AE.isAtBottom=false}Ai+=1}else{if(Ad){if(!AE.isAtBottom){if(AE.maxY>0){AE.moveToY(AE.maxY)}AK(null,AE.maxY-AE.origY);if(Aj){AE.ondrag(Af)}AE.isAtTop=false;AE.isAtBottom=true}Ai+=1}else{AE.isAtTop=AE.isAtBottom=false;AE.moveToY(Ag);AK(null,AZ)}}AW=Ai==2;if(AW&&typeof AE.ondragstop==F){AE.ondragstop(Af)}else{if(Aj){AE.ondrag(Af)}}}else{AE.isAtLeft=AE.isAtRight=AE.isAtTop=AE.isAtBottom=false;AE.moveToX(Ah);AE.moveToY(Ag);AK(Aa,AZ);if(Aj){AE.ondrag(Af)}}if(w!==false){t(AE,Af,Ae,Ab)}return false}function c(AT){L=false;if(!AE){return}var AX=(AE.isBeingDragged&&!AE.hasBeenDragged),AW,AS,AU,d,AV;if(!AE.hasBeenDragged&&!AX){if(!AM){AE=null}return}Q[AE.id]=AE;AM=false;if(AE.copyEl){AR(AE)}if(T){for(AW in Q){AS=Q[AW];if(AS.copyEl){AR(AS)}}}AT=a(AT,"changedTouches");m(AT);if(T){for(AW in Q){AU=Q[AW];d=AU.x;AV=AU.y;if(d<AU.minX){AU.moveToX(AU.minX)}else{if(d>AU.maxX){AU.moveToX(AU.maxX)}}if(AV<AU.minY){AU.moveToY(AU.minY)}else{if(AV>AU.maxY){AU.moveToY(AU.maxY)}}if(AU.hasBeenDragged){X(AU,AT)}}}X(AE,AT);AE=null}function x(d){d=d||event;if(d.keyCode==27){if(AE){AE.release(d)}}}function t(AZ,AX,AT,d){var Aa={x:AT,y:d},AW=0,AV=w.length,AS,AU,AY={domEvent:AX,dragObj:AZ};for(;AW<AV;AW++){AS=w[AW];AU=AS.containsCoords(Aa);if(!AS.hasDropTargetOver&&AU){AS.hasDropTargetOver=true;if(typeof AS.ondragover==F){AS.ondragover(AY)}if(AS.dragOverClassName){N.addClass(AS.el,AS.dragOverClassName)}}else{if(AS.hasDropTargetOver&&!AU){if(typeof AS.ondragout==F){AS.ondragout(AY)}if(AS.dragOverClassName){N.removeClass(AS.el,AS.dragOverClassName)}AS.hasDropTargetOver=false}}}}function m(AU){var AS=AE.dropTargets,AY,AV,d=AS.length,AT,AX,AW;if(d>0){AV=getEventCoords(AU);for(AT=0;AT<d;AT++){AY=AS[AT];if(AY.containsCoords(AV)){if(typeof AY.ondrop==F){AY.ondrop({domEvent:AU,dragObj:AE,dropTarget:AY})}if(T){for(AX in Q){if(AX===AY.id){continue}if(typeof AY.ondrop==F){AW=Q[AX];AY.ondrop({domEvent:AU,dragObj:AW,dropTarget:AY})}}}if(AY.dragOverClassName){N.removeClass(AY.el,AY.dragOverClassName)}break}}}}function a(AS,d){return AS&&AS[d]&&AS[d][0]||AS||event}function p(AS){var AT=K.anim;AS.startX=AS.x;AS.startY=AS.y;var d=new AT.Animation(0.2);d.transition=AT.Transitions.accel;d.run=r;d.dObj=AS;d.onplay=AS.onglide;d.onend=U;d.start()}function r(AU){var AS=this.dObj,AT=AS.startX-AS.grabX,d=AS.startY-AS.grabY;AU=Math.pow(AU,3);AS.moveToX(AS.startX-(AT*AU));AS.moveToY(AS.startY-(d*AU))}function U(){AI(this.dObj)}function AI(d){if(typeof d.onglideend==F){d.onglideend()}if(d.copyEl){d.el=d.origEl;d.style=d.origEl.style;d.copyEl.style.display="none"}X(d,{})}function z(d){if(K.anim&&d.useAnim){p(d)}else{d.moveToX(d.grabX);d.moveToY(d.grabY);if(typeof d.onglide==F){d.onglide()}AI(d,{})}}return{dragCopy:false,useAnim:true,dragMultiple:false,selectedClassName:"",activeDragClassName:"",useHandleTree:true,isSelected:false,onbeforedrag:B,onbeforedragstart:B,ondragstart:B,ondrag:B,ondragstop:B,ondragend:B,x:0,y:0,origX:0,origY:0,grabX:0,grabY:0,keepInContainer:false,isDragEnabled:true,hasHandleSet:false,setHandle:function(d,AS){this.handle=d;this.hasHandleSet=true;this.useHandleTree=AS!=false},addDropTarget:function(AU){var AS=C.getByNode(AU),d=AS.el,AT=this.dropTargets;if(this.el===d){return AS}return AT[AT.length]=C.getByNode(d)},grab:function(AY,Aa,AU){AY=AY||event;var AZ=R.getTarget(AY),AT;if(AY.preventDefault){AY.preventDefault()}else{AY.returnValue=false}if(N.contains(this.el,AZ)){return}AT=N.getPixelCoords(this.el);this.grabX=AT.x;this.grabY=AT.y;var Ab=getEventCoords(AY),AX=this.handle,AS=N.getOffsetCoords(N.getContainingBlock(this.el)),AW=Ab.x-AS.x,d=AW-(0|AX.offsetWidth/2),AV=Ab.y-AS.y,Ad=(AV-(0|AX.offsetHeight/2)),Ac=N.getOffsetCoords(AX,this.el);if(this.keepInContainer){d=Math.max(d,0);d=Math.min(d,this.container.clientWidth-this.el.offsetWidth);Ad=Math.max(Ad,0);Ad=Math.min(Ad,this.container.clientHeight-this.el.offsetHeight)}this.moveToX(d-Ac.x+(Aa||0));this.moveToY(Ad-Ac.y+(AU||0));AN(AY,this);L=true;AE=this},release:function(d){V(d,this);if(typeof this.onrelease==F){this.onrelease(d)}if(this.dragMultiple){Q[this.id]=this}},moveToX:function(d){this.style[i]=(this.x=d)+f},moveToY:function(d){this.style[s]=(this.y=d)+f},removeDropTarget:function(AU){var AU=document.getElementById(AU.id),AS=this.dropTargets,AT,d;for(AT=0,d=AS.length;AT<d;AT++){if(AS[AT].el===AU){AS.splice(AT,1);return AU}}return null},toString:function(){return"Draggable(id="+this.id+")"}}}function G(S){this.el=document.getElementById(S);this.id=S}function O(){return{dragOverClassName:"",initCoords:function(){this.coords=this.coords||{};N.getOffsetCoords(this.el,document,this.coords);this.coords.w=this.el.clientWidth;this.coords.h=this.el.clientHeight},containsCoords:function(T){var S=this.coords,V=S.x,U=S.y;return(T.x>=V&&T.x<=V+S.w)&&(T.y>=U&&T.y<=U+S.h)},ondragover:false,ondragout:B,ondrop:B}}})();(function(){var B=self.APE,F=B.drag,C=B.dom,E=F.Slider=B.createFactory(A,G),J=1,D=2,H="minValue",I="maxValue";E.direction={HORZ:J,VERT:D};function A(O,K,M,N){this.id=O;this.dir=K;this.value=0;this.rationalValue=0;var L=F.Draggable.getById(O,K);L.keepInContainer=true;this.handle=L;this[H]=M||0;this[I]=N;this.tDist=0;this.init()}function G(){B.EventPublisher.add(document,"onkeydown",R);var P="ape-slider-track-active",S=null;return{init:function(){var W=B.EventPublisher,V=document.getElementById(this.id),X=this.handle,U=this.trackbar=document.getElementById(this.id).parentNode;W.add(X,"onglideend",N,this);W.add(X,"ondragend",N,this);W.add(X,"onglideend",N,this);W.add(X,"ondrag",Q,this);if(!("focus" in X)){W.add(V,"onmousedown",L,this)}W.add(V,"onfocus",L,this);W.add(V,"onblur",K,this);W.add(X,"onglide",Q,this);W.add(X,"ondragstop",Q,this);if(this.dir===D){this.tDist=U.clientHeight-V.offsetHeight;X.moveToX=M}else{this.tDist=U.clientWidth-V.offsetWidth;X.moveToY=M}if(this[I]===undefined){this[I]=this.tDist}W.add(U,"onmousedown",T,U)},ticks:15,rationalValue:0,slideToX:function(U){this.handle.moveToX(U);if(typeof slider.onslide==="function"){slider.onslide()}},setValue:function(U){U=Math.max(this[H],U);U=Math.min(this[I],U);var V=this.handle,X=this[I]-this[H],W=(U-this[H])/X;if(!V||!V.id){return}if(this.dir===D){V.moveToY(this.tDist*(1-W))}else{V.moveToX(this.tDist*W)}this.rationalValue=W;this.value=U},slideToY:function(U){this.handle.moveToY(U);this.onslide()},setRationalValue:function(V,U){V=Math.max(0,V);V=Math.min(1,V);this.rationalValue=V;this.setValue(this[H]+(V*(this[I]-this[H])));if(U){Q.call(this,{})}},toString:function(){return"Slider: "+this.handle.toString()}};function M(){}function T(W){var V=C.Event.getTarget(W),U;if(V!==this){return true}U=E.instances[this.getElementsByTagName("*")[0].id];W=W||self.event;if(W.preventDefault){W.preventDefault()}C.addClass(this,P);U.handle.grab(W);Q.call(U,W);return false}function N(U){C.removeClass(this.trackbar,P);Q.call(this,U);if(typeof this.onslideend==="function"){this.onslideend(U)}}function L(U){S=this;C.addClass(this.trackbar,P)}function K(U){if(S===this){S=null}C.removeClass(this.trackbar,P)}function Q(X){this.value=0;var V=document.getElementById(this.id),W=0;if(this.dir===J){if(V.offsetLeft>0){W=V.offsetLeft/this.tDist}else{W=0}}else{if(V.offsetTop>0){var U=this.tDist-V.offsetTop;W=U/this.tDist}else{W=1}}this.rationalValue=W;this.value=W*(this[I]-this[H]);if(this.onslide){this.onslide(X||{})}}var O;function R(Y){Y=Y||self.event;if(Y.stopPropagation){Y.stopPropagation()}Y.cancelBubble=true;var W=+new Date,U=S;if(!U){return}if(W-O<5){return}O=W;var b=Y.keyCode,a,V=b===37,Z=b===39,c=b===38,X=b===40;if(!(V||Z||c||X)){return true}if(U.id in E.instances){a=U[I]/U.ticks;if(V||X){a=-a}U.setValue(U.value+a);if(U.onslide){U.onslide(Y)}return false}}}})();