APE.namespace("APE.drag");(function(){var A=self.APE,C=A.dom,H=C.getStyle,E=A.drag,M=C.Event,F=1000,J={},B,O=Function.prototype,I=self.parseInt,K,L="function",N=E.createFactory("DropTarget",D);E.createCustomFactory("Draggable",function(P){return G});function G(AV){AV.instanceDestructor=f;function AZ(Ap,Ak){var An=document,Al=An.getElementById(Ap),Ao,Am;this.id=Ap;this.el=this.origEl=Al;this.style=Al.style;this.isRel=H(Al,"position").toLowerCase()=="relative";Ao=(this.isRel?Al.parentNode:C.getContainingBlock(Al));if(Ao===null){Ao=An.documentElement}this.container=Ao;this.dropTargets=[];this.handle=Al;this.onbeforeexitcontainer=AU;if(Ak){for(Am in Ak){this[Am]=Ak[Am]}Al.style.zIndex=I(H(Al,"zIndex"),10)||F++}}function AU(){return !this.keepInContainer}function f(){var d,Al,Ak;for(d in this.instances){Ak=this.instances[d];for(Al in Ak){delete Ak[Al]}delete this.instances[d]}J={}}var z=document,Ae=A.EventPublisher,s=Ae.add,j=M.preventDefault,Ad="documentElement",c=z[Ad].style,AL="px",AX="left",Y="top",R=false,AA="setCapture" in document.documentElement,AF=0,AE=0,q,AN=false,Aa=false,Af=false,g=25,Q=-1,i="onmousedown",AH="onmousemove",v="onmouseup",X,t,Ac=M.getCoords;if("ontouchstart" in z){X=true;i="ontouchstart";AH="ontouchmove";v="ontouchend";s(z,"ontouchcancel",a)}t=Ae.get(z,i);if("pixelLeft" in c){AL=0;AX="pixelLeft";Y="pixelTop"}s(z,"onkeydown",a);s(z,v,k);l(z,c);t.add(m).addAfter(AD);z=c=null;function l(Aq,Ap){var An="serSelect",Ar="MozU"+An,Ao="MozU"+An,Ak="u"+An,Am=Ar in c?Ar:Ao in c?Ao:Ak in c?Ak:"",d="onselectstart";if(d in z){s(z,d,Al)}else{t.addAfter(Al)}function Al(At){var As=!q;if(Am){this[Ad].style[Am]=As?"":"none"}else{(At||window.event||0).returnValue=As}}}function AC(d,Ak){return Ak===d.handle||(d.useHandleTree&&C.contains(d.handle,Ak))}function AY(d,Ak){if(Ak){if(d.selectedClassName){C.addClass(d.el,d.selectedClassName)}if(d.dragMultiple&&!(d.id in J)){J[d.id]=d}}else{if(d.selectedClassName){C.removeClass(d.el,d.selectedClassName)}delete J[d.id]}d.isSelected=Ak}function AW(Aq){var Ak=Aq.container,An=Aq.el,Ar=document,Am=Ar.documentElement,Ap=C.getContainingBlock(An)||Am,Ao,As,Av=(Ap===Ak)?{x:0,y:0}:C.getOffsetCoords(Ap,Ak),Al=C.getPixelCoords(An),Aw=C.getOffsetCoords(An,An.parentNode),Au=Aw.x-Al.x+Av.x,At=Aw.y-Al.y+Av.y;if(Aq.keepInContainer){if(Ak===Ar.body){Ao=I(H(Ak,"width"),10);As=I(H(Ak,"height"),10)}else{Ao=Ak.clientWidth;As=Ak.clientHeight}Aq.minX=0-Au;Aq.maxX=Ao-An.offsetWidth-Au;Aq.minY=0-At;Aq.maxY=As-An.offsetHeight-At}}function AO(){y(AY,[false],true);Aa=false}function w(Am){p(q);var Al,Ak,d;if(AN!==false){for(Ak=0,d=AN.length;Ak<d;Ak++){Al=AN[Ak];if(Al.hasDropTargetOver){if(typeof Al.ondragout==L){Al.ondragout(Am,q)}if(Al.dragOverClassName){C.removeClass(Al.el,Al.dragOverClassName)}Al.hasDropTargetOver=false}}}y(p)}function Ag(d,Ak){if(d.activeDragClassName){C.removeClass(d.el,d.activeDragClassName)}Ah(d);if(AA){d.el.releaseCapture()}d.hasBeenDragged=false}function AM(d){if(q.dragMultiple){J[q.id]=q}else{J={}}R=false;Ae.remove(document,AH,AS);q=null}function P(d,Ak){if(Ak){if(d.id in J){AY(d,false)}else{AY(d,true)}}else{if(!d.isSelected){AO();AY(d,true)}}}function Z(d){var Ak=d.el,Al=d.copyEl;if(!Al){Al=d.copyEl=document.getElementById(d.proxyId)}o(d,Al,Ak)}function b(d){if(!d.copyEl){d.copyEl=d.el.cloneNode(true);d.copyEl.id+="Copy"}o(d,d.copyEl,d.el)}function o(Ak,An,Am){var d=An.style;Ak.origEl=Am;d.zIndex=I(Am.style.zIndex,10)+100;Ak.el=An;Ak.style=d;var Al=H(Am,"display");d.display=Al;if(Ak.dragCopy){Am.parentNode.insertBefore(An,Am);if(Ak.isRel){Ai(d,Am,Al)}}else{n(Ak,An,Am)}}function n(d,Am,Al){var Ak=C.getOffsetCoords(Al,Am.parentNode);d.moveToX(Ak.x);d.moveToY(Ak.y)}function Ai(d,Al,Ak){if(Ak=="inline"){d.marginRight=-Al.offsetWidth+-(I(H(Al,"marginRight"),10)||0)+"px"}else{d.marginBottom=-Al.offsetHeight+-(I(H(Al,"marginBottom"),10)||0)+"px"}}function AJ(d){var Ak=d.copyEl;if(!Ak){return}d.el=d.origEl;d.style=d.el.style;d.moveToX(d.x);d.moveToY(d.y);Ak.style.display="none";if(d.dragCopy&&!d.proxyId){d.el.parentNode.insertBefore(Ak,d.el)}}function U(Ak,d){if(!Aa||Af){return}y(AR,[Ak,d])}function AR(Al,Ak,d){if(typeof Ak=="number"){Al.moveToX(Al.origX+Ak)}if(typeof d=="number"){Al.moveToY(Al.origY+d)}}function V(d,Ak){if(d.isBeingDragged){return}if(d.dragCopy&&!d.proxyId){b(d)}if(typeof d.ondragstart==L){d.ondragstart(S(d,Ak))}if(AA){d.el.setCapture()}if(d.activeDragClassName){C.addClass(d.el,d.activeDragClassName)}AW(d);d.isBeingDragged=true}function S(d,Am){var An=d.id,Al={},Ak=1;Al[An]=d;if(Aa){for(An in J){Al[An]=J[An];Ak++}}return{domEvent:Am,draggableList:Al,count:Ak}}function m(Am){if(K){K=false;return}var d=Am||window.event;if(X&&q){return}Am=W(Am,"touches");var Al=M.getTarget(d),An=Am.metaKey||Am.ctrlKey,Ak=AI(Al);if(Ak){if(!Ak.isDragEnabled){if(!An){AO()}return false}if(!An&&Ak.hasHandleSet&&!AC(Ak,Al)){AO();Ak=null;return}else{if(!An&&!Ak.isSelected){AO()}Am.returnValue=false}}else{if(!An){AO();if(q){AY(q,false);q=null}}return}if(An&&q&&!Ak.dragMultiple){R=true;return false}if(!Ak.dragMultiple){if(!An){AO()}else{R=true;return false}}P(Ak,An);Ak.style.zIndex=++F;if(Ab(Ak,Am)==false){return}q=Ak;j(d);y(Ab,[Am]);return Al.tagName!=="IMG"}function AI(Ak){var d,Al=AV.instances;for(;!d&&Ak!==null;Ak=C.findAncestorWithAttribute(Ak,"id")){d=Al[Ak.id]}return d}function AD(){if(!q){return}var Am=q.dropTargets,Al,Ak,An,d;if(!Am){return AN=false}AN=[];for(Ak=An=0,d=Am.length;Ak<d;Ak++){Al=Am[Ak];Al.initCoords();if(Al.ondragover||Al.ondragout||Al.dragOverClassName){AN[An++]=Al}}if(An===0){AN=false}}function Ab(d,Am){if(typeof d.onbeforedragstart==L&&d.onbeforedragstart(S(d,Am))==false){return false}var Al=Ac(Am),Ak;if(d.proxyId&&!d.dragCopy){Z(d)}u(d);AF=Al.x;AE=Al.y;Ak=C.getPixelCoords(d.el);d.origX=d.grabX=Ak.x;d.origY=d.grabY=Ak.y;d.isBeingDragged=false;s(document,AH,AS)}function u(d){var Ak=d.constraint;if(Ak==="y"){d.moveToX=O}else{if(Ak==="x"){d.moveToY=O}}}function Ah(d){delete d.moveToX;delete d.moveToY}function AS(Ap){if(!q){return}var Am=+new Date,At;if(Am-Q<g){return}Q=Am;At=Ap=Ap||event;if(X){Ap=Ap.touches&&Ap.touches[0];if(!Ap){return}j(At)}var Ar=Ac(Ap),An=Ar.x,Al=Ar.y,As=An-AF,Aq=Al-AE,d=q.origX+As,Au=q.origY+Aq,Ak;if(q.isBeingDragged===false){Af=!!q.proxyId;for(Ak in J){Aa=true;break}delete J[q.id];V(q,Ap);if(q.proxyId&&q.dragCopy){Z(q)}y(V,[Ap])}q.hasBeenDragged=(q.hasBeenDragged||!!(As||Aq));if(typeof q.onbeforedrag==L&&q.onbeforedrag(Ap)==false){return}var Ao=typeof q.ondrag===L;if(!e(d,Au,As,Aq)){q.isAtLeft=q.isAtRight=q.isAtTop=q.isAtBottom=false;q.moveToX(d);q.moveToY(Au);U(As,Aq);if(Ao){q.ondrag(Ap)}}if(AN!==false){AB(q,Ap,An,Al)}return false}function e(d,Av,Ar,Ap){if(q.container){var Au=d<q.minX,At=d>q.maxX,An=Av<q.minY,As=Av>q.maxY,Ak=q.constraint,Aq=Ak=="x",Ao=Ak=="y",Am=!Aq,Al=!Ao;if(Au||At||An||As&&q.onbeforeexitcontainer()!=true){if(!Ao){Am=AQ(d,Ar,Au,At)}if(!Aq){Al=AP(Av,Ap,An,As)}if(Am||Al){if(q.ondrag){q.ondrag()}}else{q.ondragstop()}return true}}return false}function AQ(An,d,Am,Ak){if(q.x===An){return false}var Al;if(Am){if(!q.isAtLeft){q.moveToX(q.minX);U(q.minX-q.origX,null);q.isAtRight=false;q.isAtLeft=true}else{Al=true}}else{if(Ak){if(!q.isAtRight){q.moveToX(q.maxX);U(q.maxX-q.origX,null);q.isAtRight=true;q.isAtLeft=false}else{Al=true}}else{q.isAtLeft=q.isAtRight=false;q.moveToX(An);U(d,null)}}return !Al}function AP(An,d,Al,Ak,Ao){if(q.y===An){return false}var Am;if(Al){if(!q.isAtTop){q.moveToY(q.minY);U(null,q.minY-q.origY);q.isAtTop=true;q.isAtBottom=false}else{Am=true}}else{if(Ak){if(!q.isAtBottom){if(q.maxY>0){q.moveToY(q.maxY)}U(null,q.maxY-q.origY);q.isAtTop=false;q.isAtBottom=true}else{Am=true}}else{q.isAtTop=q.isAtBottom=false;q.moveToY(An);U(null,d)}}return !Am}function k(Ak){K=false;Ae.remove(document,AH,AS);if(!q){return}var d=q.hasBeenDragged,Al=(q.isBeingDragged&&!d);Ak=W(Ak,"changedTouches");if(!q.hasBeenDragged&&!Al){if(!R){AJ(q);AM(Ak)}return}if(!Af){y(AK)}y(AJ);AJ(q);Aj(Ak);y(Ag,[Ak]);J[q.id]=q;Ag(q,Ak);q.ondragend({domEvent:Ak,draggableList:J});if(q){AM(Ak)}}function AK(Ak){var d=Ak.x,Al=Ak.y;if(d<Ak.minX){Ak.moveToX(Ak.minX)}else{if(d>Ak.maxX){Ak.moveToX(Ak.maxX)}}if(Al<Ak.minY){Ak.moveToY(Ak.minY)}else{if(Al>Ak.maxY){Ak.moveToY(Ak.maxY)}}}function y(Am,Ak,Al){if(!Aa&&!Al){return}var An,d;Ak=Ak||[];Ak.unshift(0);for(An in J){d=Ak[0]=J[An];Am.apply(d,Ak)}}function a(d){if(!q){return}d=d||event;if(d.keyCode==27||d.type==="touchcancel"){q.release(d)}}function AB(Ar,Ap,Al,d){var As={x:Al,y:d},Ao=0,An=AN.length,Ak,Am,Aq={domEvent:Ap,dragObj:Ar};for(;Ao<An;Ao++){Ak=AN[Ao];Am=Ak.containsCoords(As);if(!Ak.hasDropTargetOver&&Am){Ak.hasDropTargetOver=true;if(typeof Ak.ondragover==L){Ak.ondragover(Aq)}if(Ak.dragOverClassName){C.addClass(Ak.el,Ak.dragOverClassName)}}else{if(Ak.hasDropTargetOver&&!Am){if(typeof Ak.ondragout==L){Ak.ondragout(Aq)}if(Ak.dragOverClassName){C.removeClass(Ak.el,Ak.dragOverClassName)}Ak.hasDropTargetOver=false}}}}function Aj(Am){var Ak=q.dropTargets,Ap,An,d=Ak.length,Al,Ao;if(d){An=Ac(Am);for(Al=0;Al<d;Al++){Ap=Ak[Al];if(typeof Ap.ondrop===L&&Ap.containsCoords(An)){Ap.ondrop(T(Am,q));y(AT,[Ap,Am])}Ao=Ap.dragOverClassName;if(Ao){C.removeClass(Ap.el,Ao)}}}}function T(Ak,d){return{domEvent:Ak,dragObj:d}}function AT(d,Al,Ak){if(d.id!==Al.id){Al.ondrop(T(Ak,d))}}function W(Ak,d){return Ak&&Ak[d]&&Ak[d][0]||Ak||event}function h(Ak){var Al=A.anim,d=new Al.Animation(0.2);d.transition=Al.Transitions.accel;d.run=r;d.dObj=Ak;d.onplay=Ak.onglide;d.onend=AG;d.start()}function r(Am){var Ak=this.dObj,Al=Ak.x-Ak.grabX,d=Ak.y-Ak.grabY;Am=Math.pow(Am,3);Ak.moveToX(Ak.x-(Al*Am));Ak.moveToY(Ak.y-(d*Am))}function AG(){x(this.dObj)}function x(d){if(typeof d.onglideend==L){d.onglideend()}AJ(d)}function p(d){if(A.anim&&d.useAnim){h(d)}else{d.moveToX(d.grabX);d.moveToY(d.grabY);if(typeof d.onglide==L){d.onglide()}x(d,{})}}AZ.prototype={dragCopy:false,useAnim:true,dragMultiple:false,selectedClassName:"",activeDragClassName:"",useHandleTree:true,isSelected:false,onbeforedrag:B,onbeforedragstart:O,ondragstart:B,ondrag:B,ondragstop:O,ondragend:O,x:0,y:0,origX:0,origY:0,grabX:0,grabY:0,keepInContainer:false,isDragEnabled:true,hasHandleSet:false,setHandle:function(d,Ak){this.handle=d;this.hasHandleSet=true;this.useHandleTree=Ak!=false},dropTargets:false,addDropTarget:function(Am){var Ak=N.getByNode(Am),d=Ak.el,Al=this.dropTargets;if(this.el===d){return Ak}return Al[Al.length]=N.getByNode(d)},grab:function(Aq,As,Am){Aq=Aq||window.event;var Ar=M.getTarget(Aq),Al;j(Aq);if(C.contains(this.el,Ar)){return}Al=C.getPixelCoords(this.el);this.grabX=Al.x;this.grabY=Al.y;var At=Ac(Aq),Ap=this.handle,Ak=C.getOffsetCoords(C.getContainingBlock(this.el)),Ao=At.x-Ak.x,d=Ao-(0|Ap.offsetWidth/2),An=At.y-Ak.y,Av=(An-(0|Ap.offsetHeight/2)),Au=C.getOffsetCoords(Ap,this.el);if(this.keepInContainer){d=Math.max(d,0);d=Math.min(d,this.container.clientWidth-this.el.offsetWidth);Av=Math.max(Av,0);Av=Math.min(Av,this.container.clientHeight-this.el.offsetHeight)}this.moveToX(d-Au.x+(As||0));this.moveToY(Av-Au.y+(Am||0));Ab(this,Aq);K=true;q=this},release:function(d){d=d||{};y(Ag,[d]);if(typeof this.onrelease==L){this.onrelease(d)}w(d);AM(d)},moveToX:function(d){this.style[AX]=(this.x=d)+AL},moveToY:function(d){this.style[Y]=(this.y=d)+AL},removeDropTarget:function(Am){Am=document.getElementById(Am.id);var Ak=this.dropTargets,Al,d;for(Al=0,d=Ak.length;Al<d;Al++){if(Ak[Al].el===Am){Ak.splice(Al,1);return Am}}return null},toString:function(){return"Draggable(id="+this.id+")"}};return AZ}function D(){function P(Q){this.el=document.getElementById(Q);this.id=Q}P.prototype={dragOverClassName:"",initCoords:function(){var R=this.coords||(this.coords={}),Q=this.el;C.getOffsetCoords(Q,document,R);R.w=Q.clientWidth;R.h=Q.clientHeight},containsCoords:function(R){var Q=this.coords,T=Q.x,S=Q.y;return(R.x>=T&&R.x<=T+Q.w)&&(R.y>=S&&R.y<=S+Q.h)},ondragover:false,ondragout:B,ondrop:B};return P}})();APE.namespace("APE.drag").createFactory("Slider",function(K){var M=self.APE,Q=M.drag,R=M.dom,I="x",D="y",A="minValue",N=Function.prototype,J="maxValue";function S(V,U){this.id=V;this.dir=U.dir;this.value=0;this.rationalValue=0;this.handle=Q.Draggable.getById(V,{constraint:this.dir});this.handle.keepInContainer=true;this[A]=U[A]||0;this[J]=U[J];this.tDist=0;this.init()}M.EventPublisher.add(document,"onkeydown",F);var T="ape-slider-track-active",P=null;S.prototype={init:function(){var X=M.EventPublisher.add,V=document.getElementById(this.id),W=this.handle,U=this.trackbar=document.getElementById(this.id).parentNode;X(W,"onglideend",O,this);X(W,"ondragend",O,this);X(W,"onglideend",O,this);X(W,"ondrag",H,this);if(!("focus" in W)){X(V,"onmousedown",B,this)}X(V,"onfocus",B,this);X(V,"onblur",L,this);X(W,"onglide",H,this);X(W,"ondragstop",H,this);if(this.dir===D){this.tDist=U.clientHeight-V.offsetHeight;W.moveToX=N}else{this.tDist=U.clientWidth-V.offsetWidth;W.moveToY=N}if(this[J]===undefined){this[J]=this.tDist}X(U,"onmousedown",E,U)},ticks:15,rationalValue:0,slideToX:function(U){this.handle.moveToX(U);if(typeof slider.onslide==="function"){slider.onslide()}},setValue:function(U){U=Math.max(this[A],U);U=Math.min(this[J],U);var V=this.handle,X=this[J]-this[A],W=(U-this[A])/X;if(!V||!V.id){return}if(this.dir===D){V.moveToY(this.tDist*(1-W))}else{V.moveToX(this.tDist*W)}this.rationalValue=W;this.value=U},slideToY:function(U){this.handle.moveToY(U);this.onslide()},setRationalValue:function(V,U){V=Math.max(0,V);V=Math.min(1,V);this.rationalValue=V;this.setValue(this[A]+(V*(this[J]-this[A])));if(U){H.call(this,{})}},toString:function(){return"Slider: "+this.handle.toString()}};function E(W){W=W||window.event;var V=R.Event.getTarget(W),U;U=K.instances[this.getElementsByTagName("*")[0].id];C(U.id);if(V!==this){return true}if(W.preventDefault){W.preventDefault()}R.addClass(this,T);U.handle.grab(W);H.call(U,W);return false}function C(U){var V=document.getElementById(U);if(P&&P.blur){P.blur()}if(V.focus){V.focus()}}function O(U){R.removeClass(this.trackbar,T);H.call(this,U);if(typeof this.onslideend==="function"){this.onslideend(U)}}function B(U){P=this;R.addClass(this.trackbar,T)}function L(U){if(P===this){P=null}R.removeClass(this.trackbar,T)}function H(X){this.value=0;var V=document.getElementById(this.id),W=0;if(this.dir===I){if(V.offsetLeft>0){W=V.offsetLeft/this.tDist}else{W=0}}else{if(V.offsetTop>0){var U=this.tDist-V.offsetTop;W=U/this.tDist}else{W=1}}this.rationalValue=W;this.value=W*(this[J]-this[A]);if(this.onslide){this.onslide(X||{})}}var G;function F(Y){Y=Y||self.event;if(Y.stopPropagation){Y.stopPropagation()}Y.cancelBubble=true;var W=+new Date,U=P;if(!U){return}if(W-G<5){return}G=W;var b=Y.keyCode,a,V=b===37,Z=b===39,c=b===38,X=b===40;if(!(V||Z||c||X)){return true}if(U.id in K.instances){a=U[J]/U.ticks;if(V||X){a=-a}U.setValue(U.value+a);if(U.onslide){U.onslide(Y)}return false}}return S});