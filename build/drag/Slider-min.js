APE.namespace("APE.drag").createFactory("Slider",function(K){var M=self.APE,Q=M.drag,R=M.dom,I="x",D="y",A="minValue",N=Function.prototype,J="maxValue";function S(V,U){this.id=V;this.dir=U.dir;this.value=0;this.rationalValue=0;this.handle=Q.Draggable.getById(V,{constraint:this.dir});this.handle.keepInContainer=true;this[A]=U[A]||0;this[J]=U[J];this.tDist=0;this.init()}M.EventPublisher.add(document,"onkeydown",F);var T="ape-slider-track-active",P=null;S.prototype={init:function(){var X=M.EventPublisher.add,V=document.getElementById(this.id),W=this.handle,U=this.trackbar=document.getElementById(this.id).parentNode;X(W,"onglideend",O,this);X(W,"ondragend",O,this);X(W,"onglideend",O,this);X(W,"ondrag",H,this);if(!("focus" in W)){X(V,"onmousedown",B,this)}X(V,"onfocus",B,this);X(V,"onblur",L,this);X(W,"onglide",H,this);X(W,"ondragstop",H,this);if(this.dir===D){this.tDist=U.clientHeight-V.offsetHeight;W.moveToX=N}else{this.tDist=U.clientWidth-V.offsetWidth;W.moveToY=N}if(this[J]===undefined){this[J]=this.tDist}X(U,"onmousedown",E,U)},ticks:15,rationalValue:0,slideToX:function(U){this.handle.moveToX(U);if(typeof slider.onslide==="function"){slider.onslide()}},setValue:function(U){U=Math.max(this[A],U);U=Math.min(this[J],U);var V=this.handle,X=this[J]-this[A],W=(U-this[A])/X;if(!V||!V.id){return}if(this.dir===D){V.moveToY(this.tDist*(1-W))}else{V.moveToX(this.tDist*W)}this.rationalValue=W;this.value=U},slideToY:function(U){this.handle.moveToY(U);this.onslide()},setRationalValue:function(V,U){V=Math.max(0,V);V=Math.min(1,V);this.rationalValue=V;this.setValue(this[A]+(V*(this[J]-this[A])));if(U){H.call(this,{})}},toString:function(){return"Slider: "+this.handle.toString()}};function E(X){X=X||window.event;var W=R.Event.getTarget(X),V,U;V=K.instances[this.getElementsByTagName("*")[0].id];C(V.id);if(W!==this){return true}if(X.preventDefault){X.preventDefault()}R.addClass(this,T);V.handle.grab(X);H.call(V,X);return false}function C(U){var V=document.getElementById(U);if(P&&P.blur){P.blur()}if(V.focus){V.focus()}}function O(U){R.removeClass(this.trackbar,T);H.call(this,U);if(typeof this.onslideend==="function"){this.onslideend(U)}}function B(U){P=this;R.addClass(this.trackbar,T)}function L(U){if(P===this){P=null}R.removeClass(this.trackbar,T)}function H(X){this.value=0;var V=document.getElementById(this.id),W=0;if(this.dir===I){if(V.offsetLeft>0){W=V.offsetLeft/this.tDist}else{W=0}}else{if(V.offsetTop>0){var U=this.tDist-V.offsetTop;W=U/this.tDist}else{W=1}}this.rationalValue=W;this.value=W*(this[J]-this[A]);if(this.onslide){this.onslide(X||{})}}var G;function F(Y){Y=Y||self.event;if(Y.stopPropagation){Y.stopPropagation()}Y.cancelBubble=true;var W=+new Date,U=P;if(!U){return}if(W-G<5){return}G=W;var b=Y.keyCode,a,V=b===37,Z=b===39,c=b===38,X=b===40;if(!(V||Z||c||X)){return true}if(U.id in K.instances){a=U[J]/U.ticks;if(V||X){a=-a}U.setValue(U.value+a);if(U.onslide){U.onslide(Y)}return false}}return S});