APE.namespace("APE.drag");(function(){var B=self.APE,F=B.drag,C=B.dom,E=F.Slider=B.createFactory(A,G),J="x",D="y",H="minValue",I="maxValue";E.direction={HORZ:J,VERT:D};function A(L,K){this.id=L;this.dir=K.dir;this.value=0;this.rationalValue=0;this.handle=F.Draggable.getById(L,{constraint:this.dir});this.handle.keepInContainer=true;this[H]=K[H]||0;this[I]=K[I];this.tDist=0;this.init()}function G(){B.EventPublisher.add(document,"onkeydown",S);var Q="ape-slider-track-active",T=null;return{init:function(){var Y=B.EventPublisher.add,W=document.getElementById(this.id),X=this.handle,V=this.trackbar=document.getElementById(this.id).parentNode;Y(X,"onglideend",O,this);Y(X,"ondragend",O,this);Y(X,"onglideend",O,this);Y(X,"ondrag",R,this);if(!("focus" in X)){Y(W,"onmousedown",L,this)}Y(W,"onfocus",L,this);Y(W,"onblur",K,this);Y(X,"onglide",R,this);Y(X,"ondragstop",R,this);if(this.dir===D){this.tDist=V.clientHeight-W.offsetHeight;X.moveToX=N}else{this.tDist=V.clientWidth-W.offsetWidth;X.moveToY=N}if(this[I]===undefined){this[I]=this.tDist}Y(V,"onmousedown",U,V)},ticks:15,rationalValue:0,slideToX:function(V){this.handle.moveToX(V);if(typeof slider.onslide==="function"){slider.onslide()}},setValue:function(V){V=Math.max(this[H],V);V=Math.min(this[I],V);var W=this.handle,Y=this[I]-this[H],X=(V-this[H])/Y;if(!W||!W.id){return}if(this.dir===D){W.moveToY(this.tDist*(1-X))}else{W.moveToX(this.tDist*X)}this.rationalValue=X;this.value=V},slideToY:function(V){this.handle.moveToY(V);this.onslide()},setRationalValue:function(W,V){W=Math.max(0,W);W=Math.min(1,W);this.rationalValue=W;this.setValue(this[H]+(W*(this[I]-this[H])));if(V){R.call(this,{})}},toString:function(){return"Slider: "+this.handle.toString()}};function N(){}function U(Y){Y=Y||window.event;var X=C.Event.getTarget(Y),W,V;W=E.instances[this.getElementsByTagName("*")[0].id];M(W.id);if(X!==this){return true}if(Y.preventDefault){Y.preventDefault()}C.addClass(this,Q);W.handle.grab(Y);R.call(W,Y);return false}function M(V){var W=document.getElementById(V);if(T&&T.blur){T.blur()}if(W.focus){W.focus()}}function O(V){C.removeClass(this.trackbar,Q);R.call(this,V);if(typeof this.onslideend==="function"){this.onslideend(V)}}function L(V){T=this;C.addClass(this.trackbar,Q)}function K(V){if(T===this){T=null}C.removeClass(this.trackbar,Q)}function R(Y){this.value=0;var W=document.getElementById(this.id),X=0;if(this.dir===J){if(W.offsetLeft>0){X=W.offsetLeft/this.tDist}else{X=0}}else{if(W.offsetTop>0){var V=this.tDist-W.offsetTop;X=V/this.tDist}else{X=1}}this.rationalValue=X;this.value=X*(this[I]-this[H]);if(this.onslide){this.onslide(Y||{})}}var P;function S(Z){Z=Z||self.event;if(Z.stopPropagation){Z.stopPropagation()}Z.cancelBubble=true;var X=+new Date,V=T;if(!V){return}if(X-P<5){return}P=X;var c=Z.keyCode,b,W=c===37,a=c===39,d=c===38,Y=c===40;if(!(W||a||d||Y)){return true}if(V.id in E.instances){b=V[I]/V.ticks;if(W||Y){b=-b}V.setValue(V.value+b);if(V.onslide){V.onslide(Z)}return false}}}})();