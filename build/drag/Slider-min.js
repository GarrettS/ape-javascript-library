APE.namespace("APE.drag");APE.drag.Slider=function(B,A){this.id=B.id;this.dir=A;this.value=0;this.rationalValue=0;var C=APE.drag.Draggable.getByNode(B,A);C.keepInContainer=true;C.focusClassName="ape-slider-h-handle-focus";this.handle=C;this.trackbar=B.parentNode;this.tDist=0;this.init()};(function(){var B=APE.drag,A=B.Slider,C=B.Draggable.constraints;A.getByNode=APE.getByNode;A.activeSlider=null;A.direction={HORZ:C.HORZ,VERT:C.VERT}})();APE.drag.Slider.prototype={init:function(){var C=APE.EventPublisher,B=document.getElementById(this.id),D=this.handle,A=this.trackbar;C.add(D,"ondragend",this.dragEnd,this);C.add(D,"onglideend",this.dragEnd,this);C.add(D,"ondrag",this._onslide,this);C.add(D,"onfocus",this._onfocus,this);C.add(D,"onblur",this._onblur,this);C.add(D,"onglide",this._onslide,this);C.add(D,"ondragstop",this._onslide,this);C.add(document,"onkeydown",this._keyDown,this);if(this.dir===this.constructor.direction.VERT){this.tDist=A.clientHeight-B.offsetHeight}else{this.tDist=A.clientWidth-B.offsetWidth}if(this.maxValue==undefined){this.maxValue=this.tDist}C.add(this.trackbar,"onmousedown",this.trackbarMouseDown)},ticks:15,rationalValue:0,minValue:0,maxValue:undefined,slideToX:function(A){this.handle.moveToX(A);if(typeof slider.onslide=="function"){slider.onslide()}},setValue:function(A){A=Math.max(this.minValue,A);A=Math.min(this.maxValue,A);var B=this.handle,D=this.maxValue-this.minValue,C=(A-this.minValue)/D;if(this.dir===this.constructor.direction.VERT){B.moveToY(this.tDist*(1-C))}else{B.moveToX(this.tDist*C)}this.rationalValue=C;this.value=A},slideToY:function(A){this.handle.moveToY(A);this.onslide()},setRationalValue:function(B,A){B=Math.max(0,B);B=Math.min(1,B);this.rationalValue=B;this.setValue(this.minValue+(B*(this.maxValue-this.minValue)));if(A){this._onslide({})}},dragEnd:function(A){APE.dom.removeClass(this.trackbar,"scrollbar-track-active");if(typeof this.onslideend=="function"){this.onslideend(A)}},trackbarMouseDown:function(D){var B=window.APE,E=B.dom,C=E.Event.getTarget(D),A=B.drag.Slider.instances[this.getElementsByTagName("*")[0].id];if(C!=this){return true}if(!D){D=event}else{if(D.preventDefault){D.preventDefault()}}E.addClass(this,"ape-slider-track-active");A.handle.grab(D);A._onslide(D);return false},_onfocus:function(A){this.constructor.activeSlider=this;APE.dom.addClass(this.trackbar,"ape-slider-track-active")},_onblur:function(B){var A=this.constructor;if(A.activeSlider===this){A.activeSlider=null}APE.dom.removeClass(this.trackbar,"ape-slider-track-active")},_onslide:function(D){this.value=0;var B=document.getElementById(this.id),C=0;if(this.dir===this.constructor.direction.HORZ){if(B.offsetLeft>0){C=B.offsetLeft/this.tDist}else{C=0}}else{if(B.offsetTop>0){var A=this.tDist-B.offsetTop;C=A/this.tDist}else{C=1}}this.rationalValue=C;this.value=C*(this.maxValue-this.minValue);if(this.onslide){this.onslide(D||{})}},_keyDown:function(G){G=G||event;if(G.stopPropagation){G.stopPropagation()}G.cancelBubble=true;var E=new Date-0,D=APE.drag.Slider,B=D.activeSlider;if(!B){return}if(E-arguments.callee.timeStamp<5){return}arguments.callee.timeStamp=E;var I=G.keyCode,A=D.instances,C=I===37,H=I===39,J=I===38,F=I===40;if(!(C||H||J||F)){return true}if(B&&B.id in A){if(C||F){B.setValue(B.value-B.maxValue/B.ticks,0)}else{if(H||J){B.setValue(B.value+B.maxValue/B.ticks,0)}}if(B.onslide){B.onslide(G)}return false}}};