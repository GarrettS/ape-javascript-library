APE.namespace("APE.drag");
(function(){function v(e,j,p,k){this.id=e;this.dir=j;this.rationalValue=this.value=0;e=s.Draggable.getById(e,j);e.keepInContainer=true;this.handle=e;this[g]=p||0;this[f]=k;this.tDist=0;this.init()}function w(){var e;function j(){}function p(a){var b=l.Event.getTarget(a);if(b!==this)return true;b=q.instances[this.getElementsByTagName("*")[0].id];a=a||self.event;a.preventDefault&&a.preventDefault();l.addClass(this,n);b.handle.grab(a);h.call(b,a);return false}function k(a){l.removeClass(this.trackbar,n);
h.call(this,a);typeof this.onslideend==="function"&&this.onslideend(a)}function t(){o=this;l.addClass(this.trackbar,n)}function x(){if(o===this)o=null;l.removeClass(this.trackbar,n)}function h(a){this.value=0;var b=document.getElementById(this.id),c=0;if(this.dir===u)c=b.offsetLeft>0?b.offsetLeft/this.tDist:0;else if(b.offsetTop>0){b=this.tDist-b.offsetTop;c=b/this.tDist}else c=1;this.rationalValue=c;this.value=c*(this[f]-this[g]);if(this.onslide)this.onslide(a||{})}function y(a){a=a||self.event;
a.stopPropagation&&a.stopPropagation();a.cancelBubble=true;var b=+new Date,c=o;if(c)if(!(b-e<5)){e=b;var d=a.keyCode,i;b=d===37;i=d===39;var z=d===38;d=d===40;if(!(b||i||z||d))return true;if(c.id in q.instances){i=c[f]/c.ticks;if(b||d)i=-i;c.setValue(c.value+i);c.onslide&&c.onslide(a);return false}}}m.EventPublisher.add(document,"onkeydown",y);var n="ape-slider-track-active",o=null;return{init:function(){var a=m.EventPublisher,b=document.getElementById(this.id),c=this.handle,d=this.trackbar=document.getElementById(this.id).parentNode;
a.add(c,"onglideend",k,this);a.add(c,"ondragend",k,this);a.add(c,"onglideend",k,this);a.add(c,"ondrag",h,this);"focus"in c||a.add(b,"onmousedown",t,this);a.add(b,"onfocus",t,this);a.add(b,"onblur",x,this);a.add(c,"onglide",h,this);a.add(c,"ondragstop",h,this);if(this.dir===r){this.tDist=d.clientHeight-b.offsetHeight;c.moveToX=j}else{this.tDist=d.clientWidth-b.offsetWidth;c.moveToY=j}if(this[f]===undefined)this[f]=this.tDist;a.add(d,"onmousedown",p,d)},ticks:15,rationalValue:0,slideToX:function(a){this.handle.moveToX(a);
typeof slider.onslide==="function"&&slider.onslide()},setValue:function(a){a=Math.max(this[g],a);a=Math.min(this[f],a);var b=this.handle,c=this[f]-this[g];c=(a-this[g])/c;if(b&&b.id){this.dir===r?b.moveToY(this.tDist*(1-c)):b.moveToX(this.tDist*c);this.rationalValue=c;this.value=a}},slideToY:function(a){this.handle.moveToY(a);this.onslide()},setRationalValue:function(a,b){a=Math.max(0,a);this.rationalValue=a=Math.min(1,a);this.setValue(this[g]+a*(this[f]-this[g]));b&&h.call(this,{})},toString:function(){return"Slider: "+
this.handle.toString()}}}var m=self.APE,s=m.drag,l=m.dom,q=s.Slider=m.createFactory(v,w),u=1,r=2,g="minValue",f="maxValue";q.direction={HORZ:u,VERT:r}})();
