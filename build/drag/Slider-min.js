APE.namespace("APE.drag");(function(){var B=window.APE,F=B.drag,C=B.dom,E=F.Slider=B.createFactory(A,G),H=null,I=1,D=2;MINVAL="minValue",MAXVAL="maxValue";E.direction={HORZ:I,VERT:D};function A(K,J,M,N){this.id=K.id;this.dir=J;this.value=0;this.rationalValue=0;var L=F.Draggable.getByNode(K,J);L.keepInContainer=true;this.handle=L;this[MINVAL]=M||0;this[MAXVAL]=N;this.trackbar=K.parentNode;this.tDist=0;this.init()}function G(){B.EventPublisher.add(document,"onkeydown",Q,this);var O="ape-slider-track-active";return{init:function(){var U=B.EventPublisher,T=document.getElementById(this.id),V=this.handle,S=this.trackbar;U.add(V,"ondragend",M,this);U.add(V,"onglideend",M,this);U.add(V,"ondrag",P,this);U.add(T,"onfocus",K,this);U.add(T,"onblur",J,this);U.add(V,"onglide",P,this);U.add(V,"ondragstop",P,this);if(this.dir===D){this.tDist=S.clientHeight-T.offsetHeight;V.moveToX=L}else{this.tDist=S.clientWidth-T.offsetWidth;V.moveToY=L}if(this[MAXVAL]==undefined){this[MAXVAL]=this.tDist}U.add(this.trackbar,"onmousedown",R)},ticks:15,rationalValue:0,slideToX:function(S){this.handle.moveToX(S);if(typeof slider.onslide=="function"){slider.onslide()}},setValue:function(S){S=Math.max(this[MINVAL],S);S=Math.min(this[MAXVAL],S);var T=this.handle,V=this[MAXVAL]-this[MINVAL],U=(S-this[MINVAL])/V;if(this.dir===D){T.moveToY(this.tDist*(1-U))}else{T.moveToX(this.tDist*U)}this.rationalValue=U;this.value=S},slideToY:function(S){this.handle.moveToY(S);this.onslide()},setRationalValue:function(T,S){T=Math.max(0,T);T=Math.min(1,T);this.rationalValue=T;this.setValue(this[MINVAL]+(T*(this[MAXVAL]-this[MINVAL])));if(S){P.call(this,{})}}};function L(){}function R(U){var T=C.Event.getTarget(U),S=E.instances[this.getElementsByTagName("*")[0].id];if(T!=this){return true}if(!U){U=event}else{if(U.preventDefault){U.preventDefault()}}C.addClass(this,O);S.handle.grab(U);P.call(S,U);return false}function M(S){C.removeClass(this.trackbar,O);if(typeof this.onslideend=="function"){this.onslideend(S)}}function K(S){H=this;C.addClass(this.trackbar,O)}function J(S){if(H===this){H=null}C.removeClass(this.trackbar,O)}function P(V){this.value=0;var T=document.getElementById(this.id),U=0;if(this.dir===I){if(T.offsetLeft>0){U=T.offsetLeft/this.tDist}else{U=0}}else{if(T.offsetTop>0){var S=this.tDist-T.offsetTop;U=S/this.tDist}else{U=1}}this.rationalValue=U;this.value=U*(this[MAXVAL]-this[MINVAL]);if(this.onslide){this.onslide(V||{})}}var N;function Q(Z){Z=Z||window.event;if(Z.stopPropagation){Z.stopPropagation()}Z.cancelBubble=true;var T=+new Date,W=H;if(!W){return}if(T-N<5){return}N=T;var Y=Z.keyCode,S=Y===37,V=Y===39,X=Y===38,U=Y===40;if(!(S||V||X||U)){return true}if(W&&W.id in E.instances){if(S||U){W.setValue(W.value-W[MAXVAL]/W.ticks,0)}else{if(V||X){W.setValue(W.value+W[MAXVAL]/W.ticks,0)}}if(W.onslide){W.onslide(Z)}return false}}}})();