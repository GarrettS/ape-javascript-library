APE.namespace("APE.ajax");
(function(){function c(f,i){this.id=f;this.httpMethod=i.method&&i.method.toLowerCase()||"get";this.uri=i.action;if(!this.uri)throw URIError("formConfig.action = undefined");this.enctype=i.enctype;if(!this.enctype&&this.httpMethod=="post")this.enctype=a;this.req=d();this.config={};for(var l in i)this.config[l]=i[l]}function d(){var f,i,l;for(i=0;i<4;i++)if(f=r[i]){l=f.readyState;l===4&&f.abort();if(l===0)return f}else return r[i]=j();return j()}function j(){return q?new self[n]:new self[n]("Microsoft.XMLHTTP")}
function k(){function f(b){function g(){b.req.readyState===4&&i(b)}b.timerId=setInterval(g,50);if(b.timeoutMillis>0){var m=function(){b.ontimeout();b.req.abort();l(b);b.req.onreadystatechange=o};b.timeoutID=setTimeout(m,b.timeoutMillis)}}function i(b){var g=b.req,m=g.status;if(m=m>=200&&m<300||m==304||m==1223){l(b,true);b.onsucceed(g)}else{l(b,false);b.onfail(g)}b.timerId=clearInterval(b.timerId)}function l(b,g){b.oncomplete({successful:g})}var o=Function.prototype;return{onabort:o,oncomplete:o,onsucceed:o,
onfail:o,ontimeout:o,onsend:o,timeoutMillis:0,send:function(b,g){var m=this.uri;this.timeoutMillis=g|0||4E3;if(this.httpMethod=="get"&&typeof b=="string")m+=b;this.req.open(this.httpMethod,m,true);f(this);if("setRequestHeader"in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post")if(typeof b=="string")this.req.setRequestHeader("Content-Type",this.enctype);else if(b&&typeof b.unshift=="function"&&this.enctype=="multipart/form-data"){g="---------------------------DATA_"+
++p+"\n";b=g+b.join(g)+g;this.req.setRequestHeader("Content-Type",this.enctype+"; "+g)}}try{this.onsend();this.req.send(b||null)}catch(s){this.onfail(s)}return this},abort:function(){this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);l(this,false)},toString:function(){var b="AsyncRequest: \nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",g;for(g in this.req)try{typeof this.req[g]=="string"&&b.concat(g+": "+this.req[g]+"\n")}catch(m){}return b}}}APE.ajax.AsyncRequest=
APE.createFactory(c,k);var a="application/x-www-form-urlencoded",e="XMLHttpRequest",h="ActiveXObject",n=e in self?e:h,p=0,q=e==n,r=[]})();APE.namespace("APE.form");APE.form.Form=function(c){this.form=c};
APE.form.Form.prototype={toObject:function(c){var d=this.form,j=d.elements,k,a,e,h,n=/^(?:rad|che)/,p={},q,r,f,i=/^(?:submit|image)$/;if(!j){d=document.createElement("form").appendChild(d.cloneNode(true)).parentNode;j=d.elements}d=0;for(k=j.length;d<k;d++){a=j[d];e=a.type;h=a.name;if(!(!h||a.disabled||e=="reset"||e=="button"||i.test(e)||n.test(e)&&!a.checked||a.tagName=="OBJECT"&&a.declare||a.type=="select-multiple"&&!a.value)){(f=p[h])||(p[h]=f=[]);e=f.length;if(h=a.options)if(a.type=="select-multiple"){q=
0;for(r=h.length;q<r;q++){a=h[q];if(a.selected)f[e]=a.value||a.text}}else{a=h[a.selectedIndex];a.disabled||(f[e]=a.value||a.text)}else if(a.type=="file"){if((h=a.files)&&h[0])f[e]=h[0]}else f[e]=a.value}}if(c&&c.name){p[c.name]||(f=p[c.name]=[]);f[f.length]=c.value}return p},getMultipartFormData:function(c){c=this.toObject(c);var d,j,k,a,e,h=[],n="\r\n\r\n";for(d in c){j=c[d];a=0;for(e=j.length;a<e;a++)if(k=j[a])h[h.length]='Content-Disposition: form-data; name="'+d+'";'+(k.fileName&&k.getAsBinary?
' filename="'+k.fileName+'"'+n+k.getAsBinary():n+k)}return h},getQueryString:function(c){c=this.toObject(c);var d,j,k,a,e=[],h=/%20/g;for(d in c){k=c[d];a=encodeURIComponent(d);j=0;for(len=k.length;j<len;j++)e[e.length]=a+"="+encodeURIComponent(k[j]).replace(h,"+")}return e.join("&")},serialize:function(c){var d=this.form.method.toLowerCase();if(d=="get")return this.form.action+"?"+this.getQueryString(c);if(d=="post"){if(this.form.enctype=="multipart/form-data")return this.getMultipartFormData(c);
return this.getQueryString(c)}}};
