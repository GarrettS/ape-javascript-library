APE.namespace("APE.ajax").appendToURI=function(C,B){var A=C?C.indexOf("?")!==-1?"&":"?":"";return C+A+B};APE.namespace("APE.ajax").createFactory("ScriptLoader",function(G){var C=Function.prototype,B=APE.ajax.appendToURI,F=null;APE.ajax.jsonp=APE.ajax.jsonp||C;function A(J,I){this.id=J;this.script=document.createElement("script");this.script.id=this.id;I&&APE.createMixin(this,I)}function E(J){var I=G.getById(J.id);if(I.loaded){return}I.loaded=true;J.parentNode.removeChild(J);I.onsuccess()}function D(I){if(I&&I.type==="load"||this.readyState==="complete"){this.onreadystatechange=C;F=true;E(this);H=C}}function H(J,I){var L=new Image(),K="ScriptLoader="+I.id+(+new Date+"").slice(-4);L.onload=function(){E(I);I=null};L.src=APE.ajax.appendToURI(J,K);L=null}A.prototype={get:function(K){var J=document.getElementsByTagName("head")[0],I=this.script;this.loaded=false;if(F!==false){I.onload=I.onreadystatechange=D}I.src=B(this.uri,K);J.appendChild(I);H(K,I)},onsuccess:C};return A});