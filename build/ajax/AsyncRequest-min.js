APE.namespace("APE.ajax");(function(){APE.ajax.AsyncRequest=APE.createFactory(J,F);function J(M,K){this.id=M;this.httpMethod=K.method&&K.method.toLowerCase()||"get";this.uri=K.action;if(!this.uri){throw URIError("formConfig.action = undefined")}this.enctype=K.enctype;if(!this.enctype&&this.httpMethod=="post"){this.enctype=A}this.req=I();this.config={};for(var L in K){this.config[L]=K[L]}}var A="application/x-www-form-urlencoded",E="XMLHttpRequest",G="ActiveXObject",H=(E in self)?E:G,B=E==H,D=[];function I(){var L,M,K;for(M=0;M<4;M++){L=D[M];if(!L){return D[M]=C()}else{K=L.readyState;if(K===4){L.abort()}if(K===0){return L}}}return C()}function C(){return B?new self[H]:new self[H]("Microsoft.XMLHTTP")}function F(){function L(){}function N(Q){Q._pollId=setInterval(O,50);if(Q.timeoutMillis>0){var P=function(){Q.ontimeout();Q.req.abort();K(Q)};Q.timeoutID=setTimeout(P,Q.timeoutMillis)}function O(){if(Q.req.readyState===4){M(Q)}}}function M(O){var P=O.req.status,Q=P>=200&&P<300||P==304||P==1223;if(Q){K(O,true);O.onsucceed(O.req)}else{K(O,false);O.onfail(O.req)}clearTimeout(O.timeoutID)}function K(O,P){O.oncomplete({successful:P})}return{onabort:L,oncomplete:L,onsucceed:L,onfail:L,ontimeout:L,onsend:L,timeoutMillis:0,send:function(Q,R){var P=this.uri,S;this.timeoutMillis=R|0||4000;N(this);if(this.httpMethod=="get"&&typeof Q=="string"){P+=Q}this.req.open(this.httpMethod,P,true);if("setRequestHeader" in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof Q=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(Q&&typeof Q.unshift=="function"&&this.enctype=="multipart/form-data"){S="---------------------------DATA_"+(+new Date)+"\n";Q=S+Q.join(S)+S;this.req.setRequestHeader("Content-Type",this.enctype+"; "+S)}}}}try{this.onsend();this.req.send(Q||null)}catch(O){this.onfail(O)}return this},abort:function(){this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);K(this,false)},toString:function(){var P="AsyncRequest: \nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",Q;for(Q in this.req){try{if(typeof this.req[Q]=="string"){P.concat(Q+": "+this.req[Q]+"\n")}}catch(O){}}return P}}}})();