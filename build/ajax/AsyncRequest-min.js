APE.namespace("APE.ajax");(function(){var G=window.APE,P=G.createFactory(O,J);P.isSupported=D;G.ajax.AsyncRequest=P;function O(R,Q){this.id=R;this.uri=Q.action||typeof Q=="string"&&Q;if(!this.uri){throw URIError("formConfig.action = undefined")}this.httpMethod=Q.method&&Q.method.toLowerCase()||"get";this.enctype=Q.enctype||"application/x-www-form-urlencoded";if(C){this.req=N()}}var H="XMLHttpRequest",K="ActiveXObject",E,L=typeof window[H]!="undefined"?H:K,I=0,A=H==L,C=A||typeof window[K]!="undefined"&&!!B(),F=[];function D(){return C}function N(){var R,S,Q;for(S=0;S<4;S++){R=F[S];if(!R){return F[S]=B()}else{Q=R.readyState;if(Q===4){R.abort()}if(Q===0){return R}}}return B()}function B(){return A?new this[L]:M()}function M(){var T=this[L],S,Q,U;if(E){return new T(E)}Q=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(S=0;S<Q.length;S++){try{U=new T(Q[S]);E=Q[S];return U}catch(R){}}C=false}function J(){var R=Function.prototype;function T(W){W.timerId=setInterval(U,50);if(W.timeoutMillis>0){var V=function(){W.ontimeout();W.req.abort();Q(W);W.req.onreadystatechange=R};W.timeoutID=setTimeout(V,W.timeoutMillis)}function U(){if(W.req.readyState===4){S(W)}}}function S(U){var W=U.req,V=W.status,X=V>=200&&V<300||V==304||V==1223;if(X){Q(U,true);U.onsucceed(W)}else{Q(U,false);U.onfail(W)}U.timerId=clearInterval(U.timerId)}function Q(U,V){U.oncomplete({successful:V})}return{onabort:R,oncomplete:R,onsucceed:R,onfail:R,ontimeout:R,onsend:R,timeoutMillis:0,send:function(W,X){if(!C){return this.onfail()}var V=this.uri,Y;this.timeoutMillis=X|0||4000;if(this.httpMethod=="get"&&typeof W=="string"){V+=W}this.req.open(this.httpMethod,V,true);T(this);if("setRequestHeader" in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof W=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(W&&typeof W.unshift=="function"&&this.enctype=="multipart/form-data"){Y="---------------------------DATA_"+(++I)+"\n";W=Y+W.join(Y)+Y;this.req.setRequestHeader("Content-Type",this.enctype+"; "+Y)}}}}try{this.onsend();this.req.send(W||null)}catch(U){this.onfail(U)}return this},abort:function(){if(!C){return}this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);Q(this,false)},toString:function(){var V="AsyncRequest: \nisSupported(): "+C+"\nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",W;if(C){for(W in this.req){try{if(typeof this.req[W]=="string"){V.concat(W+": "+this.req[W]+"\n")}}catch(U){}}}return V}}}})();