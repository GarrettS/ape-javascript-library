APE.namespace("APE.ajax");
(function(){function l(f,c){this.id=f;this.httpMethod=c.method&&c.method.toLowerCase()||"get";this.uri=c.action;if(!this.uri)throw URIError("formConfig.action = undefined");this.enctype=c.enctype;if(!this.enctype&&this.httpMethod=="post")this.enctype=m;this.req=n();this.config={};for(var d in c)this.config[d]=c[d]}function n(){var f,c,d;for(c=0;c<4;c++)if(f=j[c]){d=f.readyState;d===4&&f.abort();if(d===0)return f}else return j[c]=k();return k()}function k(){return o?new self[h]:new self[h]("Microsoft.XMLHTTP")}
function p(){function f(a){function b(){a.req.readyState===4&&c(a)}a.timerId=setInterval(b,50);if(a.timeoutMillis>0){var e=function(){a.ontimeout();a.req.abort();d(a);a.req.onreadystatechange=g};a.timeoutID=setTimeout(e,a.timeoutMillis)}}function c(a){var b=a.req,e=b.status;if(e=e>=200&&e<300||e==304||e==1223){d(a,true);a.onsucceed(b)}else{d(a,false);a.onfail(b)}a.timerId=clearInterval(a.timerId)}function d(a,b){a.oncomplete({successful:b})}var g=Function.prototype;return{onabort:g,oncomplete:g,onsucceed:g,
onfail:g,ontimeout:g,onsend:g,timeoutMillis:0,send:function(a,b){var e=this.uri;this.timeoutMillis=b|0||4E3;if(this.httpMethod=="get"&&typeof a=="string")e+=a;this.req.open(this.httpMethod,e,true);f(this);if("setRequestHeader"in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post")if(typeof a=="string")this.req.setRequestHeader("Content-Type",this.enctype);else if(a&&typeof a.unshift=="function"&&this.enctype=="multipart/form-data"){b="---------------------------DATA_"+
++q+"\n";a=b+a.join(b)+b;this.req.setRequestHeader("Content-Type",this.enctype+"; "+b)}}try{this.onsend();this.req.send(a||null)}catch(r){this.onfail(r)}return this},abort:function(){this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);d(this,false)},toString:function(){var a="AsyncRequest: \nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",b;for(b in this.req)try{typeof this.req[b]=="string"&&a.concat(b+": "+this.req[b]+"\n")}catch(e){}return a}}}APE.ajax.AsyncRequest=
APE.createFactory(l,p);var m="application/x-www-form-urlencoded",i="XMLHttpRequest",s="ActiveXObject",h=i in self?i:s,q=0,o=i==h,j=[]})();
