APE.namespace("APE.ajax");(function(){APE.ajax.AsyncRequest=APE.createFactory(O,J);APE.ajax.AsyncRequest.isSupported=E;function O(Q,P){this.id=Q;this.httpMethod=P.method&&P.method.toLowerCase()||"get";this.uri=P.action;if(!this.uri){throw URIError("formConfig.action = undefined")}this.enctype=P.enctype;if(!this.enctype&&this.httpMethod=="post"){this.enctype=A}if(D){this.req=N()}this.config=APE.mixin({},P)}var A="application/x-www-form-urlencoded",H="XMLHttpRequest",K="ActiveXObject",F,L=typeof window[H]!="undefined"?H:K,I=0,B=H==L,D=B||typeof window[K]!="undefined"&&!!C(),G=[];function E(){return D}function N(){var Q,R,P;for(R=0;R<4;R++){Q=G[R];if(!Q){return G[R]=C()}else{P=Q.readyState;if(P===4){Q.abort()}if(P===0){return Q}}}return C()}function C(){if(!D){return}return B?new this[L]:M()}function M(){var S=this[L],R,P,T;if(F){return new S(F)}P=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(R=0;R<P.length;R++){try{T=new S(P[R]);F=P[R];return T}catch(Q){}}D=false}function J(){var Q=Function.prototype;function S(V){V.timerId=setInterval(T,50);if(V.timeoutMillis>0){var U=function(){V.ontimeout();V.req.abort();P(V);V.req.onreadystatechange=Q};V.timeoutID=setTimeout(U,V.timeoutMillis)}function T(){if(V.req.readyState===4){R(V)}}}function R(T){var V=T.req,U=V.status,W=U>=200&&U<300||U==304||U==1223;if(W){P(T,true);T.onsucceed(V)}else{P(T,false);T.onfail(V)}T.timerId=clearInterval(T.timerId)}function P(T,U){T.oncomplete({successful:U})}return{onabort:Q,oncomplete:Q,onsucceed:Q,onfail:Q,ontimeout:Q,onsend:Q,timeoutMillis:0,send:function(V,W){if(!D){return this.onfail()}var U=this.uri,X;this.timeoutMillis=W|0||4000;if(this.httpMethod=="get"&&typeof V=="string"){U+=V}this.req.open(this.httpMethod,U,true);S(this);if("setRequestHeader" in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof V=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(V&&typeof V.unshift=="function"&&this.enctype=="multipart/form-data"){X="---------------------------DATA_"+(++I)+"\n";V=X+V.join(X)+X;this.req.setRequestHeader("Content-Type",this.enctype+"; "+X)}}}}try{this.onsend();this.req.send(V||null)}catch(T){this.onfail(T)}return this},abort:function(){if(!D){return}this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);P(this,false)},toString:function(){var U="AsyncRequest: \nisSupported(): "+D+"\nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",V;if(D){for(V in this.req){try{if(typeof this.req[V]=="string"){U.concat(V+": "+this.req[V]+"\n")}}catch(T){}}}return U}}}})();