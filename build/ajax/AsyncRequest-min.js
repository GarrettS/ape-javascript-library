APE.namespace("APE.ajax");(function(){APE.ajax.AsyncRequest=APE.createFactory(N,I);function N(Q,O){this.id=Q;this.httpMethod=O.method&&O.method.toLowerCase()||"get";this.uri=O.action;if(!this.uri){throw URIError("formConfig.action = undefined")}this.enctype=O.enctype;if(!this.enctype&&this.httpMethod=="post"){this.enctype=A}this.req=M();this.config={};for(var P in O){this.config[P]=O[P]}}var A="application/x-www-form-urlencoded",G="XMLHttpRequest",J="ActiveXObject",E,K=(G in self)?G:J,H=0,B=G==K,D=B||J in self,F=[];function M(){var P,Q,O;for(Q=0;Q<4;Q++){P=F[Q];if(!P){return F[Q]=C()}else{O=P.readyState;if(O===4){P.abort()}if(O===0){return P}}}return C()}function C(){if(!D){return}return B?new self[K]:L()}function L(){var R=self[K],Q,O,S;if(E){return new R(E)}O=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(Q=0;Q<O.length;Q++){try{S=new R(O[Q]);E=O[Q];return S}catch(P){}}D=false}function I(){var P=Function.prototype;function R(U){U.timerId=setInterval(S,50);if(U.timeoutMillis>0){var T=function(){U.ontimeout();U.req.abort();O(U);U.req.onreadystatechange=P};U.timeoutID=setTimeout(T,U.timeoutMillis)}function S(){if(U.req.readyState===4){Q(U)}}}function Q(S){var U=S.req,T=U.status,V=T>=200&&T<300||T==304||T==1223;if(V){O(S,true);S.onsucceed(U)}else{O(S,false);S.onfail(U)}S.timerId=clearInterval(S.timerId)}function O(S,T){S.oncomplete({successful:T})}return{onabort:P,oncomplete:P,onsucceed:P,onfail:P,ontimeout:P,onsend:P,timeoutMillis:0,send:function(U,V){var T=this.uri,W;this.timeoutMillis=V|0||4000;if(this.httpMethod=="get"&&typeof U=="string"){T+=U}this.req.open(this.httpMethod,T,true);R(this);if("setRequestHeader" in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof U=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(U&&typeof U.unshift=="function"&&this.enctype=="multipart/form-data"){W="---------------------------DATA_"+(++H)+"\n";U=W+U.join(W)+W;this.req.setRequestHeader("Content-Type",this.enctype+"; "+W)}}}}try{this.onsend();this.req.send(U||null)}catch(S){this.onfail(S)}return this},abort:function(){this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);O(this,false)},toString:function(){var T="AsyncRequest: \nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",U;for(U in this.req){try{if(typeof this.req[U]=="string"){T.concat(U+": "+this.req[U]+"\n")}}catch(S){}}return T}}}})();