APE.namespace("APE.ajax");(function(){APE.ajax.AsyncRequest=F;F.getById=APE.getById;function F(K,I){this.id=K;this.httpMethod=I.method&&I.method.toLowerCase()||"get";this.uri=I.action;if(!this.uri){throw URIError("formConfig.action = undefined")}this.enctype=I.enctype;if(!this.enctype&&this.httpMethod=="post"){this.enctype="application/x-www-form-urlencoded"}this.req=A();this.config={};for(var J in I){if(!(J in this.config)){this.config[J]=I[J]}}}var E="XMLHttpRequest",B="ActiveXObject",H=(E in window)?E:B,D=E==H,C=[];function A(){var J,K,I;for(K=0;K<4;K++){J=C[K];if(!J){return C[K]=L()}else{I=J.readyState;if(I==4){J.abort()}if(I==0){return J}}}return L();function L(){return D?new window[H]:new window[H]("Microsoft.XMLHTTP")}}function G(I){window.clearInterval(I)}F.prototype={onabort:function(){},oncomplete:function(){},onsucceed:function(){},onfail:function(){},ontimeout:function(){},onsend:function(){},timeoutMillis:0,send:function(K,L){var J=this.uri;this.timeoutMillis=L|0||4000;this._setUpReadyStateChangeHandler();if(this.httpMethod=="get"&&typeof K=="string"){J+=K}this.req.open(this.httpMethod,J,true);if("setRequestHeader" in this.req){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof K=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(K&&typeof K.unshift=="function"&&this.enctype=="multipart/form-data"){var M="---------------------------DATA_"+(new Date-0)+"\n";K=M+K.join(M)+M;this.req.setRequestHeader("Content-Type",this.enctype+"; "+M)}}}}try{this.onsend();this.req.send(K||null);return this}catch(I){return this}},abort:function(){this.req.abort();G(this._pollId);window.clearInterval(this.timeoutID);this.onabort(this.req);this._oncomplete(false)},_oncomplete:function(I){this.oncomplete({successful:I})},toString:function(){var J="ajax.AsyncRequest: \nuri: "+this.uri+"\nhttpMethod: "+this.httpMethod+"\n----------------------\nreq: \n",K;for(K in this.req){try{if(typeof this.req[K]=="string"){J.concat(K+": "+this.req[K]+"\n")}}catch(I){}}return J},_setUpReadyStateChangeHandler:function(){var K=this;this._pollId=window.setInterval(I,50);if(this.timeoutMillis>0){var J=function(){K.ontimeout();K.req.abort();K._oncomplete()};this.timeoutID=setTimeout(J,this.timeoutMillis)}function I(){if(K.req.readyState==4){L()}}function L(){G(K._pollId);var M=K.req.status,N=M>=200&&M<300||M==304||M==1223;if(N){K._oncomplete(true);K.onsucceed(K.req)}else{K._oncomplete(false);K.onfail(K.req)}window.clearInterval(K.timeoutID)}}}})();