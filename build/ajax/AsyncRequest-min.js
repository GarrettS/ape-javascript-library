APE.namespace("APE.ajax").createCustomFactory("AsyncRequest",function(L){L.isSupported=E;var H="XMLHttpRequest",I="ActiveXObject",J=typeof window[H]!="undefined"?H:I,F,A=H==J,C=A||typeof window[I]!="undefined"&&!!B(),G=[];function E(){return C}function B(){return A?new this[J]:K()}function K(){var P=this[J],O,M,Q;if(F){return new P(F)}M=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(O=0;O<M.length;O++){try{Q=new P(M[O]);F=M[O];return Q}catch(N){}}C=false}return D;function D(U){var P=0,T=Function.prototype;function S(W,V){this.id=W;this.uri=V.action||typeof V=="string"&&V;if(!this.uri){throw URIError("formConfig.action = undefined")}this.httpMethod=V.method&&V.method.toLowerCase()||"get";this.enctype=V.enctype||"application/x-www-form-urlencoded";if(C){this.req=R()}}function R(){var W,X,V;for(X=0;X<4;X++){W=G[X];if(!W){return G[X]=B()}else{V=W.readyState;if(V===4){W.abort()}if(V===0){return W}}}return B()}function M(X){X.timerId=setInterval(V,50);if(X.timeoutMillis>0){var W=function(){X.ontimeout();X.req.abort();N(X);X.req.onreadystatechange=T};X.timeoutID=setTimeout(W,X.timeoutMillis)}function V(){if(X.req.readyState===4){Q(X)}}}function Q(V){var X=V.req,W=X.status,Y=W>=200&&W<300||W==304||W==1223;if(Y){N(V,true);V.onsucceed(X)}else{N(V,false);V.onfail(X)}V.timerId=clearInterval(V.timerId)}function N(V,W){V.oncomplete({successful:W})}function O(V,W){var X="---------------------------DATA_"+(++P)+"\n";W=X+W.join(X)+X;V.req.setRequestHeader("Content-Type",V.enctype+"; "+X)}S.prototype={onabort:T,oncomplete:T,onsucceed:T,onfail:T,ontimeout:T,onsend:T,timeoutMillis:0,send:function(X,Y){if(!C){return this.onfail()}var W=this.uri;this.timeoutMillis=Y|0||4000;if(this.httpMethod=="get"&&typeof X=="string"){W+=X}this.req.open(this.httpMethod,W,true);M(this);if(typeof this.req.setRequestHeader!="undefined"){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof X=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(X&&X.join&&this.enctype=="multipart/form-data"){O(this,X)}}}}try{this.onsend();this.req.send(X||null)}catch(V){this.onfail(V)}return this},abort:function(){if(!C){return}this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);N(this,false)},toString:function(){var W="AsyncRequest: \nisSupported(): "+C+"\nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",X;if(C){for(X in this.req){try{if(typeof this.req[X]=="string"){W.concat(X+": "+this.req[X]+"\n")}}catch(V){}}}return W}};return S}});