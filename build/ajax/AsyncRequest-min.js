APE.namespace("APE.ajax").appendToURI=function(C,B){var A=C?C.indexOf("?")!==-1?"&":"?":"";return C+A+B};APE.namespace("APE.ajax").createCustomFactory("AsyncRequest",function(M){M.isSupported=E;var H="XMLHttpRequest",I="ActiveXObject",J=typeof window[H]!="undefined"?H:I,F,L=APE.ajax.appendToURI,A=H==J,C=A||typeof window[I]!="undefined"&&!!B(),G=[];function E(){return C}function B(){return A?new this[J]:K()}function K(){var Q=this[J],P,N,R;if(F){return new Q(F)}N=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(P=0;P<N.length;P++){try{R=new Q(N[P]);F=N[P];return R}catch(O){}}C=false}return D;function D(V){var Q=0,U=Function.prototype;function T(X,W){this.id=X;this.uri=W.action||typeof W=="string"&&W||"";this.httpMethod=W.method&&W.method.toLowerCase()||"get";this.enctype=W.enctype||"application/x-www-form-urlencoded";if(C){this.req=S()}}function S(){var X,Y,W;for(Y=0;Y<4;Y++){X=G[Y];if(!X){return G[Y]=B()}else{W=X.readyState;if(W===4){X.abort()}if(W===0){return X}}}return B()}function N(Y){Y.timerId=setInterval(W,50);if(Y.timeoutMillis>0){var X=function(){Y.ontimeout();Y.req.abort();O(Y);Y.req.onreadystatechange=U};Y.timeoutID=setTimeout(X,Y.timeoutMillis)}function W(){if(Y.req.readyState===4){R(Y)}}}function R(W){var Y=W.req,X=Y.status,Z=X>=200&&X<300||X==304||X==1223;if(Z){O(W,true);W.onsucceed(Y)}else{O(W,false);W.onfail(Y)}W.timerId=clearInterval(W.timerId)}function O(W,X){W.oncomplete({successful:X})}function P(W,X){var Y="---------------------------DATA_"+(++Q)+"\n";X=Y+X.join(Y)+Y;W.req.setRequestHeader("Content-Type",W.enctype+"; "+Y)}T.prototype={onabort:U,oncomplete:U,onsucceed:U,onfail:U,ontimeout:U,onsend:U,timeoutMillis:0,get:function(W,X){return this.send(W,X)},post:function(W,X){return this.send(W,X)},send:function(Y,Z){if(!C){return this.onfail()}var X=this.uri;this.timeoutMillis=Z|0||4000;if(this.httpMethod=="get"&&typeof Y=="string"){X=L(X,Y)}this.req.open(this.httpMethod,X,true);N(this);if(typeof this.req.setRequestHeader!="undefined"){this.req.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(this.httpMethod=="post"){if(typeof Y=="string"){this.req.setRequestHeader("Content-Type",this.enctype)}else{if(Y&&Y.join&&this.enctype=="multipart/form-data"){P(this,Y)}}}}try{this.onsend();this.req.send(Y||null)}catch(W){this.onfail(W)}return this},abort:function(){if(!C){return}this.req.abort();clearTimeout(this.timeoutID);this.onabort(this.req);O(this,false)},toString:function(){var X="AsyncRequest: \nisSupported(): "+C+"\nuri: "+this.uri+"\nmethod: "+this.httpMethod+"\n----------------------\nreq: \n",Y;if(C){for(Y in this.req){try{if(typeof this.req[Y]=="string"){X.concat(Y+": "+this.req[Y]+"\n")}}catch(W){}}}return X}};return T}});