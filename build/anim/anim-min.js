APE.namespace("APE.anim");
(function(){function C(b){if(typeof b=="number")this.duration=b*1E3;this.timeLimit=this.duration}function v(b){return b}APE.anim.Animation=C;var g="rationalValue";C.prototype={paused:false,duration:1E3,timeLimit:1E3,isReversed:false,startOffset:0,endOffset:1,startValue:0,endValue:1,rationalValue:0,transition:v,position:0,onstart:v,onend:v,onabort:function(b){throw b;},run:v,start:function(){if(!this.paused){this.playing=true;this.timeLimit=this.duration;this.endOffset=this.transition(this.endValue);this._start()}},
_start:function(){n.unregister(this);this._startTime=+new Date;this.onstart();n.register(this);this.started=true},seekTo:function(b,i){b=parseFloat(b);if(isFinite(b))if(b!==this[g]){this.startOffset=this.position;this.startValue=this[g];this.endValue=b;var q=Math.abs(b-this.startValue);this.timeLimit=this.duration*q;this.endOffset=(this._transitionBackwards=(this.isReversed=b<this[g])&&i)?1-this.transition(1-b):this.transition(b);this._start()}},toggleDirection:function(){if(this.started)this.isReversed?
this.seekTo(1):this.seekTo(0,this.position==1);else this.start()},reset:function(){this.position=0;this.timeLimit=this.duration},pause:function(){this.paused=true;this.elapsedTime=new Date-this._startTime;n.unregister(this)},resume:function(){this.paused=false;this._startTime=new Date-this.elapsedTime;n.register(this)},toString:function(){return"Animation {duration millis: "+this.duration+", position:"+this.position+"}"},stop:function(b){this._end(b)},abort:function(b){n.unregister(this);this.onabort(b||
{})},_end:function(b){n.unregister(this);b!==false&&this.onend()}};var n=new (function(){function b(d){l.length===0&&q.call(this);for(var f=0;f<l.length;f++)if(l[f]===d)return;l.push(d)}function i(d){for(var f=0;f<l.length;f++)l[f]===d&&l.splice(f,1);if(l.length===0){l=[];j.call(this)}}function q(){y=self.setInterval(z,D)}function z(){for(var d=0,f;d<l.length;d++)try{f=l[d];F(f)}catch(o){f&&f.abort(o)}}function j(){self.clearInterval(y)}function F(d){var f=new Date-d._startTime;if(f>=d.timeLimit){d.run(d.position=
d.endOffset);d[g]=d.endValue;d._end()}else{f=f/d.duration;var o=d.transition;if(d.isReversed){d[g]=d.startValue-f;d.position=d._transitionBackwards?1-o(1-d[g]):o(d[g])}else{d[g]=d.startValue+f;d.position=o(d[g])}typeof d.onplay=="function"&&d.onplay(d.position);d.run(d.position)}}this.register=b;this.unregister=i;var D=17,l=[],y}),m=Math.PI,w=Math.atan,x=Math.cos;APE.anim.Transitions={none:v,accel:function(b){return b*b*b},decel:function(b){b=1-b;return 1-b*b*b},reverse:function(b){return 1-b},getSigmoid:function(b){function i(q){return(w(b*
(2*q-1))/w(b)+1)/2}b=b||1;return i},easeInEaseOut:function(b){return(w(b*m/1-m/2)+1)/2.0038848218538874},wobble:function(b){return-x(3*b*m)/2+0.5},loop:function(b){return-x(2*b*m)/2+0.5},spring:function(b){return 1-x(b*4.5*m)*Math.exp(-b*6)},swingTo:function(b){var i=1.70158;return(b-=1)*b*((i+1)*b+i)+1},swingToFrom:function(b){var i=1.70158;if((b/=0.5)<1)return 0.5*b*b*(((i*=1.525)+1)*b-i);return 0.5*((b-=2)*b*(((i*=1.525)+1)*b+i)+2)}}})();
(function(){function C(a,c,e,h){D.call(this,e);if(a.id)a=a.id;this.id=a;if(h)this.transition=h;this.init(c)}function v(a,c){var e,h,k=a[A];for(e in c){h=c[e];if(e===o)y.setOpacity(a,h);else k[e]=h}k.visibility="visible";k.display="block"}function g(a,c,e){this.prop=a;this[f]=c;this[p]=e}function n(a,c,e){if(!B)B=j.color.ColorRGB;c=B.fromString(c);e=B.fromString(e);g.call(this,a,c,e);this.currentValue=new B}function m(a,c,e){g.call(this,a,parseFloat(c),parseFloat(e))}function w(){m.apply(this,arguments)}
function x(a,c,e){g.call(this,a,parseFloat(c),parseFloat(e))}function b(a,c,e){g.call(this,"filter",c,e)}function i(a,c,e){g.call(this,a,parseInt(c,10),parseInt(e,10))}function q(a,c,e){g.call(this,a,c,e)}function z(a,c,e){g.call(this,a,c,e)}var j=window.APE,F=j.anim,D=F.Animation,l=D.prototype,y=j.dom,d,f="fromValue",o="opacity",p="toValue",G="px",r="prototype",s="blendTo",E="toString",t="extend",A="style";F.StyleTransition=C;j[t](C,D,{_start:function(){this[A]=document.getElementById(this.id)[A];
l._start.call(this)},_end:function(){this[A]=null;l._end.call(this)},run:function(a){for(var c=0,e=this.adapters,h=e.length,k=this[A],u;c<h;){u=e[c++];k[u.prop]=u[s](a)}},init:function(a){var c=document.getElementById(this.id),e=[],h,k,u=c[A],K=u.cssText,H={};if(d===undefined)d=!(o in u)&&"filter"in u;for(k in a)if(a[k]){if(k===o&&d&&!c.currentStyle.hasLayout)u.zoom="1";H[k]=y.getStyle(c,k)}v(c,a);for(k in a){h=a[k];if(I.test(h))h=y.getStyle(c,k);h=L.fromValues(k,H[k],h);e.push(h)}u.cssText=K;e.sort(function(M){return M instanceof
z?-1:1});this.adapters=e},toString:function(){return"StyleTransitionAdapter : id=#"+this.id+"\n"+l[E].call(this)+"\nAdapters:\n  "+this.adapters.join("\n  ")}});var I=/(^-?\d+|(?:-?\d*\.\d+))(px|em|ex|pt|pc|in|cm|mm|%)/i,N=/color/i,O=/(?:width|height|padding|fontSize)$/ig,J=/^\d+$/,P=/^(?:hidden|collapse)/,L={fromValues:function(a,c,e){var h;h=O.test(a)?w:N.test(a)?n:I.test(c)?m:a===o?d?b:x:a=="fontWeight"&&J.test(c)&&J.test(e)?i:a==="visibility"&&P.test(c)||a=="display"&&c=="none"?z:q;return new h(a,
c,e)}},B=j.color&&j.color.ColorRGB;g[r][E]=function(){return"Transition: "+this.prop+", "+this[f][E]()+" \u2014 "+this[p][E]()};j[t](n,g);n[r][s]=function(a){a=B.blend(this[f],this[p],a,this.currentValue);return a[E]()};j[t](m,g);m[r][s]=function(a){var c=1-a;return this[f]*c+this[p]*a+G};j[t](w,m);w[r][s]=function(a){var c=1-a;return a=Math.max(this[f]*c+this[p]*a,0)+G};j[t](x,g);x[r][s]=function(a){var c=1-a;return a=Math.max(this[f]*c+this[p]*a,0)};j[t](b,g);b[r][s]=function(a){var c=1-a;a=Math.abs(this[f]*
c+this[p]*a,0);return"alpha(opacity="+Math.abs(a*100)+")"};j[t](i,g);i[r][s]=function(a){var c=1-a;a=((this[f]*c+this[p]*a)/100<<0)*100;if(a<100)return 100;if(a>900)return 900;return a};j[t](q,g);q[r][s]=function(a){if(a===1)return this[p];return this[f]};j[t](z,g);z[r][s]=function(a){if(a===0)return this[f];return this[p]}})();
